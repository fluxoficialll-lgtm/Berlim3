import{c as e,A as t,i as s,U as o}from"./index-DHTLMDH8.js";const a=[{id:"ad-mock-image-1",authorId:"u-creator-002",username:"@flux_ads",text:"Domine o mercado digital com as ferramentas certas. ConheÃ§a nossa nova suÃ­te de automaÃ§Ã£o para criadores de conteÃºdo! ðŸš€",time:"Patrocinado",timestamp:Date.now()+1e3,isPublic:!0,views:45200,likes:1200,comments:45,liked:!1,type:"photo",image:"https://images.unsplash.com/photo-1460925895917-afdab827c52f?q=80&w=800&auto=format&fit=crop",isAd:!0,ctaText:"saiba mais",ctaLink:"/marketplace",location:void 0},{id:"user-post-photo-1",authorId:"u-creator-002",username:"@pixel_master",text:"EstratÃ©gias de escala para 2024. O trÃ¡fego pago mudou e vocÃª precisa se adaptar! ðŸ”¥ #Marketing #ROI",time:"2d",timestamp:Date.now()-1728e5,isPublic:!0,views:8400,likes:920,comments:56,liked:!0,type:"photo",image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=800&auto=format&fit=crop",isAd:!1,location:"SÃ£o Paulo, SP"},{id:"user-post-carousel-1",authorId:"u-creator-002",username:"@pixel_master",text:"3 Passos para criar uma oferta irresistÃ­vel no seu Grupo VIP. Arraste para o lado! âž¡ï¸",time:"4d",timestamp:Date.now()-3456e5,isPublic:!0,views:12e3,likes:2100,comments:89,liked:!1,type:"photo",images:["https://images.unsplash.com/photo-1553481187-be93c21490a9?q=80&w=800&auto=format&fit=crop","https://images.unsplash.com/photo-1552664730-d307ca884978?q=80&w=800&auto=format&fit=crop","https://images.unsplash.com/photo-1557804506-669a67965ba0?q=80&w=800&auto=format&fit=crop"],isAd:!1},{id:"user-reel-1",authorId:"u-creator-002",username:"@pixel_master",text:"Minha rotina de anÃ¡lise de mÃ©tricas matinal. â˜•ðŸ“ˆ #DataScience #Ads",time:"1d",timestamp:Date.now()-864e5,isPublic:!0,views:25600,likes:4500,comments:112,liked:!1,type:"video",video:"https://assets.mixkit.co/videos/preview/mixkit-business-charts-on-a-tablet-screen-23053-large.mp4",isAd:!1},{id:"user-reel-2",authorId:"u-creator-002",username:"@pixel_master",text:"Como sair do zero no Flux Marketplace hoje mesmo!",time:"6h",timestamp:Date.now()-216e5,isPublic:!0,views:5200,likes:890,comments:34,liked:!1,type:"video",video:"https://assets.mixkit.co/videos/preview/mixkit-hand-taking-a-credit-card-out-of-a-wallet-22442-large.mp4",isAd:!1},{id:"user-post-text-1",authorId:"u-creator-002",username:"@pixel_master",text:"Pergunta rÃ¡pida: Qual rede social estÃ¡ dando mais ROI para vocÃªs neste mÃªs? ðŸ’¸",time:"1w",timestamp:Date.now()-6048e5,isPublic:!0,views:1200,likes:45,comments:203,liked:!1,type:"poll",pollOptions:[{text:"Meta (FB/IG)",votes:85},{text:"TikTok",votes:62},{text:"Google/YouTube",votes:56}],isAd:!1},{id:"post-1",authorId:"u-admin-001",username:"@flux_official",text:"Bem-vindo ao Flux! ðŸš€ Esta Ã© a sua nova plataforma de conexÃ£o e monetizaÃ§Ã£o de comunidades.",time:"Agora",timestamp:Date.now(),isPublic:!0,views:1250,likes:450,comments:12,liked:!1,type:"text",isAd:!1,location:"Sede Global"},{id:"post-3",authorId:"u-star-004",username:"@julia_vendas",text:"Confira os resultados da nossa Ãºltima mentoria de escala. O time estÃ¡ voando! ðŸ“ˆ",time:"15m",timestamp:Date.now()-9e5,isPublic:!0,views:2500,likes:670,comments:42,liked:!1,type:"photo",image:"https://images.unsplash.com/photo-1493246507139-91e8bef99c02?q=80&w=800&auto=format&fit=crop",isAd:!1,relatedGroupId:"g-vip-001"}],i={formatRelativeTime:e=>{const t=Math.floor((Date.now()-e)/1e3);return t<60?"Agora":t<3600?`${Math.floor(t/60)}m`:t<86400?`${Math.floor(t/3600)}h`:new Date(e).toLocaleDateString()},sanitizePost:t=>{const s=e.getCurrentUserId(),o=Array.isArray(t.likedByIds)?t.likedByIds:[];return{...t,id:String(t.id),text:String(t.text||""),authorId:String(t.authorId||""),username:String(t.username||"AnÃ´nimo"),likes:Number(t.likes||0),comments:Number(t.comments||0),views:Number(t.views||0),liked:s?o.includes(s):!!t.liked,images:t.images||void 0,isAd:!!t.isAd,ctaText:t.ctaText||void 0,ctaLink:t.ctaLink||void 0,relatedGroupId:t.relatedGroupId||void 0,isAdultContent:!!t.isAdultContent,location:t.location||void 0}}},r=`${t}/api/posts`,n={async getFeedPaginated(e){try{const t=new AbortController,s=setTimeout(()=>t.abort(),8e3),o=await fetch(`${r}?limit=${e.limit}&cursor=${e.cursor||""}`,{signal:t.signal});if(clearTimeout(s),!o.ok)return{data:[],nextCursor:void 0};const a=await o.json();return{data:(a.data||[]).map(i.sanitizePost),nextCursor:a.nextCursor}}catch(t){return{data:[],nextCursor:void 0}}},async searchPosts(e){if(!e.trim())return[];try{const t=await fetch(`${r}/search?q=${encodeURIComponent(e)}`);if(t.ok){return((await t.json()).data||[]).map(i.sanitizePost)}return[]}catch(t){return[]}},async getPostById(e){try{const t=await fetch(`${r}/${e}`);if(!t.ok)return;const s=await t.json();return s?i.sanitizePost(s):void 0}catch(t){return}},async getUserPosts(e){try{const t=await fetch(`${r}/user/${e}`);if(!t.ok)return[];return((await t.json()).data||[]).map(i.sanitizePost)}catch(t){return[]}}},d="flux_viewed_posts_session",m={trackView:async o=>{let a=[];try{a=JSON.parse(sessionStorage.getItem(d)||"[]")}catch(n){a=[]}if(a.includes(o))return;const i=s.posts.findById(o);if(!i)return;a.push(o),sessionStorage.setItem(d,JSON.stringify(a));const r=e.getCurrentUserId();i.views=(i.views||0)+1,s.posts.update(i);try{fetch(`${t}/api/posts/${o}/interact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r,type:"view",action:"add"})}).catch(()=>{})}catch(n){}},toggleLike:async(o,a)=>{const i=s.posts.findById(o);if(!i)return null;const r=e.getCurrentUserId(),n=a?"remove":"add";if(i.liked=!a,i.likes=Math.max(0,(i.likes||0)+(i.liked?1:-1)),r){const e=new Set(i.likedByIds||[]);i.liked?e.add(r):e.delete(r),i.likedByIds=Array.from(e)}s.posts.update(i);try{fetch(`${t}/api/posts/${o}/interact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r,type:"like",action:n})}).catch(()=>{})}catch(d){}return i},notifyCommentChange:(e,t)=>{const o=s.posts.findById(e);o&&(o.comments=Math.max(0,(o.comments||0)+t),s.posts.update(o))},syncPostObject:e=>{const t=s.posts.findById(e.id);return t?{...e,likes:t.likes,comments:t.comments,views:t.views,liked:t.liked}:e}},c={async toggleLike(e){const t=s.posts.findById(e);if(t)return await m.toggleLike(e,!!t.liked)||void 0},incrementView(e){m.trackView(e)},incrementShare(e){s.posts.findById(e)&&m.trackView(e)}},l=`${t}/api/posts`,p={async addComment(t,o,a,i){const r=e.getCurrentUserId(),n=a.replace(/^@/,""),d={id:Date.now().toString(),userId:r||"user",text:o,username:n,avatar:i,timestamp:Date.now(),replies:[]},c=s.posts.findById(t);if(c){c.commentsList=[d,...c.commentsList||[]],m.notifyCommentChange(t,1),s.posts.update(c);try{fetch(`${l}/${t}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment:d})}).catch(()=>{})}catch(p){}return d}},addReply(t,o,a,i,r){var n;const d=s.posts.findById(t),c=e.getCurrentUserId();if(d&&d.commentsList){let e,u;for(const t of d.commentsList){if(t.id===o){e=t,u=t.username;break}const s=null==(n=t.replies)?void 0:n.find(e=>e.id===o);if(s){e=t,u=s.username;break}}if(e){const o={id:"r-"+Date.now(),userId:c||"user",text:a,username:i.replace(/^@/,""),avatar:r,timestamp:Date.now(),replies:[],replyToUsername:null==u?void 0:u.replace(/^@/,"")};e.replies=[...e.replies||[],o],m.notifyCommentChange(t,1),s.posts.update(d);try{fetch(`${l}/${t}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parentId:e.id,reply:o})}).catch(()=>{})}catch(p){}return o}}},async deleteComment(e,t){const o=s.posts.findById(e);if(o){const a=e=>e.filter(e=>e.id!==t&&(e.replies&&(e.replies=a(e.replies)),!0));return o.commentsList=a(o.commentsList||[]),m.notifyCommentChange(e,-1),s.posts.update(o),!0}return!1},toggleCommentLike(e,t){const o=s.posts.findById(e);if(o&&o.commentsList){const e=s=>{for(const o of s){if(o.id===t)return o.likedByMe=!o.likedByMe,o.likes=(o.likes||0)+(o.likedByMe?1:-1),!0;if(o.replies&&e(o.replies))return!0}return!1};if(e(o.commentsList))return s.posts.update(o),!0}return!1}},u=`${t}/api/posts`,f={async uploadMedia(e,s="feed"){const o=new FormData;o.append("file",e),o.append("folder",s);const a=await fetch(`${t}/api/upload`,{method:"POST",body:o});return(await a.json()).files[0].url},async addPost(e){try{const t=await fetch(`${u}/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){const s=await t.json();s.post&&(e=s.post)}}catch(t){}s.posts.add(i.sanitizePost(e))},async deletePost(e){s.posts.delete(e);try{await fetch(`${u}/${e}`,{method:"DELETE"})}catch(t){}}},h=o?{formatRelativeTime:e=>{const t=Math.floor((Date.now()-e)/1e3);return t<60?"Agora":t<3600?`${Math.floor(t/60)}m`:t<86400?`${Math.floor(t/3600)}h`:new Date(e).toLocaleDateString()},getFeedPaginated:async e=>{await new Promise(e=>setTimeout(e,300));const t=e.limit||15,o=e.cursor;let i=s.posts.getAll();0===i.length&&(a.forEach(e=>s.posts.add(e)),i=s.posts.getAll());const r=i.filter(e=>"video"!==e.type||e.isAd);let n=r;o&&(n=r.filter(e=>e.timestamp<o)),n.sort((e,t)=>t.timestamp-e.timestamp);const d=n.slice(0,t);return{data:d,nextCursor:n.length>t?d[d.length-1].timestamp:void 0}},searchPosts:async e=>{await new Promise(e=>setTimeout(e,400));const t=e.toLowerCase().trim();if(!t)return[];return s.posts.getAll().filter(e=>{var s,o;return((null==(s=e.text)?void 0:s.toLowerCase().includes(t))||(null==(o=e.username)?void 0:o.toLowerCase().includes(t)))&&("video"!==e.type||e.isAd)})},uploadMedia:async e=>URL.createObjectURL(e),addPost:async e=>(s.posts.add(e),Promise.resolve()),toggleLike:async e=>{const t=s.posts.findById(e);if(t)return t.liked=!t.liked,t.likes+=t.liked?1:-1,s.posts.update(t),t},incrementView:e=>{const t=s.posts.findById(e);t&&(t.views++,s.posts.update(t))},getPostById:e=>s.posts.findById(e)||a.find(t=>t.id===e),getUserPosts:e=>{let t=s.posts.getAll();return 0===t.length&&(a.forEach(e=>s.posts.add(e)),t=s.posts.getAll()),t.filter(t=>t.authorId===e||"u-creator-002"===t.authorId)},deletePost:async e=>(s.posts.delete(e),Promise.resolve()),addComment:async(t,o,a,i)=>{const r=s.posts.findById(t);if(r){const t={id:"c-"+Date.now(),userId:e.getCurrentUserId()||"guest",username:a.replace(/^@/,""),avatar:i,text:o,timestamp:Date.now(),replies:[]};return r.commentsList=[t,...r.commentsList||[]],r.comments++,s.posts.update(r),t}},deleteComment:async(e,t)=>{const o=s.posts.findById(e);if(o){const e=s=>s.filter(s=>s.id!==t&&(s.replies&&(s.replies=e(s.replies)),!0));return o.commentsList=e(o.commentsList||[]),o.comments--,s.posts.update(o),!0}return!1},incrementShare:e=>{const t=s.posts.findById(e);t&&(t.views+=5,s.posts.update(t))},addReply:(t,o,a,i,r)=>{var n;const d=s.posts.findById(t);if(d&&d.commentsList){let t,m;for(const e of d.commentsList){if(e.id===o){t=e,m=e.username;break}const s=null==(n=e.replies)?void 0:n.find(e=>e.id===o);if(s){t=e,m=s.username;break}}if(t){const o={id:"r-"+Date.now(),userId:e.getCurrentUserId()||"guest",text:a,username:i.replace(/^@/,""),avatar:r,timestamp:Date.now(),replies:[],replyToUsername:null==m?void 0:m.replace(/^@/,"")};return t.replies=[...t.replies||[],o],d.comments++,s.posts.update(d),o}}},toggleCommentLike:(e,t)=>{const o=s.posts.findById(e);if(o&&o.commentsList){const e=s=>{for(const o of s){if(o.id===t)return o.likedByMe=!o.likedByMe,o.likes=(o.likes||0)+(o.likedByMe?1:-1),!0;if(o.replies&&e(o.replies))return!0}return!1};if(e(o.commentsList))return s.posts.update(o),!0}return!1}}:{formatRelativeTime:i.formatRelativeTime,sanitizePost:i.sanitizePost,getFeedPaginated:n.getFeedPaginated,searchPosts:n.searchPosts,getPostById:n.getPostById,getUserPosts:n.getUserPosts,toggleLike:c.toggleLike,incrementView:c.incrementView,incrementShare:c.incrementShare,addComment:p.addComment,addReply:p.addReply,deleteComment:p.deleteComment,toggleCommentLike:p.toggleCommentLike,addPost:f.addPost,deletePost:f.deletePost,uploadMedia:f.uploadMedia};export{m as P,h as p};

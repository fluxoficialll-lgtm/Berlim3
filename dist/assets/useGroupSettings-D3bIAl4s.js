import{r as e,c as t,g as o,i as s,u as a,f as r,e as i,G as n}from"./index-DHTLMDH8.js";const l=()=>{const l=a(),{id:d}=r(),{showAlert:u,showConfirm:m}=i(),[c,p]=e.useState(null),[v,S]=e.useState(!0),[f,g]=e.useState(!1),[b,M]=e.useState(!1),P=(t=>{const[o,s]=e.useState(""),[a,r]=e.useState(""),[i,n]=e.useState(void 0);return e.useEffect(()=>{t&&(s(t.name||""),r(t.description||""),n(t.coverImage))},[t]),{state:{groupName:o,description:a,coverImage:i},actions:{setGroupName:s,setDescription:r,setCoverImage:n},getIdentityPayload:()=>({name:o,description:a,coverImage:i})}})(c),I=(t=>{const[o,s]=e.useState(!1),[a,r]=e.useState(!1),[i,n]=e.useState("30"),[l,d]=e.useState([]),[u,m]=e.useState(!1),[c,p]=e.useState("");return e.useEffect(()=>{var e;if(null==t?void 0:t.settings){const o=t.settings;s(o.onlyAdminsPost||!1),r(o.msgSlowMode||!1),n((null==(e=o.msgSlowModeInterval)?void 0:e.toString())||"30"),d(o.forbiddenWords||[]),m(o.approveMembers||!1),p(o.memberLimit||"")}},[t]),{state:{onlyAdminsPost:o,msgSlowMode:a,msgSlowModeInterval:i,forbiddenWords:l,approveMembers:u,memberLimit:c},actions:{setOnlyAdminsPost:s,setMsgSlowMode:r,setMsgSlowModeInterval:n,setForbiddenWords:d,setApproveMembers:m,setMemberLimit:p},getModerationPayload:()=>({settings:{onlyAdminsPost:o,msgSlowMode:a,msgSlowModeInterval:parseInt(i),forbiddenWords:l,approveMembers:u,memberLimit:""===c?void 0:Number(c)}})}})(c),w=(t=>{const[o,s]=e.useState(""),[a,r]=e.useState("BRL"),[i,n]=e.useState(null),[l,d]=e.useState(""),[u,m]=e.useState(""),[c,p]=e.useState(""),[v,S]=e.useState(""),[f,g]=e.useState([]);e.useEffect(()=>{var e,o,a,i;(null==t?void 0:t.isVip)&&(s(t.price||""),r(t.currency||"BRL"),n(t.selectedProviderId||null),d(t.pixelId||""),m(t.pixelToken||""),p((null==(e=t.vipDoor)?void 0:e.text)||""),S((null==(o=t.vipDoor)?void 0:o.buttonText)||""),g((null==(a=t.vipDoor)?void 0:a.mediaItems)||((null==(i=t.vipDoor)?void 0:i.media)?[{url:t.vipDoor.media,type:"image"}]:[])))},[t]);const b=e.useMemo(()=>({metaId:l,metaToken:u}),[l,u]);return{state:{vipPrice:o,vipCurrency:a,selectedProviderId:i,pixelId:l,pixelToken:u,vipDoorText:c,vipButtonText:v,vipMediaItems:f,pixelConfig:b},actions:{setVipPrice:s,setVipCurrency:r,setSelectedProviderId:n,setPixelId:d,setPixelToken:m,setVipDoorText:p,setVipButtonText:S,setVipMediaItems:g,updatePlatformPixel:(e,t)=>{"meta"===e&&(d(t.pixelId),m(t.pixelToken))},moveVipMediaItem:(e,t)=>{const o=[...f],s="left"===t?e-1:e+1;s<0||s>=o.length||([o[e],o[s]]=[o[s],o[e]],g(o))}},getVipPayload:()=>({price:o.replace(",","."),currency:a,selectedProviderId:i||void 0,pixelId:l,pixelToken:u,vipDoor:(null==t?void 0:t.isVip)?{...t.vipDoor,text:c,buttonText:v,mediaItems:f}:void 0})}})(c),y=(t=>{const[o,s]=e.useState([]),[a,r]=e.useState([]),[i,n]=e.useState(!1),[l,d]=e.useState([]),[u,m]=e.useState(!0),[c,p]=e.useState(!1),[v,S]=e.useState([]);return e.useEffect(()=>{t&&(s(t.channels||[]),r(t.channelSections||[]),n(t.isSalesPlatformEnabled||!1),d(t.salesPlatformSections||[]),m(t.salesPlatformAllowDownload??!0),p(t.salesPlatformAllowMemberUpload??!1),S(t.links||[]))},[t]),{state:{channels:o,channelSections:a,isSalesPlatformEnabled:i,salesPlatformSections:l,salesPlatformAllowDownload:u,salesPlatformAllowMemberUpload:c,links:v},actions:{setChannels:s,setChannelSections:r,setIsSalesPlatformEnabled:n,setSalesPlatformSections:d,setSalesPlatformAllowDownload:m,setSalesPlatformAllowMemberUpload:p,setLinks:S},getStructurePayload:()=>({channels:o,channelSections:a,isSalesPlatformEnabled:i,salesPlatformSections:l,salesPlatformAllowDownload:u,salesPlatformAllowMemberUpload:c,links:v})}})(c),h=(a=>{const[r,i]=e.useState([]),[n,l]=e.useState([]),[d,u]=e.useState([]),[m,c]=e.useState(""),p=t.getCurrentUserId(),v=e.useCallback(e=>{if(e)try{const t=o.getGroupMembers(e)||[];i(t),l(o.getPendingMembers(e)||[])}catch(t){}},[]);e.useEffect(()=>{if(a){u(a.roles||[]),v(a.id);const e=s.subscribe("groups",()=>v(a.id));return()=>e()}},[a,v]);const S=e.useMemo(()=>{const e=r||[],t=m.toLowerCase().trim();return t?e.filter(e=>{var o,s,a,r;const i=(null==(s=null==(o=e.profile)?void 0:o.name)?void 0:s.toLowerCase())||"",n=(null==(r=null==(a=e.profile)?void 0:a.nickname)?void 0:r.toLowerCase())||"";return i.includes(t)||n.includes(t)}):e},[r,m]);return{state:{members:e.useMemo(()=>{if(!a)return[];const e=S||[],t=a.userRoles||{};return e.map(e=>{var o,s,r,i;return{id:e.id,name:(null==(o=e.profile)?void 0:o.nickname)||(null==(s=e.profile)?void 0:s.name)||"Membro Flux",role:e.id===a.creatorId?"Dono":(null==(r=a.adminIds)?void 0:r.includes(e.id))?"Admin":"Membro",roleId:t[e.id],isMe:e.id===p,avatar:null==(i=e.profile)?void 0:i.photoUrl}})},[S,a,p]),pendingRequests:n,roles:d,searchQuery:m},actions:{setMembers:i,setPendingRequests:l,setRoles:u,refreshMembers:v,setSearchQuery:c},getMembersPayload:()=>({roles:d})}})(c);e.useEffect(()=>{var e;if(d){const s=t.getCurrentUserId(),a=o.getGroupById(d);if(a){p(a);const t=a.creatorId===s,o=t||s&&(null==(e=a.adminIds)?void 0:e.includes(s))||!1;g(t),M(o)}S(!1)}},[d]);const A={...P.state,...P.actions,...I.state,...I.actions,...w.state,...w.actions,...y.state,...y.actions,...h.state,...h.actions};return{group:c,loading:v,isOwner:f,isAdmin:b,handleSave:async()=>{if(!c)return;const e={...c,...P.getIdentityPayload(),...I.getModerationPayload(),...w.getVipPayload(),...y.getStructurePayload(),...h.getMembersPayload()};await o.updateGroup(e),await u("Sucesso","Configurações sincronizadas.")},handleLeaveDelete:async e=>{var s;if(!c||!d)return;const a=t.getCurrentUserId();if(!a)return;const r=(null==(s=c.memberIds)?void 0:s.length)||0;if("leave"===e){let e="Sair do Grupo",t="Deseja realmente sair desta comunidade?",o="Sair";if(1===r?(e="⚠️ Aviso Crítico",t="Você é o último membro. Se sair agora, o grupo e todo o histórico serão APAGADOS permanentemente. Confirmar?",o="Apagar e Sair"):f&&(t="Você é o dono deste grupo. Ao sair, a posse será transferida automaticamente para o administrador ou membro mais forte. Continuar?"),await m(e,t,o,"Cancelar")){"dissolved"===(await n.processDeparture(d,a)).action&&await u("Grupo Encerrado","O grupo foi removido pois não restaram membros."),l("/groups")}}else"delete"===e&&await m("EXCLUIR GRUPO","Esta ação apagará o grupo para TODOS os membros imediatamente. Não há volta. Confirmar?","Excluir Tudo","Cancelar")&&(await o.deleteGroup(d),l("/groups"))},handleMemberAction:(e,t)=>{d&&("kick"===t?o.removeMember(d,e):"ban"===t?o.banMember(d,e):"promote"===t?o.promoteMember(d,e):"demote"===t&&o.demoteMember(d,e),h.actions.refreshMembers(d))},handlePendingAction:async(e,t)=>{d&&("accept"===t?o.approveMember(d,e):o.rejectMember(d,e),h.actions.refreshMembers(d))},handleManualRelease:async e=>{if(!e.trim()||!c)return!1;const a=e.replace("@","").toLowerCase().trim(),r=await t.fetchUserByHandle(a);return r?(s.vipAccess.grant({userId:r.id,groupId:c.id,status:"active",purchaseDate:Date.now(),transactionId:`manual_${Date.now()}_admin`}),o.approveMember(c.id,r.id),h.actions.refreshMembers(c.id),await u("Sucesso",`Acesso VIP liberado para @${a}`),!0):(await u("Erro","Usuário não encontrado."),!1)},form:A}};export{l as u};

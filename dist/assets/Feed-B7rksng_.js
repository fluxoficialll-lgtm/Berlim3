import{u as e,e as t,r as s,c as r,j as l}from"./index-DHTLMDH8.js";import{p as a}from"./postService-D2IH4U_j.js";import{r as o}from"./recommendationService-BR-UzgU8.js";import{F as n}from"./FeedItem-BC1rcV7f.js";import{F as i}from"./Footer-BFwWYumu.js";import{M as c}from"./MainHeader-BXRD-tws.js";import"./MarketEngine-BDpNjeDI.js";import"./UserBadge-LRTOy28m.js";import"./UserAvatar-C2eAn2V1.js";const d=()=>{const{posts:d,uiVisible:f,activeLocationFilter:x,loading:u,hasMore:p,isMenuOpen:m,setIsMenuOpen:h,scrollContainerRef:g,loaderRef:b,currentUserId:j,handleContainerScroll:v,handlePostLike:w,handlePostDelete:C,handleUserClick:k,handleCommentClick:N,handleShare:y,handleVote:_,handleCtaClick:S,navigate:I}=(()=>{const l=e(),{showConfirm:n}=t(),i=s.useRef(null),[c,d]=s.useState([]),[f,x]=s.useState(!0),[u,p]=s.useState(null),[m,h]=s.useState(void 0),[g,b]=s.useState(!1),[j,v]=s.useState(!0),w=s.useRef(0),C=s.useRef(!1),[k,N]=s.useState(!1),y=s.useRef(new Set),_=s.useRef(null),S=s.useMemo(()=>r.getCurrentUser(),[]),I=null==S?void 0:S.id,M=s.useMemo(()=>"true"===localStorage.getItem("settings_18_plus"),[]),O=s.useCallback((e,t=!1)=>{e&&d(s=>{const r=t?e:[...s,...e],l=new Map;return r.forEach(e=>{e&&e.id&&!l.has(e.id)&&l.set(e.id,e)}),Array.from(l.values()).map(e=>({p:e,score:o.scorePost(e,null==S?void 0:S.email)})).sort((e,t)=>t.score-e.score).map(e=>e.p)})},[null==S?void 0:S.email]),F=s.useCallback(async(e,t=!1)=>{if(!C.current||t){C.current=!0,b(!0);try{const s=localStorage.getItem("feed_location_filter"),r="Global"!==s&&s?s:null,l=await a.getFeedPaginated({limit:15,cursor:e,locationFilter:r,allowAdultContent:M}),o=(l.data||[]).filter(e=>e&&("video"!==e.type||e.isAd));t?O(o,!0):o.length>0&&O(o,!1),h(l.nextCursor),v(!!l.nextCursor&&o.length>0)}catch(s){v(!1)}finally{b(!1),C.current=!1}}},[M,O]);return s.useEffect(()=>{if(!r.getCurrentUserEmail())return void l("/");const e=localStorage.getItem("feed_location_filter");p(e),F(void 0,!0)},[l,F]),s.useEffect(()=>{if(0===c.length)return;const e=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target.getAttribute("data-post-id");t&&!y.current.has(t)&&(y.current.add(t),a.incrementView(t))}})},{threshold:.15});return document.querySelectorAll(".feed-post-item").forEach(t=>e.observe(t)),()=>e.disconnect()},[c]),s.useEffect(()=>{const e=new IntersectionObserver(e=>{e[0].isIntersecting&&j&&!g&&!C.current&&m&&F(m)},{root:null,threshold:.1});return _.current&&e.observe(_.current),()=>e.disconnect()},[j,m,F,g]),{posts:c,uiVisible:f,activeLocationFilter:u,loading:g,hasMore:j,isMenuOpen:k,setIsMenuOpen:N,scrollContainerRef:i,loaderRef:_,currentUserId:I,handleContainerScroll:()=>{if(!i.current)return;const e=i.current.scrollTop;x(e<=w.current||e<=100),w.current=e},handlePostLike:async e=>{const t=await a.toggleLike(e);t&&d(s=>s.map(s=>s.id===e?{...s,liked:t.liked,likes:t.likes}:s))},handlePostDelete:async(e,t)=>{e.stopPropagation(),await n("Excluir Post","Deseja excluir permanentemente?","Excluir","Cancelar")&&(await a.deletePost(t),d(e=>e.filter(e=>e.id!==t)))},handleUserClick:e=>{l(`/user/${e.replace("@","")}`)},handleCommentClick:e=>{l(`/post/${e}`)},_handleShare:_handleShare,handleVote:(e,t)=>{a.voteOnPoll(e,t),d(s=>s.map(s=>{if(s.id===e&&s.pollOptions&&null==s.votedOptionIndex){const e=[...s.pollOptions];return e[t].votes+=1,{...s,pollOptions:e,votedOptionIndex:t,totalVotes:(s.totalVotes||0)+1}}return s}))},handleCtaClick:e=>{(null==e?void 0:e.startsWith("http"))?window.open(e,"_blank"):e&&l(e)},navigate:l}})();return l.jsxs("div",{className:"h-screen bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-hidden relative",children:[l.jsx(c,{leftContent:l.jsxs("button",{onClick:()=>I("/location-filter"),className:"bg-none border-none text-[#00c2ff] text-lg cursor-pointer hover:text-white flex items-center gap-1",children:[l.jsx("i",{className:"fa-solid "+(x&&"Global"!==x?"fa-location-dot":"fa-globe")}),x&&"Global"!==x&&l.jsxs("span",{className:"text-[10px] font-black uppercase tracking-tight ml-1",children:[x.substring(0,8),".."]})]}),rightContent:l.jsx("button",{onClick:()=>I("/marketplace"),className:"bg-none border-none text-[#00c2ff] text-lg cursor-pointer hover:text-white",children:l.jsx("i",{className:"fa-solid fa-cart-shopping"})}),onLogoClick:()=>{var e;return null==(e=g.current)?void 0:e.scrollTo({top:0,behavior:"smooth"})}}),l.jsxs("div",{className:"fixed top-[85px] left-1/2 -translate-x-1/2 z-40 flex items-center p-1 bg-[#1a1e26]/80 backdrop-blur-xl border border-white/10 rounded-full shadow-[0_4px_20px_rgba(0,0,0,0.5)]",children:[l.jsx("button",{className:"px-6 py-2 rounded-full bg-[#00c2ff] text-[#0c0f14] text-sm font-bold shadow-[0_0_15px_rgba(0,194,255,0.4)]",children:"Feed"}),l.jsx("button",{className:"px-6 py-2 rounded-full text-gray-400 text-sm font-medium hover:text-white",onClick:()=>I("/reels"),children:"Reels"})]}),l.jsx("main",{ref:g,onScroll:v,className:"flex-grow w-full overflow-y-auto overflow-x-hidden relative pt-[140px] no-scrollbar",children:l.jsxs("div",{className:"w-full max-w-[500px] mx-auto pb-[100px] px-3",children:[u&&0===d.length&&l.jsx("div",{className:"w-full flex justify-center mt-20",children:l.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-2xl text-[#00c2ff]"})}),!u&&0===d.length&&l.jsxs("div",{className:"text-center text-gray-500 mt-20 animate-fade-in",children:[l.jsx("i",{className:"fa-solid fa-ghost text-4xl opacity-30 mb-3"}),l.jsx("p",{className:"font-bold uppercase tracking-widest text-xs",children:"Nada por aqui ainda."})]}),d.length>0&&d.map(e=>l.jsx(n,{post:e,currentUserId:j,onLike:w,onDelete:(e,t)=>C(e,t),onUserClick:k,onCommentClick:N,onShare:y,onVote:_,onCtaClick:S},e.id)),l.jsxs("div",{ref:b,className:"w-full h-24 flex items-center justify-center py-6",children:[u&&d.length>0&&l.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-2xl text-[#00c2ff]"}),!u&&!p&&d.length>0&&l.jsx("div",{className:"text-gray-500 text-sm font-medium opacity-60",children:"• Fim do Feed •"})]})]})}),m&&l.jsx("div",{className:"fixed inset-0 bg-black/60 z-40 backdrop-blur-sm",onClick:()=>h(!1)}),l.jsxs("div",{className:"fixed bottom-[180px] right-[27px] flex flex-col gap-4 z-50 items-end transition-all duration-300 "+(m?"opacity-100 translate-y-0":"opacity-0 translate-y-10 pointer-events-none"),children:[l.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>I("/feed-search"),children:[l.jsx("span",{className:"text-white font-medium text-sm bg-[#1a1e26] px-3 py-1.5 rounded-lg border border-white/10",children:"Buscar"}),l.jsx("div",{className:"w-[50px] h-[50px] rounded-full bg-[#1a1e26] border border-white/10 flex items-center justify-center text-[#00c2ff] shadow-lg",children:l.jsx("i",{className:"fa-solid fa-magnifying-glass"})})]}),l.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>I("/create-reel"),children:[l.jsx("span",{className:"text-white font-medium text-sm bg-[#1a1e26] px-3 py-1.5 rounded-lg border border-white/10",children:"Criar Reel"}),l.jsx("div",{className:"w-[50px] h-[50px] rounded-full bg-gradient-to-tr from-[#f9ce34] via-[#ee2a7b] to-[#6228d7] flex items-center justify-center text-white shadow-lg",children:l.jsx("i",{className:"fa-solid fa-clapperboard"})})]}),l.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>I("/create-post"),children:[l.jsx("span",{className:"text-white font-medium text-sm bg-[#1a1e26] px-3 py-1.5 rounded-lg border border-white/10",children:"Novo Post"}),l.jsx("div",{className:"w-[50px] h-[50px] rounded-full bg-gradient-to-tr from-[#00c2ff] to-[#007bff] flex items-center justify-center text-white shadow-lg",children:l.jsx("i",{className:"fa-solid fa-pen"})})]})]}),l.jsx("button",{onClick:()=>h(!m),className:`fixed bottom-[105px] right-[20px] w-[60px] h-[60px] bg-[#00c2ff] rounded-full text-white text-[24px] cursor-pointer shadow-[0_4px_15px_rgba(0,194,255,0.4)] z-50 flex items-center justify-center transition-all duration-300 ${f?"scale-100":"scale-0"} ${m?"rotate-45 bg-[#ff4d4d]":""}`,children:l.jsx("i",{className:"fa-solid fa-plus"})}),l.jsx(i,{visible:f})]})};export{d as Feed};

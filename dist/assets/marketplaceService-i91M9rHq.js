import{A as e,i as t,U as a}from"./index-DHTLMDH8.js";const r=`${e}/api/marketplace`,m=a?{getRecommendedItems:()=>t.marketplace.getAll().sort((e,t)=>t.timestamp-e.timestamp),fetchItems:async()=>{},getItems:()=>t.marketplace.getAll(),getItemById:e=>t.marketplace.findById(e),createItem:async e=>{t.marketplace.add({...e,timestamp:e.timestamp||Date.now()})},deleteItem:async e=>t.marketplace.delete(e),trackView:()=>{},addComment:(e,a,r)=>{var m,n;const i=t.marketplace.findById(e);if(i){const e={id:"mq-"+Date.now(),userId:r.id,username:(null==(m=r.profile)?void 0:m.name)?r.profile.name:"user",avatar:null==(n=r.profile)?void 0:n.photoUrl,text:a,timestamp:Date.now(),replies:[],likes:0,likedByMe:!1};return i.comments=[e,...i.comments||[]],t.marketplace.update(i),e}},addReply:(e,a,r,m)=>{var n,i;const s=t.marketplace.findById(e);if(s&&s.comments){const e=s.comments.find(e=>e.id===a);if(e){const a={id:"mqr-"+Date.now(),userId:m.id,username:(null==(n=m.profile)?void 0:n.name)?m.profile.name:"user",avatar:null==(i=m.profile)?void 0:i.photoUrl,text:r,timestamp:Date.now(),replies:[],likes:0,likedByMe:!1,replyToUsername:e.username};return e.replies=[...e.replies||[],a],t.marketplace.update(s),a}}},toggleCommentLike:(e,a)=>{const r=t.marketplace.findById(e);if(r&&r.comments){const e=t=>{for(const r of t){if(r.id===a)return r.likedByMe=!r.likedByMe,r.likes=(r.likes||0)+(r.likedByMe?1:-1),!0;if(r.replies&&e(r.replies))return!0}return!1};if(e(r.comments))return t.marketplace.update(r),!0}return!1},deleteComment:async(e,a)=>{const r=t.marketplace.findById(e);if(r&&r.comments){const e=t=>t.filter(t=>t.id!==a&&(t.replies&&(t.replies=e(t.replies)),!0));return r.comments=e(r.comments),t.marketplace.update(r),!0}return!1}}:{getItems:async()=>{try{const e=await fetch(r);if(!e.ok)return[];return((await e.json()).data||[]).sort((e,t)=>(Number(t.timestamp)||0)-(Number(e.timestamp)||0))}catch(e){return[]}},getItemById:async e=>{try{const t=await fetch(`${r}/${e}`);if(!t.ok)return;return(await t.json()).data}catch(t){return}},createItem:async e=>{try{await fetch(`${r}/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(t){}},deleteItem:async e=>{try{await fetch(`${r}/${e}`,{method:"DELETE"})}catch(t){}}};export{m};

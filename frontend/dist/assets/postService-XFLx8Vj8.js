import{c as u,A as f,i,U as L}from"./index-BC19Iu_T.js";const w=[{id:"ad-mock-image-1",authorId:"u-creator-002",username:"@flux_ads",text:"Domine o mercado digital com as ferramentas certas. ConheÃ§a nossa nova suÃ­te de automaÃ§Ã£o para criadores de conteÃºdo! ğŸš€",time:"Patrocinado",timestamp:Date.now()+1e3,isPublic:!0,views:45200,likes:1200,comments:45,liked:!1,type:"photo",image:"https://images.unsplash.com/photo-1460925895917-afdab827c52f?q=80&w=800&auto=format&fit=crop",isAd:!0,ctaText:"saiba mais",ctaLink:"/marketplace",location:void 0},{id:"user-post-photo-1",authorId:"u-creator-002",username:"@pixel_master",text:"EstratÃ©gias de escala para 2024. O trÃ¡fego pago mudou e vocÃª precisa se adaptar! ğŸ”¥ #Marketing #ROI",time:"2d",timestamp:Date.now()-2880*60*1e3,isPublic:!0,views:8400,likes:920,comments:56,liked:!0,type:"photo",image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=800&auto=format&fit=crop",isAd:!1,location:"SÃ£o Paulo, SP"},{id:"user-post-carousel-1",authorId:"u-creator-002",username:"@pixel_master",text:"3 Passos para criar uma oferta irresistÃ­vel no seu Grupo VIP. Arraste para o lado! â¡ï¸",time:"4d",timestamp:Date.now()-5760*60*1e3,isPublic:!0,views:12e3,likes:2100,comments:89,liked:!1,type:"photo",images:["https://images.unsplash.com/photo-1553481187-be93c21490a9?q=80&w=800&auto=format&fit=crop","https://images.unsplash.com/photo-1552664730-d307ca884978?q=80&w=800&auto=format&fit=crop","https://images.unsplash.com/photo-1557804506-669a67965ba0?q=80&w=800&auto=format&fit=crop"],isAd:!1},{id:"user-reel-1",authorId:"u-creator-002",username:"@pixel_master",text:"Minha rotina de anÃ¡lise de mÃ©tricas matinal. â˜•ğŸ“ˆ #DataScience #Ads",time:"1d",timestamp:Date.now()-1440*60*1e3,isPublic:!0,views:25600,likes:4500,comments:112,liked:!1,type:"video",video:"https://assets.mixkit.co/videos/preview/mixkit-business-charts-on-a-tablet-screen-23053-large.mp4",isAd:!1},{id:"user-reel-2",authorId:"u-creator-002",username:"@pixel_master",text:"Como sair do zero no Flux Marketplace hoje mesmo!",time:"6h",timestamp:Date.now()-360*60*1e3,isPublic:!0,views:5200,likes:890,comments:34,liked:!1,type:"video",video:"https://assets.mixkit.co/videos/preview/mixkit-hand-taking-a-credit-card-out-of-a-wallet-22442-large.mp4",isAd:!1},{id:"user-post-text-1",authorId:"u-creator-002",username:"@pixel_master",text:"Pergunta rÃ¡pida: Qual rede social estÃ¡ dando mais ROI para vocÃªs neste mÃªs? ğŸ’¸",time:"1w",timestamp:Date.now()-10080*60*1e3,isPublic:!0,views:1200,likes:45,comments:203,liked:!1,type:"poll",pollOptions:[{text:"Meta (FB/IG)",votes:85},{text:"TikTok",votes:62},{text:"Google/YouTube",votes:56}],isAd:!1},{id:"post-1",authorId:"u-admin-001",username:"@flux_official",text:"Bem-vindo ao Flux! ğŸš€ Esta Ã© a sua nova plataforma de conexÃ£o e monetizaÃ§Ã£o de comunidades.",time:"Agora",timestamp:Date.now(),isPublic:!0,views:1250,likes:450,comments:12,liked:!1,type:"text",isAd:!1,location:"Sede Global"},{id:"post-3",authorId:"u-star-004",username:"@julia_vendas",text:"Confira os resultados da nossa Ãºltima mentoria de escala. O time estÃ¡ voando! ğŸ“ˆ",time:"15m",timestamp:Date.now()-9e5,isPublic:!0,views:2500,likes:670,comments:42,liked:!1,type:"photo",image:"https://images.unsplash.com/photo-1493246507139-91e8bef99c02?q=80&w=800&auto=format&fit=crop",isAd:!1,relatedGroupId:"g-vip-001"}],m={formatRelativeTime:e=>{const t=Math.floor((Date.now()-e)/1e3);return t<60?"Agora":t<3600?`${Math.floor(t/60)}m`:t<86400?`${Math.floor(t/3600)}h`:new Date(e).toLocaleDateString()},sanitizePost:e=>{const t=u.getCurrentUserId(),s=Array.isArray(e.likedByIds)?e.likedByIds:[];return{...e,id:String(e.id),text:String(e.text||""),authorId:String(e.authorId||""),username:String(e.username||"AnÃ´nimo"),likes:Number(e.likes||0),comments:Number(e.comments||0),views:Number(e.views||0),liked:t?s.includes(t):!!e.liked,images:e.images||void 0,isAd:!!e.isAd,ctaText:e.ctaText||void 0,ctaLink:e.ctaLink||void 0,relatedGroupId:e.relatedGroupId||void 0,isAdultContent:!!e.isAdultContent,location:e.location||void 0}}},y=`${f}/api/posts`,g={async getFeedPaginated(e){try{const t=new AbortController,s=setTimeout(()=>t.abort(),8e3),a=await fetch(`${y}?limit=${e.limit}&cursor=${e.cursor||""}`,{signal:t.signal});if(clearTimeout(s),!a.ok)return console.error("Failed to fetch feed with status:",a.status),{data:[],nextCursor:void 0};const r=await a.json();return{data:(r.data||[]).map(m.sanitizePost),nextCursor:r.nextCursor}}catch(t){return console.error("Failed to fetch feed:",t),{data:[],nextCursor:void 0}}},async searchPosts(e){if(!e.trim())return[];try{const t=await fetch(`${y}/search?q=${encodeURIComponent(e)}`);return t.ok?((await t.json()).data||[]).map(m.sanitizePost):[]}catch(t){return console.error("Failed to search posts:",t),[]}},async getPostById(e){try{const t=await fetch(`${y}/${e}`);if(!t.ok)return;const s=await t.json();return s?m.sanitizePost(s):void 0}catch(t){console.error(`Failed to fetch post ${e}:`,t);return}},async getUserPosts(e){try{const t=await fetch(`${y}/user/${e}`);return t.ok?((await t.json()).data||[]).map(m.sanitizePost):[]}catch(t){return console.error(`Failed to fetch posts for user ${e}:`,t),[]}}},I="flux_viewed_posts_session",p={trackView:async e=>{let t=[];try{t=JSON.parse(sessionStorage.getItem(I)||"[]")}catch{t=[]}if(t.includes(e))return;const s=i.posts.findById(e);if(!s)return;t.push(e),sessionStorage.setItem(I,JSON.stringify(t));const a=u.getCurrentUserId();s.views=(s.views||0)+1,i.posts.update(s);try{fetch(`${f}/api/posts/${e}/interact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,type:"view",action:"add"})}).catch(()=>{})}catch{}},toggleLike:async(e,t)=>{const s=i.posts.findById(e);if(!s)return null;const a=u.getCurrentUserId(),r=t?"remove":"add";if(s.liked=!t,s.likes=Math.max(0,(s.likes||0)+(s.liked?1:-1)),a){const o=new Set(s.likedByIds||[]);s.liked?o.add(a):o.delete(a),s.likedByIds=Array.from(o)}i.posts.update(s);try{fetch(`${f}/api/posts/${e}/interact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,type:"like",action:r})}).catch(()=>{})}catch{}return s},notifyCommentChange:(e,t)=>{const s=i.posts.findById(e);s&&(s.comments=Math.max(0,(s.comments||0)+t),i.posts.update(s))},syncPostObject:e=>{const t=i.posts.findById(e.id);return t?{...e,likes:t.likes,comments:t.comments,views:t.views,liked:t.liked}:e}},v={async toggleLike(e){const t=i.posts.findById(e);if(t)return await p.toggleLike(e,!!t.liked)||void 0},incrementView(e){p.trackView(e)},incrementShare(e){i.posts.findById(e)&&p.trackView(e)}},C=`${f}/api/posts`,k={async addComment(e,t,s,a){const r=u.getCurrentUserId(),o=s.replace(/^@/,""),c={id:Date.now().toString(),userId:r||"user",text:t,username:o,avatar:a,timestamp:Date.now(),replies:[]},d=i.posts.findById(e);if(d){d.commentsList=[c,...d.commentsList||[]],p.notifyCommentChange(e,1),i.posts.update(d);try{fetch(`${C}/${e}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment:c})}).catch(()=>{})}catch{}return c}},addReply(e,t,s,a,r){const o=i.posts.findById(e),c=u.getCurrentUserId();if(o&&o.commentsList){let d,n;for(const l of o.commentsList){if(l.id===t){d=l,n=l.username;break}const h=l.replies?.find(x=>x.id===t);if(h){d=l,n=h.username;break}}if(d){const l={id:"r-"+Date.now(),userId:c||"user",text:s,username:a.replace(/^@/,""),avatar:r,timestamp:Date.now(),replies:[],replyToUsername:n?.replace(/^@/,"")};d.replies=[...d.replies||[],l],p.notifyCommentChange(e,1),i.posts.update(o);try{fetch(`${C}/${e}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parentId:d.id,reply:l})}).catch(()=>{})}catch{}return l}}},async deleteComment(e,t){const s=i.posts.findById(e);if(s){const a=r=>r.filter(o=>o.id===t?!1:(o.replies&&(o.replies=a(o.replies)),!0));return s.commentsList=a(s.commentsList||[]),p.notifyCommentChange(e,-1),i.posts.update(s),!0}return!1},toggleCommentLike(e,t){const s=i.posts.findById(e);if(s&&s.commentsList){const a=r=>{for(const o of r){if(o.id===t)return o.likedByMe=!o.likedByMe,o.likes=(o.likes||0)+(o.likedByMe?1:-1),!0;if(o.replies&&a(o.replies))return!0}return!1};if(a(s.commentsList))return i.posts.update(s),!0}return!1}},S=`${f}/api/posts`,P={async uploadMedia(e,t="feed"){const s=new FormData;return s.append("file",e),s.append("folder",t),(await(await fetch(`${f}/api/upload`,{method:"POST",body:s})).json()).files[0].url},async addPost(e){try{const t=await fetch(`${S}/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){const s=await t.json();s.post&&(e=s.post)}}catch{}i.posts.add(m.sanitizePost(e))},async deletePost(e){i.posts.delete(e);try{await fetch(`${S}/${e}`,{method:"DELETE"})}catch{}}},b={formatRelativeTime:m.formatRelativeTime,sanitizePost:m.sanitizePost,getFeedPaginated:g.getFeedPaginated,searchPosts:g.searchPosts,getPostById:g.getPostById,getUserPosts:g.getUserPosts,toggleLike:v.toggleLike,incrementView:v.incrementView,incrementShare:v.incrementShare,addComment:k.addComment,addReply:k.addReply,deleteComment:k.deleteComment,toggleCommentLike:k.toggleCommentLike,addPost:P.addPost,deletePost:P.deletePost,uploadMedia:P.uploadMedia},A={formatRelativeTime:e=>{const t=Math.floor((Date.now()-e)/1e3);return t<60?"Agora":t<3600?`${Math.floor(t/60)}m`:t<86400?`${Math.floor(t/3600)}h`:new Date(e).toLocaleDateString()},getFeedPaginated:async e=>{await new Promise(n=>setTimeout(n,300));const t=e.limit||15,s=e.cursor;let a=i.posts.getAll();a.length===0&&(w.forEach(n=>i.posts.add(n)),a=i.posts.getAll());const r=a.filter(n=>n.type!=="video"||n.isAd);let o=r;s&&(o=r.filter(n=>n.timestamp<s)),o.sort((n,l)=>l.timestamp-n.timestamp);const c=o.slice(0,t),d=o.length>t?c[c.length-1].timestamp:void 0;return{data:c,nextCursor:d}},searchPosts:async e=>{await new Promise(a=>setTimeout(a,400));const t=e.toLowerCase().trim();return t?i.posts.getAll().filter(a=>(a.text?.toLowerCase().includes(t)||a.username?.toLowerCase().includes(t))&&(a.type!=="video"||a.isAd)):[]},uploadMedia:async e=>URL.createObjectURL(e),addPost:async e=>(i.posts.add(e),Promise.resolve()),toggleLike:async e=>{const t=i.posts.findById(e);if(t)return t.liked=!t.liked,t.likes+=t.liked?1:-1,i.posts.update(t),t},incrementView:e=>{const t=i.posts.findById(e);t&&(t.views++,i.posts.update(t))},getPostById:e=>i.posts.findById(e)||w.find(t=>t.id===e),getUserPosts:e=>{let t=i.posts.getAll();return t.length===0&&(w.forEach(s=>i.posts.add(s)),t=i.posts.getAll()),t.filter(s=>s.authorId===e||s.authorId==="u-creator-002")},deletePost:async e=>(i.posts.delete(e),Promise.resolve()),addComment:async(e,t,s,a)=>{const r=i.posts.findById(e);if(r){const o={id:"c-"+Date.now(),userId:u.getCurrentUserId()||"guest",username:s.replace(/^@/,""),avatar:a,text:t,timestamp:Date.now(),replies:[]};return r.commentsList=[o,...r.commentsList||[]],r.comments++,i.posts.update(r),o}},deleteComment:async(e,t)=>{const s=i.posts.findById(e);if(s){const a=r=>r.filter(o=>o.id===t?!1:(o.replies&&(o.replies=a(o.replies)),!0));return s.commentsList=a(s.commentsList||[]),s.comments--,i.posts.update(s),!0}return!1},incrementShare:e=>{const t=i.posts.findById(e);t&&(t.views+=5,i.posts.update(t))},addReply:(e,t,s,a,r)=>{const o=i.posts.findById(e);if(o&&o.commentsList){let c,d;for(const n of o.commentsList){if(n.id===t){c=n,d=n.username;break}const l=n.replies?.find(h=>h.id===t);if(l){c=n,d=l.username;break}}if(c){const n={id:"r-"+Date.now(),userId:u.getCurrentUserId()||"guest",text:s,username:a.replace(/^@/,""),avatar:r,timestamp:Date.now(),replies:[],replyToUsername:d?.replace(/^@/,"")};return c.replies=[...c.replies||[],n],o.comments++,i.posts.update(o),n}}},toggleCommentLike:(e,t)=>{const s=i.posts.findById(e);if(s&&s.commentsList){const a=r=>{for(const o of r){if(o.id===t)return o.likedByMe=!o.likedByMe,o.likes=(o.likes||0)+(o.likedByMe?1:-1),!0;if(o.replies&&a(o.replies))return!0}return!1};if(a(s.commentsList))return i.posts.update(s),!0}return!1}},$=L?A:b;export{p as P,$ as p};

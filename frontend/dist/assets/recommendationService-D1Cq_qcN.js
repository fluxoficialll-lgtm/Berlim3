import{i as u,G as m,c as T}from"./index-BC19Iu_T.js";class S{static WEIGHTS={FOLLOW_BONUS:5e3,RECENCY_BASE:2e3,ENGAGEMENT_MULTIPLIER:150,DECAY_FACTOR:1.8};static rank(s,i){const o=Date.now(),e=u.relationships.getAll(),r=i.user?e.filter(n=>n.followerId===i.user?.id&&n.status==="accepted").map(n=>n.followingId):[];return s.map(n=>{let a=1e3;r.includes(n.authorId)&&(a+=this.WEIGHTS.FOLLOW_BONUS);const I=Math.max(0,(o-n.timestamp)/(1e3*60*60));a+=this.WEIGHTS.RECENCY_BASE/Math.pow(I+1,this.WEIGHTS.DECAY_FACTOR);const d=n.likes*2+n.comments*5;return a+=d*this.WEIGHTS.ENGAGEMENT_MULTIPLIER,{item:n,score:a}}).sort((n,a)=>a.score-n.score).map(n=>n.item)}}var E={};class p{static WEIGHTS={VIRAL_VELOCITY:300,WATCH_TIME_BOOST:1e3,AI_AFFINITY:2500};static async getSemanticAffinity(s,i){if(!E.API_KEY||!i)return 5;try{const e=await new m({apiKey:E.API_KEY}).models.generateContent({model:"gemini-3-flash-preview",contents:`Analise a afinidade entre o post: "${s}" e o interesse: "${i}". Responda apenas um nÃºmero de 1 a 10.`});return parseInt(e.text?.trim()||"5")}catch{return 5}}static async rank(s,i){return(await Promise.all(s.map(async e=>{let r=5e3;if(r+=e.views*this.WEIGHTS.VIRAL_VELOCITY,i.user?.profile?.bio&&s.indexOf(e)<10){const n=await this.getSemanticAffinity(e.text,i.user.profile.bio);r+=n*this.WEIGHTS.AI_AFFINITY}const c=e.views>0?e.likes/e.views:0;return r+=c*this.WEIGHTS.WATCH_TIME_BOOST,{item:e,score:r}}))).sort((e,r)=>r.score-e.score).map(e=>e.item)}}class A{static WEIGHTS={GEO_PROXIMITY:8e3,TRUST_SCORE:2e3,SALES_VOLUME:500};static rank(s,i){return s.map(e=>{let r=2e3;i.user?.profile?.phone?.startsWith("55")&&e.location.includes("Brasil")&&(r+=this.WEIGHTS.GEO_PROXIMITY);const c=u.users.get(e.sellerId);return c?.trustScore&&(r+=c.trustScore*2),r+=Number(e.soldCount||0)*this.WEIGHTS.SALES_VOLUME,e.isAd&&(r+=15e3),{item:e,score:r}}).sort((e,r)=>r.score-e.score).map(e=>e.item)}}const l={getFeed(t){const s=this.buildContext();return S.rank(t,s)},async getReels(t){const s=this.buildContext();return await p.rank(t,s)},getMarketplace(t){const s=this.buildContext();return A.rank(t,s)},buildContext(){const t=T.getCurrentUser()||void 0;return{user:t,userEmail:t?.email}}},f={trackImpression:t=>{},recordInteraction:(t,s,i,o)=>{},scorePost:(t,s)=>1e3,getRecommendedReels:async t=>await l.getReels(t),getRecommendedFeed:async t=>await l.getFeed(t)};export{f as r};

import{u as C,e as L,r as l,c as j,j as e,f as $}from"./index-BC19Iu_T.js";import{p as g}from"./postService-XFLx8Vj8.js";import{F}from"./FeedItem-DGLoJJDB.js";import{a as b}from"./apiClient-cuuPgksg.js";import{C as E}from"./CommentItem-BgB3JV1X.js";import"./UserBadge-CHMRiDZl.js";import"./UserAvatar-BWaKHm2D.js";const f={async getComments(t){try{return(await b.get(`/posts/${t}/comments`)).data}catch(o){throw console.error(`[FeedCommentService] Erro ao buscar comentários para o post ${t}:`,o),o}},async addComment(t,o){try{return(await b.post(`/posts/${t}/comments`,{content:o})).data}catch(c){throw console.error(`[FeedCommentService] Erro ao adicionar comentário ao post ${t}:`,c),c}},async deleteComment(t){try{await b.delete(`/comments/${t}`)}catch(o){throw console.error(`[FeedCommentService] Erro ao deletar o comentário ${t}:`,o),o}}},R=({postId:t})=>{const o=C(),{showConfirm:c}=L(),m=l.useRef(null),[d,p]=l.useState([]),[w,h]=l.useState(!0),[i,s]=l.useState(""),[r,x]=l.useState(null),v=j.getCurrentUser()?.id,u=l.useCallback(async()=>{h(!0);try{const a=await f.getComments(t);p(a)}catch(a){console.error("Failed to fetch comments:",a)}finally{h(!1)}},[t]);l.useEffect(()=>{u()},[u]);const y=async()=>{if(i.trim())try{r?(await f.addReply(t,r.id,i.trim()),x(null)):await f.addComment(t,i.trim()),s(""),await u()}catch(a){console.error("Failed to send comment:",a)}},k=async a=>{if(await c("Delete Comment","Are you sure you want to delete this comment?","Delete","Cancel"))try{await f.deleteComment(a),await u()}catch(n){console.error("Failed to delete comment:",n)}},N=(a,n)=>{x({id:a,username:n}),setTimeout(()=>m.current?.focus(),100)},S=async a=>{await f.toggleCommentLike(a),p(d.map(n=>n.id===a?{...n,isLiked:!n.isLiked,likes:n.isLiked?n.likes-1:n.likes+1}:n))};return e.jsxs("div",{className:"w-full flex-grow flex flex-col",children:[e.jsxs("div",{className:"p-4 flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8 px-2",children:[e.jsx("div",{className:"h-4 w-1 bg-[#00c2ff] rounded-full shadow-[0_0_10px_#00c2ff]"}),e.jsxs("h3",{className:"text-sm font-black text-white uppercase tracking-[3px]",children:["Comentários (",d.length,")"]})]}),e.jsx("div",{className:"space-y-1",children:w?e.jsx("div",{className:"text-center py-20 opacity-50",children:e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-3xl"})}):d.length>0?d.map(a=>e.jsx(E,{comment:a,onReplyClick:N,onLike:S,onDelete:k,onUserClick:n=>o(`/user/${n.replace("@","")}`),currentUserId:v},a.id)):e.jsxs("div",{className:"text-center py-20 opacity-20 border-2 border-dashed border-white/5 rounded-[32px]",children:[e.jsx("i",{className:"fa-regular fa-comment-dots text-5xl mb-4"}),e.jsx("p",{className:"font-bold uppercase tracking-widest text-xs",children:"Seja o primeiro a comentar"})]})})]}),e.jsxs("div",{className:"sticky bottom-0 w-full z-40 bg-[#1a1e26] border-t border-white/10 p-4 px-6 shadow-[0_-5px_20px_rgba(0,0,0,0.5)]",children:[r&&e.jsxs("div",{className:"flex items-center justify-between py-2 mb-3 bg-[#00c2ff11] px-4 rounded-xl text-xs text-gray-300 border-l-2 border-[#00c2ff] animate-slide-up",children:[e.jsxs("span",{children:["Respondendo a ",e.jsxs("strong",{className:"text-[#00c2ff]",children:["@",r.username.replace(/^@/,"")]})]}),e.jsx("button",{onClick:()=>x(null),className:"text-gray-500 hover:text-white",children:e.jsx("i",{className:"fa-solid fa-xmark"})})]}),e.jsxs("div",{className:"flex gap-3 items-center max-w-[500px] mx-auto",children:[e.jsx("input",{ref:m,type:"text",placeholder:r?`Responda @${r.username.replace(/^@/,"")}...`:"Escreva um comentário...",value:i,onChange:a=>s(a.target.value),onKeyDown:a=>a.key==="Enter"&&y(),className:"flex-grow bg-[#0c0f14] border border-white/10 rounded-2xl px-5 py-3.5 text-white outline-none text-sm focus:border-[#00c2ff] transition-all placeholder-gray-700"}),e.jsx("button",{onClick:y,disabled:!i.trim(),className:"bg-[#00c2ff] w-12 h-12 rounded-2xl flex items-center justify-center text-black disabled:opacity-30 disabled:grayscale transition-all active:scale-90 shadow-lg shadow-[#00c2ff1a]",children:e.jsx("i",{className:"fa-solid fa-paper-plane text-sm"})})]})]})]})},A=()=>{const t=C(),{id:o}=$(),[c,m]=l.useState(null),d=j.getCurrentUserId();l.useEffect(()=>{if(o){const s=g.getPostById(o);s?m(s):t("/feed")}},[o,t]);const p=s=>{g.toggleLike(s).then(r=>{r&&m(r)})},w=async s=>{const r=`${window.location.origin}/#/post/${s.id}`;navigator.share?await navigator.share({url:r}):(navigator.clipboard.writeText(r),alert("Link copiado!"))},h=(s,r)=>{if(c&&c.id===s&&c.votedOptionIndex===null){const x=g.voteOnPoll(s,r);m(x)}},i=s=>{s?.startsWith("http")?window.open(s,"_blank"):s&&t(s)};return c?e.jsxs("div",{className:"min-h-[100dvh] flex flex-col font-['Inter'] overflow-hidden bg-[#0c0f14] text-white",children:[e.jsxs("header",{className:"flex items-center justify-between p-4 bg-[#0c0f14] fixed w-full top-0 z-50 border-b border-white/10 h-[65px]",children:[e.jsx("button",{onClick:()=>t(-1),className:"text-[#00c2ff] text-xl p-2 hover:bg-white/5 rounded-full transition-all",children:e.jsx("i",{className:"fa-solid fa-arrow-left"})}),e.jsx("span",{className:"text-xs font-black uppercase tracking-[2px]",children:"Publicação"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("main",{className:"pt-[75px] pb-[130px] w-full max-w-[500px] mx-auto flex-grow overflow-y-auto no-scrollbar px-3",children:[e.jsx(F,{post:c,currentUserId:d,onLike:p,onDelete:()=>{},onUserClick:s=>t(`/user/${s.replace("@","")}`),onCommentClick:()=>{},onShare:w,onVote:h,onCtaClick:i}),o&&e.jsx(R,{postId:o})]})]}):e.jsx("div",{className:"min-h-screen bg-[#0c0f14] flex items-center justify-center text-white",children:"Carregando..."})};export{A as PostDetails};

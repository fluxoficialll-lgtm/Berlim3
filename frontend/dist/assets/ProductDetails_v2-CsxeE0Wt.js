import{i as e,c as t,r as a,e as s,u as r,j as i,f as l,k as o}from"./index-Bkpya5GW.js";import{m as n}from"./marketplaceService-DFf-X3tk.js";import{C as c}from"./CommentSheet-3zGuwS32.js";import"./CommentItem-Q0Zd2s3l.js";import"./postService-B_maMF9u.js";for(var d,m=[],u=0;u<256;++u)m.push((u+256).toString(16).slice(1));var f=new Uint8Array(16);function p(){if(!d&&!(d="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return d(f)}const x={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function h(e,t,a){if(x.randomUUID&&!e)return x.randomUUID();var s=(e=e||{}).random||(e.rng||p)();return s[6]=15&s[6]|64,s[8]=63&s[8]|128,function(e,t=0){return(m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+"-"+m[e[t+4]]+m[e[t+5]]+"-"+m[e[t+6]]+m[e[t+7]]+"-"+m[e[t+8]]+m[e[t+9]]+"-"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]).toLowerCase()}(s)}const j=async t=>{await new Promise(e=>setTimeout(e,500));return(await e.table("comments").toArray()).filter(e=>e.itemId===t)},g=async(a,s)=>{const r=t.getCurrentUser();if(!r)throw new Error("Usuário não autenticado");await new Promise(e=>setTimeout(e,300));const i={id:h(),itemId:a,text:s,username:r.username||"Usuário Anônimo",avatar:r.avatar,timestamp:Date.now(),likes:0,replies:[]};return await e.table("comments").add(i),i},b=async t=>{await new Promise(e=>setTimeout(e,300));if(!(await e.table("comments").get(t)))throw new Error("Comentário não encontrado");await e.table("comments").delete(t)},v=({isSeller:e,onDelete:t,onReport:a,onMediaClick:s,mediaItems:l})=>{const o=r(),n=l[0];return i.jsxs("div",{className:"relative w-full h-[40vh] bg-black group cursor-pointer",onClick:()=>n&&s(n),children:[n&&i.jsx("img",{src:n.url,alt:"Product Background",className:"absolute inset-0 w-full h-full object-cover opacity-60 group-hover:opacity-70 transition-opacity"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0c0f14] via-transparent to-black/30"}),i.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:i.jsx("div",{className:"w-16 h-16 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300 scale-90",children:i.jsx("i",{className:"fa-solid fa-expand text-white text-2xl"})})}),i.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-10",children:[i.jsx("button",{onClick:e=>{e.stopPropagation(),o(-1)},className:"w-10 h-10 bg-black/40 rounded-full flex items-center justify-center backdrop-blur-sm",children:i.jsx("i",{className:"fa-solid fa-arrow-left text-white"})}),e?i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("button",{onClick:e=>{e.stopPropagation(),o(`/edit-product/${productId}`)},className:"h-10 px-4 bg-black/40 rounded-full flex items-center justify-center backdrop-blur-sm",children:[i.jsx("i",{className:"fa-solid fa-pen-to-square mr-2"})," Editar"]}),i.jsx("button",{onClick:e=>{e.stopPropagation(),t()},className:"w-10 h-10 bg-red-500/50 rounded-full flex items-center justify-center backdrop-blur-sm",children:i.jsx("i",{className:"fa-solid fa-trash"})})]}):i.jsx("button",{onClick:e=>{e.stopPropagation(),a()},className:"w-10 h-10 bg-black/40 rounded-full flex items-center justify-center backdrop-blur-sm",children:i.jsx("i",{className:"fa-solid fa-ellipsis-vertical"})})]})]})},N=({title:e,price:t,location:a,category:s,timestamp:r})=>i.jsxs(i.Fragment,{children:[i.jsx("h1",{className:"product-title",children:e}),i.jsx("div",{className:"product-price",children:"Vagas de Emprego"===s?"A combinar":`R$ ${t.toLocaleString("pt-BR",{minimumFractionDigits:2})}`}),i.jsxs("div",{className:"badges-row",children:[i.jsxs("div",{className:"badge-item",children:[i.jsx("i",{className:"fa-solid fa-location-dot"})," ",a]}),i.jsxs("div",{className:"badge-item",children:[i.jsx("i",{className:"fa-solid fa-tag"})," ",s]}),i.jsxs("div",{className:"badge-item",children:[i.jsx("i",{className:"fa-solid fa-clock"})," ",new Date(r).toLocaleDateString()]})]})]}),y=({sellerName:e,sellerAvatar:t,onClick:a})=>i.jsxs("div",{className:"seller-card",onClick:a,children:[i.jsxs("div",{className:"seller-left",children:[t?i.jsx("img",{src:t,className:"seller-avatar",alt:"Seller"}):i.jsx("div",{className:"seller-avatar bg-gray-700 flex items-center justify-center text-xs",children:i.jsx("i",{className:"fa-solid fa-user"})}),i.jsxs("div",{className:"seller-info",children:[i.jsx("h4",{children:e}),i.jsx("p",{children:"Ver perfil completo"})]})]}),i.jsx("i",{className:"fa-solid fa-chevron-right store-icon"})]}),w=({description:e})=>i.jsxs("div",{className:"desc-section",children:[i.jsxs("h3",{className:"section-header",children:[i.jsx("i",{className:"fa-solid fa-align-left text-[#00c2ff]"})," Detalhes"]}),i.jsx("p",{className:"desc-text",children:e||"Sem descrição fornecida pelo vendedor."})]}),C=({isSeller:e,onDelete:t,onChat:a})=>i.jsx("div",{className:"bottom-bar",children:e?i.jsxs("button",{className:"action-btn btn-danger",onClick:t,children:[i.jsx("i",{className:"fa-solid fa-trash"})," Excluir Anúncio"]}):i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"action-btn btn-secondary",onClick:()=>{alert("Adicionado aos favoritos!")},children:i.jsx("i",{className:"fa-regular fa-heart"})}),i.jsxs("button",{className:"action-btn btn-primary",onClick:a,children:[i.jsx("i",{className:"fa-brands fa-whatsapp"})," Conversar / Negociar"]})]})}),k=({media:e,onClose:t})=>e?i.jsxs("div",{className:"fixed inset-0 z-[60] bg-black bg-opacity-95 flex items-center justify-center p-2",onClick:t,children:[i.jsx("button",{className:"absolute top-4 right-4 text-white text-4xl bg-black/50 rounded-full w-10 h-10 flex items-center justify-center z-50",onClick:t,children:"×"}),"video"===e.type?i.jsx("video",{src:e.url,controls:!0,autoPlay:!0,className:"max-w-full max-h-full object-contain shadow-2xl",onClick:e=>e.stopPropagation()}):i.jsx("img",{src:e.url,alt:"Zoom",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",onClick:e=>e.stopPropagation()})]}):null,S=()=>{const e=r(),{id:d}=l(),{showConfirm:m,showAlert:u}=s(),[f,p]=a.useState(null),[x,h]=a.useState(!0),[S,I]=a.useState(!1),[U,D]=a.useState(null),[P,E]=a.useState(!1),A=t.getCurrentUser(),R=null==A?void 0:A.id,{comments:T,loading:$,addComment:V,deleteComment:z}=(e=>{const[t,r]=a.useState([]),[i,l]=a.useState(!0),[o,n]=a.useState(null),{showConfirm:c}=s(),d=a.useCallback(async()=>{if(e){l(!0);try{const t=await j(e);r(t),n(null)}catch(t){n("Não foi possível carregar os comentários.")}finally{l(!1)}}},[e]);return a.useEffect(()=>{d()},[d]),{comments:t,loading:i,error:o,fetchComments:d,addComment:async t=>{if(t.trim())try{await g(e,t.trim()),await d()}catch(a){n("Não foi possível enviar o seu comentário.")}},deleteComment:async e=>{if(await c("Excluir comentário","Deseja realmente excluir este comentário?"))try{await b(e),await d()}catch(t){n("Não foi possível excluir o comentário.")}}}})(d||""),[L,q]=a.useState(""),[B,F]=a.useState(null);a.useEffect(()=>{if(d){const t=n.getItemById(d);t?(p(t),!A||A.email!==t.sellerId&&A.id!==t.sellerId||I(!0)):(u("Erro","Produto não encontrado."),e("/marketplace"))}h(!1)},[d,A,e,u]);const M=()=>{m("Excluir Anúncio","Tem certeza que deseja excluir permanentemente?","Excluir","Cancelar").then(t=>{t&&d&&(n.deleteItem(d),e("/marketplace",{replace:!0}))})},O=a.useMemo(()=>{var e;return f?[{type:"video",url:f.video},{type:"image",url:f.image},...(null==(e=f.images)?void 0:e.map(e=>({type:"image",url:e})))||[]].filter(e=>e.url):[]},[f]);return x||!f?i.jsx("div",{className:"min-h-screen bg-[#0c0f14] flex items-center justify-center text-white",children:i.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-2xl"})}):i.jsxs("div",{className:"min-h-screen bg-[#0c0f14] text-white font-['Inter'] flex flex-col relative pb-[90px]",children:[i.jsx(v,{isSeller:S,productId:f.id,onDelete:M,onReport:()=>u("Reportado","Obrigado!"),mediaItems:O,onMediaClick:e=>D(e)}),i.jsx("div",{className:"product-container -mt-16 relative z-10",children:i.jsxs("div",{className:"details-wrapper",children:[i.jsx(N,{title:f.title,price:f.price,location:f.location,category:f.category,timestamp:f.timestamp}),i.jsx(y,{sellerName:f.sellerName||"Vendedor",sellerAvatar:f.sellerAvatar,onClick:()=>{f&&e(`/user/${f.sellerName}`,{state:{activeTab:"products"}})}}),i.jsx(w,{description:f.description}),i.jsxs("button",{className:"qa-trigger-btn",onClick:()=>E(!0),children:[i.jsxs("span",{className:"font-bold text-sm",children:[i.jsx("i",{className:"fa-regular fa-comments mr-2 text-[#00c2ff]"})," Perguntas (",T.length,")"]}),i.jsx("i",{className:"fa-solid fa-chevron-right text-xs"})]})]})}),i.jsx(C,{isSeller:S,onDelete:M,onChat:async t=>{if(t.stopPropagation(),A&&f&&!S)try{const t=await o.startChatWithProductContext(f.sellerId,f.id);e(`/chat/${t}`)}catch(a){u("Erro","Não foi possível iniciar a conversa. Tente novamente.")}}}),i.jsx(k,{media:U,onClose:()=>D(null)}),i.jsx(c,{isOpen:P,onClose:()=>E(!1),title:`Perguntas (${T.length})`,comments:T,loading:$,commentText:L,onCommentTextChange:q,onSend:async()=>{L.trim()&&f&&A&&(B?(F(null),q("")):(await V(L),q("")))},onLike:e=>{f&&n.toggleCommentLike(f.id,e)},onDelete:z,onUserClick:t=>e(`/user/${t.replace("@","")}`),currentUserId:R,replyingTo:B,onCancelReply:()=>F(null),onReplyClick:(e,t)=>F({id:e,username:t}),placeholder:S?"Responda a dúvida...":"Escreva sua dúvida..."})]})};export{S as ProductDetailsV2};

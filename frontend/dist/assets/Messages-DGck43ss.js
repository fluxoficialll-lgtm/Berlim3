import{j as e,u as s,r as t,c as l,k as a,i,n}from"./index-CipjSFYz.js";import{M as o}from"./MainHeader-DNJS5o1U.js";import{U as r}from"./UserAvatar-BSqXD0cQ.js";const c=({isOpen:s,onClose:t,onSelectMode:l,onMarkAllRead:a,onViewBlocked:i})=>{if(!s)return null;const n=[{label:"Selecionar conversas",icon:"fa-solid fa-check-double",onClick:l},{label:"Marcar todas como lidas",icon:"fa-solid fa-envelope-open-text",onClick:a},{label:"Usuários Bloqueados",icon:"fa-solid fa-user-shield",onClick:i}];return e.jsx("div",{className:"fixed inset-0 z-[100] bg-transparent",onClick:t,children:e.jsx("div",{className:"absolute top-[70px] left-4 w-[240px] bg-[#1a1e26] rounded-2xl p-2 shadow-2xl animate-pop-in border border-white/10",onClick:e=>e.stopPropagation(),children:e.jsx("div",{className:"flex flex-col gap-1",children:n.map((s,l)=>e.jsxs("button",{onClick:()=>{s.onClick(),t()},className:"w-full flex items-center gap-3 p-3 hover:bg-white/5 text-white rounded-xl transition-all active:scale-[0.98]",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center bg-[#00c2ff1a] flex-shrink-0",children:e.jsx("i",{className:`${s.icon} text-[#00c2ff] text-xs`})}),e.jsx("span",{className:"font-bold text-xs",children:s.label})]},l))})})})},d=({contact:s,isSelected:t,isSelectionMode:l,onClick:a,onAvatarClick:i})=>e.jsxs("div",{className:"flex items-center p-3 border-b border-white/5 cursor-pointer transition-all relative "+(t?"bg-[#00c2ff]/10":"hover:bg-white/[0.02]"),onClick:a,children:[l&&e.jsx("div",{className:"w-5 h-5 rounded-full border-2 mr-4 flex items-center justify-center flex-shrink-0 "+(t?"bg-[#00c2ff] border-[#00c2ff]":"border-gray-600"),children:t&&e.jsx("span",{className:"text-[10px] text-black font-bold",children:"✔"})}),e.jsxs("div",{className:"relative flex-shrink-0 mr-4",children:[e.jsx(r,{src:s.avatar,className:"w-[50px] h-[50px]",onClick:i}),s.isOnline&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-[#00ff82] rounded-full border-2 border-[#0c0f14]"})]}),e.jsxs("div",{className:"flex flex-col flex-grow min-w-0 mr-2.5",children:[e.jsx("div",{className:"font-bold text-base mb-0.5 whitespace-nowrap overflow-hidden text-ellipsis text-white",children:s.name}),e.jsx("div",{className:"text-sm whitespace-nowrap overflow-hidden text-ellipsis "+(s.unreadCount>0?"text-white font-semibold":"text-gray-400"),children:s.lastMessage})]}),e.jsxs("div",{className:"flex flex-col items-end flex-shrink-0",children:[e.jsx("div",{className:"text-[10px] uppercase font-bold "+(s.unreadCount>0?"text-[#00c2ff]":"text-gray-500"),children:s.time}),s.unreadCount>0&&e.jsx("div",{className:"bg-[#ff4d4d] text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[20px] text-center mt-1",children:s.unreadCount})]})]}),f=()=>e.jsxs("div",{className:"text-center py-20 opacity-20",children:[e.jsx("i",{className:"fa-regular fa-comment-dots text-5xl mb-4"}),e.jsx("p",{className:"font-bold uppercase tracking-widest text-sm",children:"Sem conversas privadas"})]}),x=({uiVisible:t,unreadMsgs:l,unreadNotifs:a})=>{const i=s();return e.jsxs("footer",{className:"fixed bottom-0 left-0 w-full bg-[#0c0f14] flex justify-around py-3.5 rounded-t-2xl z-20 shadow-[0_-2px_10px_rgba(0,0,0,0.5)] transition-transform duration-300 "+(t?"translate-y-0":"translate-y-full"),children:[e.jsx("button",{onClick:()=>i("/feed"),className:"text-[#00c2ff] text-[22px] p-2",children:e.jsx("i",{className:"fa-solid fa-newspaper"})}),e.jsxs("button",{className:"text-white text-[22px] p-2 relative",children:[e.jsx("i",{className:"fa-solid fa-comments"}),l>0&&e.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 bg-[#ff4d4d] rounded-full"})]}),e.jsxs("button",{onClick:()=>i("/notifications"),className:"text-[#00c2ff] text-[22px] p-2 relative",children:[e.jsx("i",{className:"fa-solid fa-bell"}),a>0&&e.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 bg-[#ff4d4d] rounded-full"})]}),e.jsx("button",{onClick:()=>i("/profile"),className:"text-[#00c2ff] text-[22px] p-2",children:e.jsx("i",{className:"fa-solid fa-user"})})]})},u=()=>{const r=s(),[u,m]=t.useState(!0),p=t.useRef(null),[h,b]=t.useState([]),[g,j]=t.useState(!1),[v,w]=t.useState(!1),[N,C]=t.useState([]),[k,S]=t.useState(0),[M,y]=t.useState(0),A=e=>{if(!e)return"Offline";if(Date.now()-e<12e4)return"online";const s=new Date(e);return`Visto por último às ${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`},_=t.useCallback(()=>{const e=l.getCurrentUserEmail();if(!e)return;const s=e.toLowerCase(),t=a.getAllChats(),n=Object.values(t).map(e=>{var t,l,a,n,o,r;const c=e.id.toString().toLowerCase();if(!c.includes("@")||!c.includes(s))return null;const d=e.messages.filter(e=>(e.senderEmail||e.senderId||"").toLowerCase()!==s&&"read"!==e.status).length,f=e.messages.length>0?e.messages[e.messages.length-1]:null;if(!f)return null;const x=(((null==(t=f.senderEmail)?void 0:t.toLowerCase())||(null==(l=f.senderId)?void 0:l.toLowerCase()))===s?"Você: ":"")+("text"===f.contentType?f.text:"Mídia"),u=c.split("_").find(e=>e.toLowerCase()!==s);let m,p,h=e.contactName,b="";return u&&(p=Object.values(i.users.getAll()).find(e=>e.email.toLowerCase()===u.toLowerCase()),p&&(h=(null==(a=p.profile)?void 0:a.nickname)||(null==(n=p.profile)?void 0:n.name)||"Usuário",b=(null==(o=p.profile)?void 0:o.name)||"",m=null==(r=p.profile)?void 0:r.photoUrl)),{id:e.id.toString(),name:h,handle:b,avatar:m,lastMessage:x,lastMessageTime:f.id,time:f.timestamp,status:A(null==p?void 0:p.lastSeen),isOnline:"online"===A(null==p?void 0:p.lastSeen),unreadCount:d}}).filter(e=>null!==e).sort((e,s)=>s.lastMessageTime-e.lastMessageTime);b(n)},[]);t.useEffect(()=>{_();const e=i.subscribe("chats",_),s=i.subscribe("users",_);return()=>{e(),s()}},[_]),t.useEffect(()=>{const e=()=>{S(n.getUnreadCount()),y(a.getUnreadCount())};e();const s=i.subscribe("notifications",e),t=i.subscribe("chats",e);return()=>{s(),t()}},[]);return e.jsxs("div",{className:"h-[100dvh] bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-hidden",children:[e.jsx(o,{leftContent:v?e.jsx("button",{onClick:()=>{w(!1),C([])},className:"text-[#00c2ff] text-lg",children:e.jsx("i",{className:"fa-solid fa-xmark"})}):e.jsx("button",{onClick:()=>j(!0),className:"text-[#00c2ff] text-lg",children:e.jsx("i",{className:"fa-solid fa-sliders"})}),rightContent:v?e.jsx("button",{onClick:()=>{window.confirm("Apagar?")&&(w(!1),C([]))},disabled:0===N.length,className:"text-[#ff4d4d] text-lg disabled:opacity-30",children:e.jsx("i",{className:"fa-solid fa-trash"})}):e.jsx("button",{onClick:()=>r("/groups"),className:"text-[#00c2ff] text-lg",children:e.jsx("i",{className:"fa-solid fa-users"})})}),e.jsxs("main",{ref:p,className:"flex-grow pt-[80px] pb-[100px] overflow-y-auto no-scrollbar",children:[v&&e.jsxs("div",{className:"w-full text-center py-2 bg-[#0f2b38] font-bold text-xs sticky top-0 z-10",children:[N.length," selecionada(s)"]}),e.jsx("div",{className:"w-full",children:h.length>0?h.map(s=>e.jsx(d,{contact:s,isSelected:N.includes(s.id),isSelectionMode:v,onClick:()=>(e=>{v?C(s=>s.includes(e.id)?s.filter(s=>s!==e.id):[...s,e.id]):r(`/chat/${e.id}`)})(s),onAvatarClick:e=>((e,s)=>{e.stopPropagation(),s&&r(`/user/${s.replace("@","")}`)})(e,s.handle)},s.id)):e.jsx(f,{})})]}),e.jsx(x,{uiVisible:u,unreadMsgs:M,unreadNotifs:k}),e.jsx(c,{isOpen:g,onClose:()=>j(!1),onSelectMode:()=>w(!0),onMarkAllRead:()=>{a.markAllAsRead(),_()},onViewBlocked:()=>r("/blocked-users")})]})};export{u as Messages};

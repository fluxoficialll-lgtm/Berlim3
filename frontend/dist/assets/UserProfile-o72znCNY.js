import{r as e,j as s,u as t,a as o,f as a,e as n,i,c as l,k as r,x as c}from"./index-CipjSFYz.js";import{p as d}from"./postService-0_arHZ6V.js";import{m as p}from"./marketplaceService-C3sj9O_N.js";import{F as f}from"./FeedItem-uWP6OEIi.js";import{A as x}from"./UserBadge-DbbG-9AU.js";import{F as m}from"./Footer-CKHcXoCt.js";import{M as u}from"./MainHeader-DNJS5o1U.js";import{P as h,a as g,b}from"./ProfileProductsGrid-DKB7aS6T.js";import"./UserAvatar-BSqXD0cQ.js";import"./ProductCard-CMhsnpTX.js";const j=({onBack:t,onLogoClick:o,isMe:a,isBlocked:n,onToggleBlock:i,onReport:l,username:r})=>{const[c,d]=e.useState(!1),p=e.useRef(null);return e.useEffect(()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),s.jsxs(s.Fragment,{children:[s.jsx("style",{children:"\n                .profile-dropdown { \n                    position: absolute; \n                    top: 40px; \n                    right: 0; \n                    background: #1a1e26; \n                    border: 1px solid rgba(255,255,255,0.1); \n                    border-radius: 12px; \n                    width: 160px; \n                    display: flex; \n                    flex-direction: column; \n                    overflow: hidden; \n                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6); \n                    z-index: 60; \n                    animation: popIn 0.2s ease-out;\n                }\n                .profile-dropdown button { \n                    padding: 12px 16px; \n                    text-align: left; \n                    font-size: 13px; \n                    color: #fff; \n                    background: none;\n                    border: none;\n                    border-bottom: 1px solid rgba(255,255,255,0.05); \n                    display: flex; \n                    align-items: center; \n                    gap: 10px; \n                    cursor: pointer;\n                    transition: 0.2s;\n                }\n                .profile-dropdown button:hover { background: rgba(255,255,255,0.05); }\n                .profile-dropdown button.danger { color: #ff4d4d; }\n                \n                @keyframes popIn {\n                    from { transform: scale(0.9) translateY(-10px); opacity: 0; }\n                    to { transform: scale(1) translateY(0); opacity: 1; }\n                }\n            "}),s.jsx(u,{leftContent:s.jsx("button",{onClick:t,className:"text-[#00c2ff] text-xl",children:s.jsx("i",{className:"fa-solid fa-arrow-left"})}),onLogoClick:o,rightContent:s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:()=>d(!c),className:"text-[#00c2ff] text-xl p-2",children:s.jsx("i",{className:"fa-solid fa-ellipsis-vertical"})}),c&&s.jsxs("div",{ref:p,className:"profile-dropdown",children:[s.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(window.location.href),d(!1),alert("Link copiado!")},children:[s.jsx("i",{className:"fa-solid fa-link text-[#00c2ff]"})," Copiar Link"]}),!a&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:()=>{l(),d(!1)},children:[s.jsx("i",{className:"fa-solid fa-flag text-gray-400"})," Denunciar"]}),s.jsxs("button",{className:"danger",onClick:()=>{i(),d(!1)},children:[s.jsx("i",{className:"fa-solid fa-ban"})," ",n?"Desbloquear":"Bloquear"]})]})]})]})})]})},v=({avatar:e,nickname:t,username:o,bio:a,stats:n,isMe:i,isBlocked:l,relationStatus:r,isFollowLoading:c,canMessage:d,onFollowClick:p,onMessageClick:f,onAvatarClick:x})=>l?null:s.jsxs("div",{className:"profile-card-box",children:[e?s.jsx("img",{src:e,className:"profile-avatar",onClick:x,alt:t}):s.jsx("div",{className:"profile-placeholder",children:s.jsx("i",{className:"fa-solid fa-user"})}),s.jsx("span",{className:"profile-nickname",children:t}),s.jsx("span",{className:"profile-handle",children:o}),s.jsxs("div",{className:"profile-stats-container",children:[s.jsxs("div",{className:"stat-box",children:[s.jsx("span",{className:"stat-value",children:n.posts}),s.jsx("span",{className:"stat-label",children:"Posts"})]}),s.jsxs("div",{className:"stat-box",children:[s.jsx("span",{className:"stat-value",children:n.followers}),s.jsx("span",{className:"stat-label",children:"Seguidores"})]}),s.jsxs("div",{className:"stat-box",children:[s.jsx("span",{className:"stat-value",children:n.following}),s.jsx("span",{className:"stat-label",children:"Seguindo"})]})]}),s.jsx("p",{className:"profile-bio",children:a}),!i&&s.jsxs("div",{className:"profile-actions",children:[s.jsx("button",{id:"followButton",className:"following"===r?"is-following":"requested"===r?"request-sent":"",onClick:p,disabled:c,children:c?s.jsx("i",{className:"fa-solid fa-circle-notch fa-spin"}):"following"===r?"Seguindo":"requested"===r?"Solicitado":"Seguir"}),d&&s.jsxs("button",{id:"messageButton",onClick:f,children:[s.jsx("i",{className:"fa-solid fa-comment-dots mr-2"})," Mensagem"]})]})]}),w=()=>s.jsxs("div",{className:"flex flex-col items-center justify-center p-10 text-center text-gray-500 animate-fade-in mt-10",children:[s.jsx("div",{className:"w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-6",children:s.jsx("i",{className:"fa-solid fa-user-slash text-4xl opacity-30"})}),s.jsx("h2",{className:"text-white text-lg font-bold mb-2",children:"Perfil Indisponível"}),s.jsx("p",{className:"text-sm max-w-[250px] leading-relaxed",children:"Você não pode visualizar as informações deste usuário no momento."})]}),k=()=>s.jsxs("div",{className:"flex flex-col items-center p-20 text-gray-500 animate-fade-in",children:[s.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-6 border border-white/10",children:s.jsx("i",{className:"fa-solid fa-lock text-2xl opacity-40"})}),s.jsx("h2",{className:"text-white font-bold text-lg mb-1",children:"Esta conta é privada"}),s.jsx("p",{className:"text-sm text-center",children:"Siga para ver as publicações e fotos."})]}),N=()=>{const u=t(),N=o(),{username:y}=a(),{showAlert:C}=n(),S=e.useRef(null),[B,F]=e.useState("posts"),[L,I]=e.useState(null),[z,M]=e.useState([]),[P,U]=e.useState([]),[E,T]=e.useState(!1),[$,q]=e.useState(!1),[D,O]=e.useState(""),[R,_]=e.useState(!0),[A,W]=e.useState(!1),[V,H]=e.useState("none"),[Y,G]=e.useState(!1),[K,J]=e.useState(!1);e.useEffect(()=>{N.state&&N.state.activeTab&&F(N.state.activeTab)},[N.state]);const Q=async()=>{var e,s,t,o,a,n,i,f,x;const m=(y?y.startsWith("@")?y:`@${y}`:"@usuario").replace("@","").toLowerCase().trim(),u=null==(e=N.state)?void 0:e.emailFallback,h=l.getCurrentUser(),g=await l.fetchUserByHandle(m,u);let b=!1;if(h&&(null==(s=h.profile)?void 0:s.name)===m&&(b=!0),g){if(O(g.email),null==h?void 0:h.email){const e=r.hasBlockingRelationship(h.email,g.email)||r.hasBlockingRelationship(h.email,m);G(e)}const e=c.getFollowers((null==(t=g.profile)?void 0:t.name)||""),s=c.getFollowing(g.id),l=d.getUserPosts(g.id);M(l.sort((e,s)=>s.timestamp-e.timestamp));const u=p.getItems().filter(e=>e.sellerId===g.email||e.sellerId===g.id);U(u.sort((e,s)=>s.timestamp-e.timestamp));const j={username:`@${null==(o=g.profile)?void 0:o.name}`,nickname:(null==(a=g.profile)?void 0:a.nickname)||(null==(n=g.profile)?void 0:n.name),avatar:null==(i=g.profile)?void 0:i.photoUrl,bio:(null==(f=g.profile)?void 0:f.bio)||"Sem biografia.",stats:{posts:l.length,followers:e.length,following:s.length}};I(j),T((null==(x=g.profile)?void 0:x.isPrivate)||!1),q(b),H(c.isFollowing(j.username))}_(!1)};e.useEffect(()=>{Q();const e=i.subscribe("users",Q),s=i.subscribe("relationships",Q),t=i.subscribe("posts",Q),o=i.subscribe("chats",Q);return()=>{e(),s(),t(),o()}},[y]);const X=e=>{M(s=>s.map(s=>s.id===e?{...s,liked:!s.liked,likes:s.likes+(s.liked?-1:1)}:s)),d.toggleLike(e)},Z=(e,s)=>{M(t=>t.map(t=>{if(t.id===e&&t.pollOptions&&null==t.votedOptionIndex){const e=[...t.pollOptions];return e[s].votes+=1,{...t,pollOptions:e,votedOptionIndex:s}}return t}))},ee=$||!E||"following"===V,se=!($||E&&"following"!==V);return R||!L?s.jsx("div",{className:"min-h-screen bg-[#0c0f14] flex items-center justify-center text-white",children:s.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-2xl text-[#00c2ff]"})}):s.jsxs("div",{className:"h-screen bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-hidden",children:[s.jsx("style",{children:"\n            main { flex-grow: 1; overflow-y: auto; padding-top: 80px; padding-bottom: 100px; scroll-behavior: smooth; }\n            .profile-card-box { background: rgba(30, 35, 45, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px; padding: 30px 20px; width: 90%; max-width: 400px; display: flex; flex-direction: column; align-items: center; margin: 0 auto 20px auto; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); }\n            .profile-avatar { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 4px solid #00c2ff; margin-bottom: 15px; background: #1e2531; cursor: pointer; }\n            .profile-placeholder { width: 100px; height: 100px; border-radius: 50%; background: #1e2531; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #00c2ff; border: 4px solid #00c2ff; margin-bottom: 15px; }\n            .profile-nickname { font-size: 24px; font-weight: 800; color: #fff; margin-bottom: 2px; }\n            .profile-handle { font-size: 14px; color: #00c2ff; margin-bottom: 15px; }\n            .profile-stats-container { display: flex; justify-content: space-around; width: 100%; margin: 20px 0; border-top: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(255,255,255,0.1); padding: 15px 0; }\n            .stat-box { display: flex; flex-direction: column; align-items: center; cursor: pointer; flex: 1; }\n            .stat-value { font-size: 18px; font-weight: 800; color: #fff; }\n            .stat-label { font-size: 11px; color: #aaa; text-transform: uppercase; margin-top: 4px; }\n            .profile-bio { font-size: 14px; color: #e0e0e0; text-align: center; line-height: 1.5; margin-bottom: 15px; max-width: 90%; }\n            .profile-actions { display: flex; gap: 10px; width: 100%; justify-content: center; margin-top: 10px; }\n            .profile-actions button { flex: 1; max-width: 140px; padding: 12px; border-radius: 12px; font-weight: 700; font-size: 14px; border: none; cursor: pointer; }\n            #followButton { background: #00c2ff; color: #0c0f14; }\n            #followButton.is-following { background: transparent; border: 1px solid #aaa; color: #fff; }\n            #followButton.request-sent { background: transparent; border: 1px dashed #aaa; color: #aaa; }\n            #messageButton { background: rgba(255,255,255,0.05); color: #fff; border: 1px solid rgba(255,255,255,0.1); }\n            .post-list { padding: 0 10px; display: flex; flex-direction: column; }\n            .no-content { text-align: center; color: #666; padding: 40px 0; font-size: 14px; width: 100%; }\n        "}),s.jsx(j,{onBack:()=>u(-1),onLogoClick:()=>{var e;return null==(e=S.current)?void 0:e.scrollTo({top:0,behavior:"smooth"})},isMe:$,isBlocked:Y,onToggleBlock:()=>{const e=r.toggleBlockByContactName(L.username);G(e)},onReport:()=>alert("Denunciar usuário"),username:L.username}),s.jsx("main",{ref:S,className:"no-scrollbar",children:s.jsx("div",{style:{width:"100%",maxWidth:"500px",margin:"0 auto"},children:Y?s.jsx(w,{}):s.jsxs(s.Fragment,{children:[s.jsx(v,{avatar:L.avatar,nickname:L.nickname,username:L.username,bio:L.bio,stats:L.stats,isMe:$,isBlocked:Y,relationStatus:V,isFollowLoading:A,canMessage:se,onFollowClick:async()=>{if(!A){W(!0);try{if("following"===V||"requested"===V)window.confirm(`Deixar de seguir ${L.username}?`)&&(await c.unfollowUser(L.username),H("none"));else{const e=await c.followUser(L.username);H(e)}}catch(e){C("Erro",e.message||"Erro de conexão.")}finally{W(!1)}}},onMessageClick:()=>{const e=l.getCurrentUserEmail();if(e&&D){const s=r.getPrivateChatId(e,D);u(`/chat/${s}`)}},onAvatarClick:()=>J(!0)}),ee?s.jsxs("div",{className:"animate-fade-in",children:[s.jsx(h,{activeTab:B,setActiveTab:F,hasProducts:P.length>0}),s.jsxs("div",{className:"tab-content px-2 pb-10",children:["posts"===B&&s.jsx("div",{className:"post-list px-3",children:z.filter(e=>"video"!==e.type&&"photo"!==e.type).length>0?z.filter(e=>"video"!==e.type&&"photo"!==e.type).map(e=>s.jsx(f,{post:e,onLike:X,onDelete:()=>{},onUserClick:Q,onCommentClick:e=>u(`/post/${e}`),onShare:()=>{},onVote:Z,onCtaClick:e=>(null==e?void 0:e.startsWith("http"))?window.open(e,"_blank"):u(e||"")},e.id)):s.jsx("div",{className:"no-content",children:"Nenhum post."})}),"products"===B&&s.jsx(g,{products:P,onProductClick:e=>u(`/marketplace/product/${e}`)}),"fotos"===B&&s.jsx("div",{className:"post-list px-3",children:z.filter(e=>"photo"===e.type).length>0?z.filter(e=>"photo"===e.type).map(e=>s.jsx(f,{post:e,onLike:X,onDelete:()=>{},onUserClick:Q,onCommentClick:e=>u(`/post/${e}`),onShare:()=>{},onVote:Z,onCtaClick:e=>(null==e?void 0:e.startsWith("http"))?window.open(e,"_blank"):u(e||"")},e.id)):s.jsx("div",{className:"no-content",children:"Nenhuma foto."})}),"reels"===B&&s.jsx(b,{reels:z.filter(e=>"video"===e.type),onReelClick:e=>u(`/reels/${e.id}`,{state:{authorId:D}}),onDelete:()=>{}})]})]}):s.jsx(k,{})]})})}),s.jsx(m,{}),s.jsx(x,{isOpen:K,onClose:()=>J(!1),imageSrc:(null==L?void 0:L.avatar)||"",username:(null==L?void 0:L.nickname)||""})]})};export{N as UserProfile};

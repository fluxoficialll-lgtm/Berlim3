import{u as me,f as fe,r as o,g as H,j as e}from"./index-BC19Iu_T.js";import{p as J}from"./postService-XFLx8Vj8.js";import{C as ge}from"./CurrencySelectorModal-XBEkBh7D.js";import{U as he}from"./UploadProgressCard-CTKpf9n9.js";const ke=()=>{const l=me(),{id:g}=fe(),[S,D]=o.useState(""),[T,M]=o.useState(""),[h,P]=o.useState(void 0),[b,K]=o.useState(null),[z,c]=o.useState(""),[p,F]=o.useState("BRL"),[v,V]=o.useState("lifetime"),[Q,_]=o.useState(""),[j,X]=o.useState(null),[u,U]=o.useState(""),[A,G]=o.useState(""),[R,y]=o.useState("inactive"),[be,ve]=o.useState(!1),[Z,w]=o.useState(!1),[je,ee]=o.useState(!1),[te,B]=o.useState(!1),[x,m]=o.useState([]),[E,O]=o.useState(""),[L,$]=o.useState(""),[f,N]=o.useState(!1),[oe,C]=o.useState(0),[ie,k]=o.useState(0),[re,ae]=o.useState(0);o.useEffect(()=>{if(!g){l("/groups");return}const t=H.getGroupById(g);if(!t){alert("Grupo não encontrado."),l("/groups");return}if(X(t),D(t.name),M(t.description),P(t.coverImage),U(t.pixelId||""),G(t.pixelToken||""),t.pixelId&&y("active"),t.price){const i=parseFloat(t.price);isNaN(i)?c(t.price):c(i.toLocaleString("pt-BR",{minimumFractionDigits:2}))}F(t.currency||"BRL"),V(t.accessType||"lifetime"),_(t.expirationDate||""),t.vipDoor&&(O(t.vipDoor.text||""),$(t.vipDoor.buttonText||""),t.vipDoor.mediaItems?m(t.vipDoor.mediaItems):t.vipDoor.media&&m([{url:t.vipDoor.media,type:t.vipDoor.mediaType||"image"}]))},[g,l]),o.useEffect(()=>{u.length>5?y("active"):y("inactive")},[u]);const se=t=>{const i=t.target.files?.[0];if(i){K(i);const r=new FileReader;r.onload=a=>P(a.target?.result),r.readAsDataURL(i)}},ne=t=>{const i=t.target.files;if(!i)return;const r=Array.from(i);if(x.length+r.length>10){alert("Máximo de 10 mídias.");return}const a=r.map(n=>({file:n,url:URL.createObjectURL(n),type:n.type.startsWith("video/")?"video":"image"}));m(n=>[...n,...a])},le=t=>{m(i=>i.filter((r,a)=>a!==t))},q=t=>{V(t),t==="temporary"?ee(!0):_("")},de=t=>{let i=t.target.value;if(i=i.replace(/\D/g,""),i===""){c("");return}const r=parseFloat(i)/100;c(r.toLocaleString("pt-BR",{minimumFractionDigits:2}))},ce=async t=>{if(t.preventDefault(),!j||f)return;const i=z.replace(/\./g,"").replace(",","."),r=parseFloat(i);if(j.isVip&&(isNaN(r)||r<6)){alert("⚠️ O preço mínimo para um grupo VIP é R$ 6,00.");return}N(!0);try{const a=x.filter(s=>s.file),n=x.filter(s=>!s.file),I=a.length+(b?1:0);ae(I),k(0),C(0);let W=h,d=0;b&&(d++,k(d),W=await J.uploadMedia(b,"avatars"),C(Math.round(d/I*100)));const Y=[];for(const s of a){d++,k(d);const xe=await J.uploadMedia(s.file,"vips_doors");Y.push({url:xe,type:s.type}),C(Math.round(d/I*100))}const pe=[...n.map(s=>({url:s.url,type:s.type})),...Y],ue={...j,name:S,description:T,coverImage:W,price:r.toString(),currency:p,accessType:v,expirationDate:Q,vipDoor:{mediaItems:pe,text:E,buttonText:L},pixelId:u||void 0,pixelToken:A||void 0};await H.updateGroup(ue),setTimeout(()=>{N(!1),l("/groups")},800)}catch{alert("Erro ao atualizar grupo."),N(!1)}};return e.jsxs("div",{className:"min-h-screen bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-x-hidden",children:[e.jsx("style",{children:`
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter',sans-serif; }
        header { display:flex; align-items:center; justify-content:space-between; padding:16px 32px; background: #0c0f14; position:fixed; width:100%; z-index:10; border-bottom:1px solid rgba(255,255,255,0.1); top: 0; height: 80px; }
        header button { background:none; border:none; color:#00c2ff; font-size:18px; cursor:pointer; transition:0.3s; }
        main { flex-grow:1; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; width:100%; padding-top: 100px; padding-bottom: 150px; }
        #groupCreationForm { width:100%; max-width:500px; padding:0 20px; display: flex; flex-direction: column; gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 14px; color: #00c2ff; margin-bottom: 8px; font-weight: 600; }
        .form-group input, .form-group textarea { background: #1e2531; border: 1px solid rgba(0,194,255,0.3); border-radius: 8px; color: #fff; padding: 12px; font-size: 16px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group textarea:focus { border-color: #00c2ff; outline: none; box-shadow: 0 0 5px rgba(0,194,255,0.5); }
        #coverPreview { width: 100%; aspect-ratio: 1 / 1; background: #1e2531; border: 2px dashed rgba(0,194,255,0.5); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #00c2ff; font-size: 16px; cursor: pointer; position: relative; overflow: hidden; }
        #coverPreview img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }
        .common-button { background: #00c2ff; border: none; border-radius: 8px; color: #000; padding: 12px 20px; font-size: 18px; font-weight: 700; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 4px 8px rgba(0,194,255,0.3); }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center; z-index: 100; opacity: 0; visibility: hidden; transition: 0.3s; }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        .modal-content { background: #0c0f14; padding: 20px; border-radius: 16px; width: 90%; max-width: 400px; transform: translateY(20px); transition: transform 0.3s; box-shadow: 0 8px 25px rgba(0,194,255,0.4); }
        .modal-option { background: #1e2531; color: #fff; padding: 15px; margin-bottom: 10px; border-radius: 10px; display: flex; flex-direction: column; gap: 10px; }
        .media-preview-gallery { display: flex; gap: 10px; overflow-x: auto; width: 100%; padding-bottom: 5px; }
        .media-preview-item { flex: 0 0 100px; height: 125px; position: relative; border-radius: 8px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .media-preview-item img, .media-preview-item video { width: 100%; height: 100%; object-fit: cover; }
        .remove-media-btn { position: absolute; top: 2px; right: 2px; background: rgba(0,0,0,0.7); color: #ff4d4d; border: none; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 12px; }
        #media-upload-trigger { width: 100%; padding: 20px; background: #0c0f14; border: 1px dashed rgba(0,194,255,0.5); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #00c2ff; }
        .price-input-container { display: flex; align-items: center; background: #1e2531; border: 1px solid rgba(0,194,255,0.3); border-radius: 8px; overflow: hidden; margin-bottom: 20px; }
        .price-input-container span { padding: 12px; background: #28303f; color: #aaa; font-size: 16px; font-weight: 700; min-width: 50px; text-align: center; }
        .price-input-container input { flex-grow: 1; border: none; background: none; padding: 12px; text-align: right; color: #fff; font-weight: 700; }
        .custom-radio { flex: 1; display: flex; align-items: center; justify-content: center; padding: 10px 15px; background: #1e2531; border: 1px solid rgba(0,194,255,0.3); border-radius: 8px; color: #fff; cursor: pointer; transition: background 0.3s; font-size: 14px; font-weight: 600; }
        .custom-radio.selected { background: #00c2ff; color: #000; }
        .selector-trigger { width: 100%; background: #1e2531; border: 1px solid rgba(0, 194, 255, 0.3); border-radius: 12px; padding: 14px 16px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: 0.3s; margin-bottom: 5px; }
        .status-badge { display: flex; align-items: center; gap: 6px; font-size: 11px; font-weight: 700; padding: 4px 10px; border-radius: 12px; text-transform: uppercase; }
        .status-badge.active { background: rgba(0, 255, 130, 0.1); color: #00ff82; border: 1px solid #00ff82; }
      `}),e.jsxs("header",{children:[e.jsx("button",{onClick:()=>l("/groups"),children:e.jsx("i",{className:"fa-solid fa-xmark"})}),e.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 w-[60px] h-[60px] bg-white/5 rounded-2xl flex justify-center items-center z-20 cursor-pointer shadow-[0_0_20px_rgba(0,194,255,0.3),inset_0_0_20px_rgba(0,194,255,0.08)]",onClick:()=>l("/feed"),children:[e.jsx("div",{className:"absolute w-[40px] h-[22px] rounded-[50%] border-[3px] border-[#00c2ff] rotate-[25deg]"}),e.jsx("div",{className:"absolute w-[40px] h-[22px] rounded-[50%] border-[3px] border-[#00c2ff] -rotate-[25deg]"})]})]}),e.jsxs("main",{children:[e.jsx("h1",{style:{color:"#00c2ff",marginBottom:"20px"},children:"Editar Grupo"}),e.jsxs("form",{id:"groupCreationForm",onSubmit:ce,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"groupName",children:"Nome do Grupo"}),e.jsx("input",{type:"text",id:"groupName",value:S,onChange:t=>D(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Capa do Grupo"}),e.jsx("div",{id:"coverPreview",onClick:()=>document.getElementById("coverImageInput")?.click(),children:h?e.jsx("img",{src:h,alt:"Cover"}):e.jsx("span",{children:"Selecionar Capa"})}),e.jsx("input",{type:"file",id:"coverImageInput",accept:"image/*",style:{display:"none"},onChange:se})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"groupDescription",children:"Descrição"}),e.jsx("textarea",{id:"groupDescription",value:T,onChange:t=>M(t.target.value)})]}),e.jsxs("button",{type:"button",className:"common-button",onClick:()=>w(!0),children:[e.jsx("i",{className:"fa-solid fa-gear"})," Editar Porta do VIP"]}),e.jsxs("div",{className:"price-group",children:[e.jsx("label",{children:"Tipo de Acesso"}),e.jsxs("div",{className:"radio-group-container flex gap-2",children:[e.jsxs("div",{className:`custom-radio ${v==="lifetime"?"selected":""}`,onClick:()=>q("lifetime"),children:[e.jsx("i",{className:"fa-solid fa-infinity"})," Vitalício"]}),e.jsxs("div",{className:`custom-radio ${v==="temporary"?"selected":""}`,onClick:()=>q("temporary"),children:[e.jsx("i",{className:"fa-solid fa-clock"})," Temporário"]})]}),e.jsxs("div",{className:"selector-trigger mt-4",onClick:()=>B(!0),children:[e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"label",children:"Moeda:"}),e.jsx("span",{className:"value",children:p})]}),e.jsx("i",{className:"fa-solid fa-chevron-right text-[#00c2ff]"})]}),e.jsxs("div",{className:"price-input-container",children:[e.jsx("span",{children:p==="BRL"?"R$":"$"}),e.jsx("input",{type:"text",value:z,onChange:de,required:!0})]})]}),e.jsxs("div",{className:"price-group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{style:{fontSize:"14px",color:"#FFD700",textTransform:"uppercase"},children:"Marketing Avançado"}),e.jsx("div",{className:`status-badge ${R}`,children:R==="active"?"Ativo":"Inativo"})]}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{children:"Pixel ID"}),e.jsx("input",{type:"text",value:u,onChange:t=>U(t.target.value),placeholder:"Meta Pixel ID"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Token CAPI"}),e.jsx("input",{type:"text",value:A,onChange:t=>G(t.target.value),placeholder:"Access Token"})]})]}),e.jsx("button",{type:"submit",className:"common-button",disabled:f,children:f?e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-save"})," Salvar Alterações"]})})]}),e.jsx(he,{progress:oe,current:ie,total:re,isVisible:f})]}),e.jsx("div",{className:`modal-overlay ${Z?"open":""}`,onClick:()=>w(!1),children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{children:"Porta do VIP"}),e.jsxs("div",{className:"modal-option",children:[e.jsx("div",{className:"media-preview-gallery",children:x.map((t,i)=>e.jsxs("div",{className:"media-preview-item",children:[t.type==="video"?e.jsx("video",{src:t.url}):e.jsx("img",{src:t.url}),e.jsx("button",{className:"remove-media-btn",onClick:()=>le(i),children:e.jsx("i",{className:"fa-solid fa-xmark"})})]},i))}),e.jsxs("div",{id:"media-upload-trigger",onClick:()=>document.getElementById("vipDoorMediaInput")?.click(),children:[e.jsx("i",{className:"fa-solid fa-photo-film"}),e.jsx("span",{children:"Adicionar Mídia"})]}),e.jsx("input",{type:"file",id:"vipDoorMediaInput",accept:"image/*,video/*",multiple:!0,style:{display:"none"},onChange:ne})]}),e.jsxs("div",{className:"modal-option",children:[e.jsx("textarea",{value:E,onChange:t=>O(t.target.value),placeholder:"Texto de boas-vindas"}),e.jsx("input",{type:"text",value:L,onChange:t=>$(t.target.value),placeholder:"Texto do botão"})]}),e.jsx("button",{className:"common-button w-full",onClick:()=>w(!1),children:"Concluir"})]})}),e.jsx(ge,{isOpen:te,onClose:()=>B(!1),currentCurrency:p,onSelect:t=>F(t)})]})};export{ke as EditGroup};

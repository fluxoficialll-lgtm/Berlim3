import{r as e,j as n,u as a,c as s,v as t}from"./index-Bkpya5GW.js";import{P as r}from"./PixelSettingsModal-CRRhV-Zm.js";const i={BRL:{symbol:"R$",color:"#00ff82",label:"Real"},USD:{symbol:"$",color:"#00c2ff",label:"Dólar"},EUR:{symbol:"€",color:"#ffd700",label:"Euro"}},l=({stats:a,selectedFilter:s,filters:t,onFilterChange:r,onRefresh:l,loading:o,showCurrencySwitch:d})=>{const[c,x]=e.useState("BRL"),p=a[c],f=i[c],m=e=>{const n="BRL"===c?"pt-BR":"USD"===c?"en-US":"de-DE";return e.toLocaleString(n,{minimumFractionDigits:2,maximumFractionDigits:2})};return n.jsxs("div",{className:"flux-card bg-white/5 border border-white/10 rounded-[20px] p-6 mb-5 shadow-2xl relative animate-fade-in overflow-hidden",children:[n.jsx("style",{children:"\n                .currency-pill {\n                    padding: 6px 12px;\n                    border-radius: 10px;\n                    font-size: 11px;\n                    font-weight: 800;\n                    cursor: pointer;\n                    transition: 0.2s;\n                    border: 1px solid rgba(255,255,255,0.05);\n                    background: rgba(255,255,255,0.02);\n                    color: #555;\n                }\n                .currency-pill.active {\n                    color: #fff;\n                    background: rgba(255,255,255,0.1);\n                }\n            "}),n.jsxs("div",{className:"flex justify-between items-start mb-6",children:[d?n.jsx("div",{className:"flex gap-2 p-1 bg-black/20 rounded-xl border border-white/5",children:["BRL","USD","EUR"].map(e=>n.jsxs("button",{className:"currency-pill "+(c===e?"active":""),onClick:()=>x(e),style:{borderColor:c===e?i[e].color:void 0},children:[i[e].symbol," ",e]},e))}):n.jsx("div",{className:"text-[11px] font-black text-gray-500 uppercase tracking-widest",children:"Saldo em Conta"}),n.jsx("button",{className:"bg-[#00c2ff]/10 text-[#00c2ff] border-none rounded-full w-8 h-8 flex items-center justify-center cursor-pointer transition-all hover:bg-[#00c2ff]/20",onClick:l,disabled:o,children:n.jsx("i",{className:"fa-solid fa-rotate-right "+(o?"fa-spin":"")})})]}),n.jsxs("div",{className:"balance-label text-[13px] text-white/40 mb-1 uppercase tracking-widest",children:[n.jsx("i",{className:"fa-solid fa-chart-line mr-2"}),"Disponível"===s?"Saldo Total":`Faturamento (${s})`]}),n.jsxs("div",{className:"balance-amount text-[42px] font-extrabold mb-2.5 flex items-baseline gap-2 transition-all duration-500",style:{color:f.color,textShadow:`0 0 20px ${f.color}33`},children:[n.jsx("span",{className:"text-[20px] font-semibold text-white/50",children:f.symbol}),m(p.total)]}),n.jsxs("div",{className:"breakdown bg-black/30 rounded-2xl p-4 mb-5 flex flex-col gap-3 border border-white/5",children:[n.jsxs("div",{className:"breakdown-item flex justify-between text-[13px]",children:[n.jsxs("span",{className:"flex items-center gap-2 text-gray-400",children:[n.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{background:f.color}}),"Vendas Próprias"]}),n.jsxs("span",{className:"font-bold text-white",children:[f.symbol," ",m(p.own)]})]}),n.jsxs("div",{className:"breakdown-item flex justify-between text-[13px]",children:[n.jsxs("span",{className:"flex items-center gap-2 text-gray-400",children:[n.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[#FFD700]"}),"Comissões Afiliados"]}),n.jsxs("span",{className:"font-bold text-white",children:[f.symbol," ",m(p.affiliate)]})]})]}),n.jsx("div",{className:"filter-container flex gap-2 overflow-x-auto pb-3 no-scrollbar mb-4 border-b border-white/5",children:t.map(e=>n.jsx("button",{className:"filter-chip px-4 py-2 rounded-full border text-[12px] font-bold transition-all whitespace-nowrap cursor-pointer "+(s===e?"bg-[#00c2ff]/15 border-[#00c2ff] text-[#00c2ff]":"bg-white/5 border-white/10 text-white/40"),onClick:()=>r(e),children:e},e))})]})},o=({isOpen:a,onClose:s,sellers:t,onDismissSeller:r})=>{const[i,l]=e.useState(""),o=e.useMemo(()=>t.filter(e=>e.name.toLowerCase().includes(i.toLowerCase())||e.username.toLowerCase().includes(i.toLowerCase())),[t,i]);return a?n.jsxs("div",{className:"fixed inset-0 bg-black/90 z-[120] flex items-center justify-center p-4 backdrop-blur-md animate-fade-in",onClick:e=>e.target===e.currentTarget&&s(),children:[n.jsx("style",{children:"\n                .sellers-modal-card {\n                    width: 100%;\n                    max-width: 400px;\n                    background: #1a1e26;\n                    border: 1px solid rgba(255, 215, 0, 0.3);\n                    border-radius: 24px;\n                    display: flex;\n                    flex-direction: column;\n                    max-height: 85vh;\n                    overflow: hidden;\n                    box-shadow: 0 0 50px rgba(255, 215, 0, 0.1);\n                    animation: popIn 0.3s ease;\n                }\n                .search-wrapper {\n                    position: relative;\n                    padding: 20px;\n                    background: rgba(255, 255, 255, 0.02);\n                    border-bottom: 1px solid rgba(255, 215, 0, 0.1);\n                }\n                .search-wrapper i {\n                    position: absolute;\n                    left: 35px;\n                    top: 50%;\n                    transform: translateY(-50%);\n                    color: #FFD700;\n                }\n                .search-input {\n                    width: 100%;\n                    background: #0c0f14;\n                    border: 1px solid rgba(255, 215, 0, 0.2);\n                    border-radius: 12px;\n                    padding: 12px 12px 12px 40px;\n                    color: #fff;\n                    outline: none;\n                    font-size: 14px;\n                }\n                .search-input:focus { border-color: #FFD700; }\n                \n                .sellers-list {\n                    flex: 1;\n                    overflow-y: auto;\n                    padding: 10px 0;\n                }\n                .seller-card-item {\n                    display: flex;\n                    align-items: center;\n                    padding: 15px 20px;\n                    border-bottom: 1px solid rgba(255, 255, 255, 0.03);\n                    transition: 0.2s;\n                }\n                .seller-card-item:hover { background: rgba(255, 215, 0, 0.03); }\n                \n                .seller-avatar {\n                    width: 45px;\n                    height: 45px;\n                    border-radius: 50%;\n                    border: 2px solid #FFD700;\n                    object-fit: cover;\n                    background: #333;\n                }\n                .seller-info { flex: 1; margin-left: 12px; min-width: 0; }\n                .seller-name { font-weight: 700; font-size: 15px; color: #fff; display: block; }\n                .seller-user { font-size: 12px; color: #888; }\n                \n                .seller-values { text-align: right; margin-left: 10px; }\n                .value-earned { font-size: 14px; font-weight: 800; color: #00ff82; }\n                .sales-count { font-size: 10px; color: #aaa; text-transform: uppercase; }\n\n                .dismiss-btn {\n                    padding: 6px 12px;\n                    background: rgba(255, 77, 77, 0.1);\n                    border: 1px solid rgba(255, 77, 77, 0.3);\n                    color: #ff4d4d;\n                    border-radius: 8px;\n                    font-size: 10px;\n                    font-weight: 800;\n                    cursor: pointer;\n                    margin-top: 5px;\n                    text-transform: uppercase;\n                    transition: 0.2s;\n                }\n                .dismiss-btn:hover { background: #ff4d4d; color: #fff; }\n\n                .modal-footer {\n                    padding: 15px;\n                    text-align: center;\n                    border-top: 1px solid rgba(255, 255, 255, 0.05);\n                }\n                .count-badge {\n                    background: rgba(255, 215, 0, 0.1);\n                    color: #FFD700;\n                    padding: 4px 10px;\n                    border-radius: 20px;\n                    font-size: 11px;\n                    font-weight: 700;\n                }\n            "}),n.jsxs("div",{className:"sellers-modal-card",children:[n.jsxs("div",{className:"flex items-center justify-between px-5 pt-5",children:[n.jsxs("h2",{className:"text-lg font-bold text-white uppercase tracking-wider",children:[n.jsx("i",{className:"fa-solid fa-users mr-2 text-[#FFD700]"})," Vendedores"]}),n.jsxs("span",{className:"count-badge",children:[t.length," Indicados"]})]}),n.jsxs("div",{className:"search-wrapper",children:[n.jsx("i",{className:"fa-solid fa-magnifying-glass"}),n.jsx("input",{type:"text",className:"search-input",placeholder:"Buscar por nome ou @usuário...",value:i,onChange:e=>l(e.target.value)})]}),n.jsx("div",{className:"sellers-list no-scrollbar",children:o.length>0?o.map(e=>n.jsxs("div",{className:"seller-card-item",children:[e.avatar?n.jsx("img",{src:e.avatar,className:"seller-avatar",alt:"S"}):n.jsx("div",{className:"seller-avatar flex items-center justify-center text-lg text-[#FFD700]",children:n.jsx("i",{className:"fa-solid fa-user"})}),n.jsxs("div",{className:"seller-info",children:[n.jsx("span",{className:"seller-name truncate",children:e.name||"Vendedor"}),n.jsxs("span",{className:"seller-user",children:["@",e.username]}),n.jsx("div",{children:n.jsx("button",{className:"dismiss-btn",onClick:()=>{window.confirm(`Deseja dispensar @${e.username}? Você deixará de receber comissões sobre as vendas deste parceiro.`)&&r(e.id)},children:"Dispensar Vendedor"})})]}),n.jsxs("div",{className:"seller-values",children:[n.jsxs("div",{className:"value-earned",children:["R$ ",e.totalGenerated.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),n.jsxs("div",{className:"sales-count",children:[e.salesCount," vendas"]})]})]},e.id)):n.jsxs("div",{className:"text-center py-20 opacity-30",children:[n.jsx("i",{className:"fa-solid fa-user-slash text-4xl mb-4"}),n.jsx("p",{className:"text-sm",children:"Nenhum vendedor encontrado."})]})}),n.jsx("div",{className:"modal-footer",children:n.jsx("button",{className:"w-full py-3 text-gray-500 font-bold uppercase text-xs hover:text-white transition-colors",onClick:s,children:"Fechar Lista"})})]})]}):null},d=({affiliateStats:a,pixelId:s,setPixelId:t,pixelToken:i,setPixelToken:l,isSavingMarketing:d,onSaveMarketing:c,onCopyAffiliateLink:x,isCopyingLink:p,onOpenTracking:f})=>{const[m,u]=e.useState(!1),[b,g]=e.useState(!1);return n.jsxs("div",{className:"flux-card bg-white/5 border border-[#FFD700]/30 rounded-[20px] p-6 mb-5 shadow-2xl animate-fade-in",style:{background:"rgba(255, 215, 0, 0.03)"},children:[n.jsx("style",{children:"\n                .add-pixel-btn {\n                    width: 100%;\n                    padding: 14px;\n                    background: rgba(255, 255, 255, 0.03);\n                    border: 1px dashed #FFD700;\n                    border-radius: 12px;\n                    color: #FFD700;\n                    font-weight: 700;\n                    font-size: 14px;\n                    cursor: pointer;\n                    transition: 0.3s;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    gap: 10px;\n                    margin-top: 20px;\n                }\n                .add-pixel-btn:hover {\n                    background: rgba(255, 215, 0, 0.1);\n                    border-style: solid;\n                }\n                .pixel-active-badge {\n                    font-size: 10px;\n                    color: #00ff82;\n                    text-align: center;\n                    margin-top: 8px;\n                    font-weight: 800;\n                    text-transform: uppercase;\n                    letter-spacing: 1px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    gap: 5px;\n                }\n                .sellers-btn {\n                    width: 100%;\n                    padding: 14px;\n                    background: #1a1e26;\n                    border: 1px solid rgba(255, 215, 0, 0.2);\n                    border-radius: 12px;\n                    color: #fff;\n                    font-weight: 700;\n                    font-size: 13px;\n                    cursor: pointer;\n                    display: flex;\n                    align-items: center;\n                    justify-content: space-between;\n                    margin-top: 15px;\n                    transition: 0.3s;\n                }\n                .sellers-btn:hover {\n                    border-color: #FFD700;\n                    background: rgba(255, 215, 0, 0.05);\n                }\n                .seller-count-tag {\n                    background: #FFD700;\n                    color: #000;\n                    padding: 2px 8px;\n                    border-radius: 6px;\n                    font-size: 11px;\n                    font-weight: 900;\n                }\n            "}),n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h3",{className:"text-[14px] text-[#FFD700] font-bold uppercase tracking-wider",children:[n.jsx("i",{className:"fa-solid fa-users-rays mr-2"})," Programa de Afiliados"]}),n.jsx("div",{className:"bg-[#FFD700] text-black px-2 py-0.5 rounded text-[10px] font-black uppercase",children:"Master"})]}),n.jsxs("button",{className:"w-full py-4 bg-[#FFD700] text-black border-none rounded-xl font-black cursor-pointer flex items-center justify-center gap-2 transition-all hover:scale-[1.02] shadow-[0_4px_15px_rgba(255,215,0,0.2)]",onClick:x,children:[n.jsx("i",{className:"fa-solid "+(p?"fa-check":"fa-link")}),p?"LINK COPIADO!":"LINK DE RECRUTAMENTO"]}),n.jsxs("button",{className:"w-full py-3 mt-3 bg-transparent border border-dashed border-[#FFD700]/50 text-[#FFD700] rounded-xl font-bold text-[13px] cursor-pointer flex items-center justify-center gap-2 transition-all hover:bg-[#FFD700]/10",onClick:f,children:[n.jsx("i",{className:"fa-solid fa-bullseye"})," GERAR LINK RASTREÁVEL (UTM)"]}),n.jsxs("div",{className:"marketing-section mt-5 pt-5 border-t border-[#FFD700]/20",children:[n.jsxs("label",{className:"block text-[11px] text-gray-400 font-bold uppercase mb-1 tracking-widest text-center",children:[n.jsx("i",{className:"fa-solid fa-rocket mr-1"})," Rastreamento de Recrutamento"]}),n.jsxs("button",{className:"add-pixel-btn",onClick:()=>u(!0),children:[n.jsx("i",{className:"fa-solid "+(s?"fa-gear":"fa-plus-circle")}),s?"CONFIGURAR PIXEL":"ADICIONAR PIXEL"]}),s&&n.jsxs("div",{className:"pixel-active-badge animate-fade-in",children:[n.jsx("i",{className:"fa-solid fa-circle-check"})," Pixel Ativo (PageView, Lead)"]})]}),n.jsxs("button",{className:"sellers-btn",onClick:()=>g(!0),children:[n.jsxs("span",{className:"flex items-center gap-2",children:[n.jsx("i",{className:"fa-solid fa-users text-[#FFD700]"}),"Vendedores Indicados"]}),n.jsx("span",{className:"seller-count-tag",children:(null==a?void 0:a.referredSellers.length)||0})]}),n.jsx("p",{className:"text-[10px] text-gray-500 text-center mt-4 px-4 italic",children:"Acompanhe o desempenho de sua rede de vendedores e gerencie suas comissões ativas."}),n.jsx(r,{isOpen:m,onClose:()=>u(!1),initialData:{pixelId:s,pixelToken:i},onSave:e=>{t(e.pixelId),l(e.pixelToken),c(e)}}),n.jsx(o,{isOpen:b,onClose:()=>g(!1),sellers:(null==a?void 0:a.referredSellers)||[],onDismissSeller:e=>{alert(`Vendedor ${e} dispensado. O sistema deixará de atribuir comissões deste usuário à sua conta.`)}})]})},c=({activeProvider:e,onManage:a})=>{const s=!!e;return n.jsxs("div",{className:"flux-card bg-white/5 border border-white/10 rounded-[20px] p-6 shadow-2xl animate-fade-in",children:[n.jsxs("div",{className:"text-[16px] font-bold text-white mb-4",children:[n.jsx("i",{className:"fa-solid fa-plug text-[#00c2ff] mr-2"})," Gateway de Pagamento"]}),n.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-[12px] font-bold uppercase mb-4 "+(s?"bg-[#00ff82]/10 text-[#00ff82]":"bg-red-500/10 text-red-500"),children:[n.jsx("div",{className:"w-1.5 h-1.5 rounded-full "+(s?"bg-[#00ff82] shadow-[0_0_5px_#00ff82]":"bg-red-500 shadow-[0_0_5px_#ff4d4d]")}),s?n.jsxs("span",{children:[e," Selecionado"]}):n.jsx("span",{children:"Nenhum Provedor Ativo"})]}),n.jsx("button",{className:"w-full py-4 bg-[#1e2531] border border-[#00c2ff] text-[#00c2ff] text-[15px] font-extrabold rounded-xl cursor-pointer transition-all hover:bg-[#00c2ff]/10",onClick:a,children:s?"TROCAR GATEWAY":"CONECTAR AGORA"})]})},x=()=>{const r=a(),[i,o]=e.useState("Disponível"),[x,p]=e.useState(""),[f,m]=e.useState(!0),[u,b]=e.useState("syncpay"),[g,h]=e.useState({BRL:{total:0,own:0,affiliate:0},USD:{total:0,own:0,affiliate:0},EUR:{total:0,own:0,affiliate:0}}),[w,j]=e.useState([]),[v,y]=e.useState({BRL:0,USD:0,EUR:0}),[N,k]=e.useState(null),[S,F]=e.useState(""),[D,C]=e.useState(""),[R,L]=e.useState(!1),[E,A]=e.useState(!1),U=e.useCallback(()=>{var e;const n=new Date,a=new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime(),s=864e5,t=(e=>{switch(e){case"Hoje":return a;case"Ontem":return a-s;case"7d":return n.getTime()-7*s;case"30d":return n.getTime()-30*s;case"180d":return n.getTime()-180*s;default:return 0}})(i),r={BRL:{total:0,own:0,affiliate:0},USD:{total:0,own:0,affiliate:0},EUR:{total:0,own:0,affiliate:0}};"Disponível"===i?(r.BRL.total=v.BRL||0,r.USD.total=v.USD||0,r.EUR.total=v.EUR||0,r.BRL.affiliate=(null==N?void 0:N.totalEarned)||0,r.BRL.own=Math.max(0,r.BRL.total-r.BRL.affiliate)):(Array.isArray(w)&&w.forEach(e=>{const n=(e.status||"").toLowerCase();if(!["paid","completed","approved","settled"].includes(n))return;const s=new Date(e.created_at||e.createdAt||e.date_created||0).getTime();if("Ontem"===i?s>=t&&s<a:s>=t){const n=(e.currency||"BRL").toUpperCase();r[n]&&(r[n].own+=parseFloat(e.amount||0),r[n].total+=parseFloat(e.amount||0))}}),null==(e=null==N?void 0:N.recentSales)||e.forEach(e=>{const n=e.timestamp;if("Ontem"===i?n>=t&&n<a:n>=t){const n="BRL";r[n].affiliate+=e.commission,r[n].total+=e.commission}})),h(r)},[i,w,v,N]),P=async()=>{var e,n,a,r,i,l,o;m(!0);const d=s.getCurrentUser(),c=localStorage.getItem("flux_preferred_provider")||"syncpay";if(b(c),d){const s=(null==(n=null==(e=d.paymentConfigs)?void 0:e.syncpay)?void 0:n.isConnected)||"syncpay"===(null==(a=d.paymentConfig)?void 0:a.providerId),f=null==(i=null==(r=d.paymentConfigs)?void 0:r.stripe)?void 0:i.isConnected,m=null==(o=null==(l=d.paymentConfigs)?void 0:l.paypal)?void 0:o.isConnected;let u="";"syncpay"===c&&s?u="SyncPay":"stripe"===c&&f?u="Stripe":"paypal"===c&&m?u="PayPal":s?u="SyncPay":f?u="Stripe":m&&(u="PayPal"),p(u);if(s||f||m)try{const e=await t.getBalance(d.email);y("syncpay"===c?{BRL:e,USD:0,EUR:0}:{BRL:e,USD:e/5,EUR:e/5.4});const n=await t.getTransactions(d.email);j(Array.isArray(n)?n:[]);const a=await t.getAffiliateStats(d.email);k(a)}catch(x){}}m(!1)};e.useEffect(()=>{P();const e=()=>P();return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]),e.useEffect(()=>{U()},[U]);return n.jsxs("div",{className:"h-screen bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-y-auto overflow-x-hidden",children:[n.jsxs("header",{className:"flex items-center justify-between p-4 bg-[#0c0f14] fixed w-full z-10 border-b border-white/10 top-0 h-[65px]",children:[n.jsx("button",{onClick:()=>r("/settings"),"aria-label":"Voltar",children:n.jsx("i",{className:"fa-solid fa-arrow-left"})}),n.jsx("h1",{className:"text-[20px] font-semibold",children:"Painel Financeiro"}),n.jsx("div",{style:{width:"24px"}})]}),n.jsxs("main",{className:"pt-[80px] pb-[40px] w-full max-w-[600px] mx-auto px-5",children:[n.jsx(l,{stats:g,selectedFilter:i,filters:["Disponível","Hoje","Ontem","7d","30d","180d"],onFilterChange:o,onRefresh:P,loading:f,showCurrencySwitch:"syncpay"!==u}),x&&n.jsx(d,{affiliateStats:N,pixelId:S,setPixelId:F,pixelToken:D,setPixelToken:C,isSavingMarketing:R,onSaveMarketing:()=>{},onCopyAffiliateLink:()=>{},isCopyingLink:E,onOpenTracking:()=>{}}),n.jsx(c,{activeProvider:x,onManage:()=>r("/financial/providers")})]})]})};export{x as FinancialPanel};

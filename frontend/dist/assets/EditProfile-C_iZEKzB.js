import{u as e,r as a,c as t,j as i,i as r,d as o}from"./index-CipjSFYz.js";import{p as n}from"./postService-0_arHZ6V.js";import{I as s}from"./ImageCropModal-DAIxvQRf.js";const l=()=>{const l=e(),d=a.useRef(null),[c,p]=a.useState({name:"",nickname:"",bio:"",website:"",isPrivate:!1,photoUrl:void 0,cpf:"",phone:""}),[u,m]=a.useState(null),[f,x]=a.useState(null),[h,g]=a.useState(!1),[b,v]=a.useState(!0),[j,w]=a.useState(""),[y,N]=a.useState(""),[k,S]=a.useState(!1),[C,U]=a.useState("");a.useEffect(()=>{const e=t.getCurrentUser();e?(e.profile&&(p({name:e.profile.name||"",nickname:e.profile.nickname||"",bio:e.profile.bio||"",website:e.profile.website||"",isPrivate:e.profile.isPrivate||!1,photoUrl:e.profile.photoUrl,cpf:e.profile.cpf||"",phone:e.profile.phone||""}),e.profile.photoUrl&&m(e.profile.photoUrl)),v(!1)):l("/")},[l]);const z=e=>{const{name:a,value:t}=e.target;if("name"===a){const e=t.toLowerCase().replace(/[^a-z0-9_.]/g,"");p(t=>({...t,[a]:e})),N("")}else p(e=>({...e,[a]:t}))};return b?i.jsx("div",{className:"min-h-screen bg-[#0c0f14] flex items-center justify-center text-white",children:"Carregando..."}):i.jsxs("div",{className:"min-h-screen bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-x-hidden",children:[i.jsx("style",{children:"\n        header { display:flex; align-items:center; justify-content:space-between; padding:16px; background: #0c0f14; position:fixed; width:100%; top:0; z-index:10; border-bottom:1px solid rgba(255,255,255,0.1); height: 65px; }\n        header .back-btn { background:none; border:none; color:#fff; font-size:24px; cursor:pointer; padding-right: 15px; }\n        main { padding-top: 85px; padding-bottom: 40px; width: 100%; max-width: 600px; margin: 0 auto; padding-left: 20px; padding-right: 20px; }\n        .avatar-section { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; }\n        .avatar-wrapper { position: relative; width: 100px; height: 100px; border-radius: 50%; cursor: pointer; }\n        .avatar-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid #00c2ff; }\n        .edit-icon { position: absolute; bottom: 0; right: 0; background: #00c2ff; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #0c0f14; }\n        .input-group { margin-bottom: 20px; }\n        .input-group label { display: block; font-size: 13px; color: #aaa; margin-bottom: 8px; }\n        .input-group input, .input-group textarea { width: 100%; padding: 14px 15px; background: #1a1e26; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: #fff; font-size: 16px; outline: none; }\n        .save-btn { width: 100%; padding: 16px; background: #00c2ff; color: #000; border: none; border-radius: 12px; font-weight: 800; cursor: pointer; }\n      "}),i.jsxs("header",{children:[i.jsx("button",{onClick:()=>{window.history.state&&window.history.state.idx>0?l(-1):l("/profile")},className:"back-btn",children:i.jsx("i",{className:"fa-solid fa-arrow-left"})}),i.jsx("h1",{children:"Editar Perfil"}),i.jsx("div",{style:{width:"24px"}})]}),i.jsxs("main",{children:[i.jsxs("div",{className:"avatar-section",children:[i.jsxs("div",{className:"avatar-wrapper",onClick:()=>{var e;return null==(e=d.current)?void 0:e.click()},children:[u?i.jsx("img",{src:u,className:"avatar-img"}):i.jsx("div",{className:"avatar-img bg-gray-700 flex items-center justify-center",children:i.jsx("i",{className:"fa-solid fa-user text-4xl"})}),i.jsx("div",{className:"edit-icon",children:i.jsx("i",{className:"fa-solid fa-camera"})})]}),i.jsx("input",{type:"file",ref:d,onChange:e=>{var a;const t=null==(a=e.target.files)?void 0:a[0];if(t){const e=new FileReader;e.onload=e=>{var a;U(null==(a=e.target)?void 0:a.result),S(!0)},e.readAsDataURL(t)}},accept:"image/*",hidden:!0})]}),i.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),w(""),N(""),!c.name.trim())return void N("Nome de usuário é obrigatório");g(!0);const a=t.getCurrentUser(),i=null==a?void 0:a.email;try{if(i&&a){let e=c.photoUrl;f&&(e=await n.uploadMedia(f,"avatars"));const o={...c,photoUrl:e};await t.completeProfile(i,o);const s=`@${c.name}`;r.posts.getAll().forEach(t=>{let i=!1;t.authorId===a.id&&(t.username!==s&&(t.username=s,i=!0),e&&t.avatar!==e&&(t.avatar=e,i=!0)),i&&r.posts.update(t)}),alert("Perfil atualizado com sucesso!"),l("/profile",{replace:!0})}}catch(s){s.message===o.NAME_TAKEN?N("Este nome de usuário já está em uso."):w(s.message||"Erro ao atualizar perfil.")}finally{g(!1)}},children:[i.jsxs("div",{className:"input-group",children:[i.jsx("label",{children:"Apelido"}),i.jsx("input",{type:"text",name:"nickname",value:c.nickname,onChange:z})]}),i.jsxs("div",{className:"input-group",children:[i.jsx("label",{children:"Nome de Usuário (@)"}),i.jsx("input",{type:"text",name:"name",value:c.name,onChange:z}),y&&i.jsx("p",{className:"text-red-500 text-xs mt-1",children:y})]}),i.jsxs("div",{className:"input-group",children:[i.jsx("label",{children:"Biografia"}),i.jsx("textarea",{name:"bio",value:c.bio,onChange:z})]}),i.jsx("button",{type:"submit",className:"save-btn",disabled:h,children:h?"Salvando...":"Salvar Alterações"})]})]}),i.jsx(s,{isOpen:k,imageSrc:C,onClose:()=>S(!1),onSave:e=>{m(e),fetch(e).then(e=>e.blob()).then(e=>{const a=new File([e],"avatar.jpg",{type:"image/jpeg"});x(a)})}})]})};export{l as EditProfile};

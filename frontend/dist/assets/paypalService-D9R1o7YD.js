import{A as e,U as t}from"./index-Bkpya5GW.js";class s{constructor(){this.defaultRetryConfig={maxRetries:3,initialDelay:1e3,maxDelay:5e3}}async withRetry(e,t=this.defaultRetryConfig){var s,r;let a,n=t.initialDelay;for(let o=0;o<=t.maxRetries;o++)try{return await e()}catch(i){if(a=i,(null==(s=i.message)?void 0:s.includes("API_KEY_INVALID"))||(null==(r=i.message)?void 0:r.includes("Requested entity was not found")))throw i;o<t.maxRetries&&(await new Promise(e=>setTimeout(e,n)),n=Math.min(2*n,t.maxDelay))}throw a}}const r={gateways:new class extends s{async request(e,t,s){return this.withRetry(async()=>{var r,a;try{const n=await fetch(e,{...t,headers:{"Content-Type":"application/json",...t.headers}}),i=await n.json().catch(()=>({}));if(!n.ok){if(null==(a=null==(r=i.error)?void 0:r.message)?void 0:a.includes("Requested entity was not found"))throw new Error(`GATEWAY_AUTH_ERROR: ${s}`);return{success:!1,error:i.error||i.message||`Erro no provedor ${s}`,statusCode:n.status}}return{success:!0,data:i}}catch(n){throw n}})}}},a=`${e}/api/stripe`,n={authenticate:async e=>n.verifyCredentials(e),verifyCredentials:async e=>{const t=await r.gateways.request(`${a}/auth-token`,{method:"POST",body:JSON.stringify({secretKey:e})},"Stripe");if(!t.success)throw new Error(t.error);return t.data},createPaymentIntent:async(e,t,s)=>{var n;const i=await r.gateways.request(`${a}/create-intent`,{method:"POST",body:JSON.stringify({group:e,ownerEmail:t,paymentMethodType:s,currency:(null==(n=e.currency)?void 0:n.toLowerCase())||"brl"})},"Stripe");if(!i.success)throw new Error(i.error);return i.data},createCheckoutSession:async(e,t)=>{const s=`${window.location.origin}/#/vip-group-sales/${e.id}?session_id={CHECKOUT_SESSION_ID}&success=true`,n=`${window.location.origin}/#/vip-group-sales/${e.id}?success=false`,i=await r.gateways.request(`${a}/create-session`,{method:"POST",body:JSON.stringify({group:e,ownerEmail:t,successUrl:s,cancelUrl:n})},"Stripe");if(!i.success)throw new Error(i.error);return i.data},checkSessionStatus:async(e,t)=>{const s=await r.gateways.request(`${a}/check-status`,{method:"POST",body:JSON.stringify({sessionId:e,ownerEmail:t})},"Stripe");if(!s.success)throw new Error(s.error);return s.data}},i=t?{authenticate:async e=>({success:!0}),verifyCredentials:async e=>({success:!0}),createPaymentIntent:async(e,t,s)=>({id:"pi_mock_"+Math.random().toString(36).substr(2,9),client_secret:"pi_mock_secret_"+Math.random().toString(36).substr(2,9),next_action:{pix_display_qr_code:{data:"00020126360014BR.GOV.BCB.PIX0114MOCK-PIX-STRIPE520400005303986540510.005802BR5913FLUX-STRIPE6009SAO-PAULO62070503***6304E1D1"},oxxo_display_details:{number:"1234-5678-9012-34"}}}),createCheckoutSession:async(e,t)=>({id:"cs_mock_"+Math.random().toString(36).substr(2,9),url:window.location.href+"?session_id=mock"}),checkSessionStatus:async(e,t)=>({status:"paid"})}:n,o=`${e}/api/paypal`,c=async(e,t={})=>{const s=await fetch(e,t);if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.error||`Request failed: ${s.status}`)}return s.json()},d={authenticate:async(e,t)=>d.verifyCredentials(e,t),verifyCredentials:async(e,t)=>c(`${o}/auth-token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:e,clientSecret:t})}),createOrder:async(e,t)=>c(`${o}/create-order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:parseFloat(e.price||"0"),currency:e.currency||"BRL",description:`Acesso VIP: ${e.name}`,ownerEmail:t})}),checkOrderStatus:async(e,t)=>c(`${o}/check-status`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,ownerEmail:t})})},u=t?{authenticate:async(e,t)=>({success:!0}),verifyCredentials:async(e,t)=>({success:!0}),createOrder:async(e,t)=>({id:"PAY-MOCK-"+Math.random().toString(36).substr(2,9).toUpperCase(),approvalLink:window.location.href+"?token=mock",status:"CREATED"}),checkOrderStatus:async(e,t)=>({status:"paid"})}:d;export{u as p,i as s};

import{u as q,a as T,r,j as e,c as B}from"./index-BC19Iu_T.js";import{m as G}from"./marketplaceService-ov_b-P0x.js";import{p as N}from"./postService-XFLx8Vj8.js";import{g as O}from"./idGenerator-C8OoQYlS.js";const W=[{id:"Eletrônicos",icon:"fa-mobile-screen",label:"Eletrônicos"},{id:"Moda",icon:"fa-shirt",label:"Moda"},{id:"Comida",icon:"fa-utensils",label:"Comida"},{id:"Casa",icon:"fa-couch",label:"Casa"},{id:"Automotivo",icon:"fa-car",label:"Automotivo"},{id:"Imóveis",icon:"fa-building",label:"Imóveis"},{id:"Serviços",icon:"fa-screwdriver-wrench",label:"Serviços"},{id:"Infoprodutos",icon:"fa-graduation-cap",label:"Infoprodutos"},{id:"Vagas de Emprego",icon:"fa-briefcase",label:"Empregos"}],Z=()=>{const d=q();T().state?.type;const[l,k]=r.useState(""),[c,m]=r.useState(""),[x,S]=r.useState("Eletrônicos"),[g,I]=r.useState(""),[f,E]=r.useState(""),[n,A]=r.useState(null),[h,R]=r.useState(null),[p,b]=r.useState([]),[u,v]=r.useState(!1),j=r.useRef(null),w=r.useRef(null),P=t=>{const a=t.target.files?.[0];if(a){R(a);const i=new FileReader;i.onload=s=>A(s.target?.result),i.readAsDataURL(a)}},U=t=>{const a=t.target.files;if(!a)return;const s=Array.from(a).slice(0,5).map(o=>({file:o,url:URL.createObjectURL(o),type:o.type.startsWith("video/")?"video":"image"}));b(o=>[...o,...s])},z=t=>{b(a=>a.filter((i,s)=>s!==t))},L=()=>{window.history.state&&window.history.state.idx>0?d(-1):d("/marketplace")},M=t=>{let a=t.target.value;if(a=a.replace(/\D/g,""),a===""){m("");return}const i=parseFloat(a)/100;m(i.toLocaleString("pt-BR",{minimumFractionDigits:2}))},D=async t=>{if(t.preventDefault(),!(!l||!c||!n||u)){v(!0);try{const a=B.getCurrentUser();if(!a)return;let i=n||"";h&&(i=await N.uploadMedia(h,"marketplace"));const s=[];let o;for(const y of p){const C=await N.uploadMedia(y.file,"marketplace");y.type==="video"&&!o?o=C:s.push(C)}const F=c.replace(/\./g,"").replace(",","."),_=parseFloat(F),V={id:O(),title:l,price:_,category:x,location:g,description:f,image:i,images:s,video:o,sellerId:a.id,sellerName:a.profile?.name||"Usuário",sellerAvatar:a.profile?.photoUrl,timestamp:Date.now(),soldCount:0};await G.createItem(V),d("/marketplace")}catch(a){console.error("Marketplace Publish Error:",a),alert("Erro ao publicar anúncio no servidor.")}finally{v(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-hidden",children:[e.jsx("style",{children:`
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter',sans-serif; }
        header { display:flex; align-items:center; justify-content:space-between; padding:16px; background: #0c0f14; position:fixed; width:100%; top:0; z-index:10; border-bottom:1px solid rgba(255,255,255,0.1); height: 65px; }
        header .back-btn { background:none; border:none; color:#fff; font-size:20px; cursor:pointer; padding-right: 15px; }
        main { padding-top: 85px; padding-bottom: 40px; width: 100%; max-width: 600px; margin: 0 auto; padding-left: 20px; padding-right: 20px; flex-grow: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .section-label { font-size: 14px; font-weight: 600; color: #00c2ff; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
        .form-section { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 16px; padding: 20px; margin-bottom: 24px; }
        .main-cover-upload { width: 100%; aspect-ratio: 16/9; background: #1a1e26; border: 2px dashed rgba(255,255,255,0.1); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; position: relative; transition: 0.3s; }
        .main-cover-upload img { width: 100%; height: 100%; object-fit: cover; }
        .gallery-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .gallery-item { width: 70px; height: 70px; border-radius: 8px; flex-shrink: 0; background: #111; position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .gallery-item img, .gallery-item video { width: 100%; height: 100%; object-fit: cover; }
        .remove-media { position: absolute; top: 2px; right: 2px; background: rgba(0,0,0,0.7); color: #ff4d4d; border: none; width: 18px; height: 18px; border-radius: 50%; font-size: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .input-group { margin-bottom: 20px; }
        .input-wrapper input, .input-wrapper textarea, .input-wrapper select { width: 100%; background: #14171d; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 14px; color: #fff; font-size: 15px; outline: none; transition: 0.3s; }
        .cat-chip { padding: 8px 16px; border-radius: 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #aaa; font-size: 13px; white-space: nowrap; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 6px; }
        .cat-chip.active { background: rgba(0,194,255,0.15); border-color: #00c2ff; color: #00c2ff; font-weight: 600; }
        .submit-btn { width: 100%; padding: 16px; background: #00c2ff; color: #000; border: none; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,194,255,0.3); transition: 0.3s; }
        .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; }
      `}),e.jsxs("header",{children:[e.jsx("button",{onClick:L,className:"back-btn",children:e.jsx("i",{className:"fa-solid fa-arrow-left"})}),e.jsx("h1",{className:"text-lg font-bold",children:"Anunciar Produto"}),e.jsx("div",{style:{width:"20px"}})]}),e.jsx("main",{children:e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"form-section",children:[e.jsx("div",{className:"section-label",children:"Fotos & Vídeo"}),e.jsxs("div",{className:"main-cover-upload",onClick:()=>j.current?.click(),children:[n?e.jsx("img",{src:n,alt:"Capa"}):e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("i",{className:"fa-solid fa-camera block text-2xl mb-2"}),"Capa Principal"]}),e.jsx("input",{type:"file",ref:j,hidden:!0,accept:"image/*",onChange:P})]}),e.jsxs("div",{className:"gallery-scroll mt-4",children:[p.map((t,a)=>e.jsxs("div",{className:"gallery-item",children:[t.type==="video"?e.jsx("video",{src:t.url}):e.jsx("img",{src:t.url}),e.jsx("button",{type:"button",className:"remove-media",onClick:()=>z(a),children:e.jsx("i",{className:"fa-solid fa-xmark"})})]},a)),p.length<5&&e.jsx("div",{className:"gallery-item flex items-center justify-center cursor-pointer border-dashed",onClick:()=>w.current?.click(),children:e.jsx("i",{className:"fa-solid fa-plus text-gray-500"})}),e.jsx("input",{type:"file",ref:w,hidden:!0,accept:"image/*,video/*",multiple:!0,onChange:U})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("div",{className:"section-label",children:"Informações"}),e.jsx("div",{className:"input-group",children:e.jsx("div",{className:"input-wrapper",children:e.jsx("input",{type:"text",placeholder:"Título do Produto",value:l,onChange:t=>k(t.target.value),required:!0})})}),e.jsx("div",{className:"input-group",children:e.jsx("div",{className:"input-wrapper",children:e.jsx("input",{type:"text",placeholder:"Preço (Ex: 150,00)",value:c,onChange:M,required:!0})})}),e.jsx("div",{className:"input-group",children:e.jsx("div",{className:"input-wrapper",children:e.jsx("select",{value:x,onChange:t=>S(t.target.value),children:W.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))})})}),e.jsx("div",{className:"input-group",children:e.jsx("div",{className:"input-wrapper",children:e.jsx("input",{type:"text",placeholder:"Cidade / Estado",value:g,onChange:t=>I(t.target.value),required:!0})})}),e.jsx("div",{className:"input-group",children:e.jsx("div",{className:"input-wrapper",children:e.jsx("textarea",{rows:3,placeholder:"Descrição detalhada",value:f,onChange:t=>E(t.target.value),required:!0})})})]}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:!l||!c||!n||u,children:u?e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin"}):"Publicar Agora"})]})})]})};export{Z as CreateMarketplaceItem};

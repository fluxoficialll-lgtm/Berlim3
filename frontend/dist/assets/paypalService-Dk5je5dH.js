import{A as d,U as l}from"./index-BC19Iu_T.js";class S{defaultRetryConfig={maxRetries:3,initialDelay:1e3,maxDelay:5e3};async withRetry(t,r=this.defaultRetryConfig){let n,s=r.initialDelay;for(let a=0;a<=r.maxRetries;a++)try{return await t()}catch(o){if(n=o,o.message?.includes("API_KEY_INVALID")||o.message?.includes("Requested entity was not found"))throw o;a<r.maxRetries&&(console.warn(`[Connection] Tentativa ${a+1} falhou. Tentando novamente em ${s}ms...`),await new Promise(w=>setTimeout(w,s)),s=Math.min(s*2,r.maxDelay))}throw n}}class m extends S{async request(t,r,n){return this.withRetry(async()=>{try{const s=await fetch(t,{...r,headers:{"Content-Type":"application/json",...r.headers}}),a=await s.json().catch(()=>({}));if(!s.ok){if(a.error?.message?.includes("Requested entity was not found"))throw new Error(`GATEWAY_AUTH_ERROR: ${n}`);return{success:!1,error:a.error||a.message||`Erro no provedor ${n}`,statusCode:s.status}}return{success:!0,data:a}}catch(s){throw console.error(`[${n} Connection Error]:`,s.message),s}})}}const f=new m,c={gateways:f},i=`${d}/api/stripe`,h={authenticate:async e=>h.verifyCredentials(e),verifyCredentials:async e=>{const t=await c.gateways.request(`${i}/auth-token`,{method:"POST",body:JSON.stringify({secretKey:e})},"Stripe");if(!t.success)throw new Error(t.error);return t.data},createPaymentIntent:async(e,t,r)=>{const n=await c.gateways.request(`${i}/create-intent`,{method:"POST",body:JSON.stringify({group:e,ownerEmail:t,paymentMethodType:r,currency:e.currency?.toLowerCase()||"brl"})},"Stripe");if(!n.success)throw new Error(n.error);return n.data},createCheckoutSession:async(e,t)=>{const r=`${window.location.origin}/#/vip-group-sales/${e.id}?session_id={CHECKOUT_SESSION_ID}&success=true`,n=`${window.location.origin}/#/vip-group-sales/${e.id}?success=false`,s=await c.gateways.request(`${i}/create-session`,{method:"POST",body:JSON.stringify({group:e,ownerEmail:t,successUrl:r,cancelUrl:n})},"Stripe");if(!s.success)throw new Error(s.error);return s.data},checkSessionStatus:async(e,t)=>{const r=await c.gateways.request(`${i}/check-status`,{method:"POST",body:JSON.stringify({sessionId:e,ownerEmail:t})},"Stripe");if(!r.success)throw new Error(r.error);return r.data}},C={authenticate:async e=>(console.log("[MOCK] Stripe Authenticated with key:",e),{success:!0}),verifyCredentials:async e=>({success:!0}),createPaymentIntent:async(e,t,r)=>(console.log(`[MOCK] Creating Stripe ${r} Intent for:`,e.name),{id:"pi_mock_"+Math.random().toString(36).substr(2,9),client_secret:"pi_mock_secret_"+Math.random().toString(36).substr(2,9),next_action:{pix_display_qr_code:{data:"00020126360014BR.GOV.BCB.PIX0114MOCK-PIX-STRIPE520400005303986540510.005802BR5913FLUX-STRIPE6009SAO-PAULO62070503***6304E1D1"},oxxo_display_details:{number:"1234-5678-9012-34"}}}),createCheckoutSession:async(e,t)=>(console.log("[MOCK] Creating Stripe Checkout for:",e.name),{id:"cs_mock_"+Math.random().toString(36).substr(2,9),url:window.location.href+"?session_id=mock"}),checkSessionStatus:async(e,t)=>({status:"paid"})},g=l?C:h,u=`${d}/api/paypal`,y=async(e,t={})=>{const r=await fetch(e,t);if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error(n.error||`Request failed: ${r.status}`)}return r.json()},p={authenticate:async(e,t)=>p.verifyCredentials(e,t),verifyCredentials:async(e,t)=>y(`${u}/auth-token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:e,clientSecret:t})}),createOrder:async(e,t)=>y(`${u}/create-order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:parseFloat(e.price||"0"),currency:e.currency||"BRL",description:`Acesso VIP: ${e.name}`,ownerEmail:t})}),checkOrderStatus:async(e,t)=>y(`${u}/check-status`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,ownerEmail:t})})},O={authenticate:async(e,t)=>(console.log("[MOCK] PayPal Authenticated:",e),{success:!0}),verifyCredentials:async(e,t)=>({success:!0}),createOrder:async(e,t)=>(console.log("[MOCK] Creating PayPal Order for:",e.name),{id:"PAY-MOCK-"+Math.random().toString(36).substr(2,9).toUpperCase(),approvalLink:window.location.href+"?token=mock",status:"CREATED"}),checkOrderStatus:async(e,t)=>({status:"paid"})},P=l?O:p;export{P as p,g as s};

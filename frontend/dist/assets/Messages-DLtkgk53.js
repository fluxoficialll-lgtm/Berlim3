import{j as e,u as E,r as n,c as P,k as C,n as B}from"./index-BC19Iu_T.js";import{M as D}from"./MainHeader-C_NQXNMS.js";import{U as H}from"./UserAvatar-BWaKHm2D.js";const q=({isOpen:t,onClose:i,onSelectMode:u,onMarkAllRead:r,onViewBlocked:m})=>{if(!t)return null;const j=[{label:"Selecionar conversas",icon:"fa-solid fa-check-double",onClick:u},{label:"Marcar todas como lidas",icon:"fa-solid fa-envelope-open-text",onClick:r},{label:"Usuários Bloqueados",icon:"fa-solid fa-user-shield",onClick:m}];return e.jsx("div",{className:"fixed inset-0 z-[100] bg-transparent",onClick:i,children:e.jsx("div",{className:"absolute top-[70px] left-4 w-[240px] bg-[#1a1e26] rounded-2xl p-2 shadow-2xl animate-pop-in border border-white/10",onClick:c=>c.stopPropagation(),children:e.jsx("div",{className:"flex flex-col gap-1",children:j.map((c,g)=>e.jsxs("button",{onClick:()=>{c.onClick(),i()},className:"w-full flex items-center gap-3 p-3 hover:bg-white/5 text-white rounded-xl transition-all active:scale-[0.98]",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center bg-[#00c2ff1a] flex-shrink-0",children:e.jsx("i",{className:`${c.icon} text-[#00c2ff] text-xs`})}),e.jsx("span",{className:"font-bold text-xs",children:c.label})]},g))})})})},F=({contact:t,isSelected:i,isSelectionMode:u,onClick:r,onAvatarClick:m})=>e.jsxs("div",{className:`flex items-center p-3 border-b border-white/5 cursor-pointer transition-all relative ${i?"bg-[#00c2ff]/10":"hover:bg-white/[0.02]"}`,onClick:r,children:[u&&e.jsx("div",{className:`w-5 h-5 rounded-full border-2 mr-4 flex items-center justify-center flex-shrink-0 ${i?"bg-[#00c2ff] border-[#00c2ff]":"border-gray-600"}`,children:i&&e.jsx("span",{className:"text-[10px] text-black font-bold",children:"✔"})}),e.jsxs("div",{className:"relative flex-shrink-0 mr-4",children:[e.jsx(H,{src:t.avatar,className:"w-[50px] h-[50px]",onClick:m}),t.isOnline&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-[#00ff82] rounded-full border-2 border-[#0c0f14]"})]}),e.jsxs("div",{className:"flex flex-col flex-grow min-w-0 mr-2.5",children:[e.jsx("div",{className:"font-bold text-base mb-0.5 whitespace-nowrap overflow-hidden text-ellipsis text-white",children:t.name}),e.jsx("div",{className:`text-sm whitespace-nowrap overflow-hidden text-ellipsis ${t.unreadCount>0?"text-white font-semibold":"text-gray-400"}`,children:t.lastMessage})]}),e.jsxs("div",{className:"flex flex-col items-end flex-shrink-0",children:[e.jsx("div",{className:`text-[10px] uppercase font-bold ${t.unreadCount>0?"text-[#00c2ff]":"text-gray-500"}`,children:t.time}),t.unreadCount>0&&e.jsx("div",{className:"bg-[#ff4d4d] text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[20px] text-center mt-1",children:t.unreadCount})]})]}),G=()=>e.jsxs("div",{className:"text-center py-20 opacity-20",children:[e.jsx("i",{className:"fa-regular fa-comment-dots text-5xl mb-4"}),e.jsx("p",{className:"font-bold uppercase tracking-widest text-sm",children:"Sem conversas privadas"})]}),J=({uiVisible:t,unreadMsgs:i,unreadNotifs:u})=>{const r=E();return e.jsxs("footer",{className:`fixed bottom-0 left-0 w-full bg-[#0c0f14] flex justify-around py-3.5 rounded-t-2xl z-20 shadow-[0_-2px_10px_rgba(0,0,0,0.5)] transition-transform duration-300 ${t?"translate-y-0":"translate-y-full"}`,children:[e.jsx("button",{onClick:()=>r("/feed"),className:"text-[#00c2ff] text-[22px] p-2",children:e.jsx("i",{className:"fa-solid fa-newspaper"})}),e.jsxs("button",{className:"text-white text-[22px] p-2 relative",children:[e.jsx("i",{className:"fa-solid fa-comments"}),i>0&&e.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 bg-[#ff4d4d] rounded-full"})]}),e.jsxs("button",{onClick:()=>r("/notifications"),className:"text-[#00c2ff] text-[22px] p-2 relative",children:[e.jsx("i",{className:"fa-solid fa-bell"}),u>0&&e.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 bg-[#ff4d4d] rounded-full"})]}),e.jsx("button",{onClick:()=>r("/profile"),className:"text-[#00c2ff] text-[22px] p-2",children:e.jsx("i",{className:"fa-solid fa-user"})})]})},se=()=>{const t=E(),[i,u]=n.useState(!0),r=n.useRef(null),[m,j]=n.useState([]),[c,g]=n.useState(!1),[p,w]=n.useState(!1),[N,v]=n.useState([]),[L,$]=n.useState(0),[A,I]=n.useState(0),k=s=>{if(!s)return"Offline";if(Date.now()-s<120*1e3)return"online";const o=new Date(s);return`Visto por último às ${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`},b=n.useCallback(()=>{const s=P.getCurrentUserEmail();if(!s)return;const a=s.toLowerCase(),o=C.getAllChats(),T=Object.values(o).map(l=>{const h=l.id.toString().toLowerCase();if(!h.includes("@")||!h.includes(a))return null;const V=l.messages.filter(x=>(x.senderEmail||x.senderId||"").toLowerCase()!==a&&x.status!=="read").length,f=l.messages.length>0?l.messages[l.messages.length-1]:null;if(!f)return null;const z=((f.senderEmail?.toLowerCase()||f.senderId?.toLowerCase())===a?"Você: ":"")+(f.contentType==="text"?f.text:"Mídia"),M=h.split("_").find(x=>x.toLowerCase()!==a);let S=l.contactName,y="",U,d;return M&&(d=Object.values(db.users.getAll()).find(x=>x.email.toLowerCase()===M.toLowerCase()),d&&(S=d.profile?.nickname||d.profile?.name||"Usuário",y=d.profile?.name||"",U=d.profile?.photoUrl)),{id:l.id.toString(),name:S,handle:y,avatar:U,lastMessage:z,lastMessageTime:f.id,time:f.timestamp,status:k(d?.lastSeen),isOnline:k(d?.lastSeen)==="online",unreadCount:V}}).filter(l=>l!==null).sort((l,h)=>h.lastMessageTime-l.lastMessageTime);j(T)},[]);n.useEffect(()=>{b();const s=db.subscribe("chats",b),a=db.subscribe("users",b);return()=>{s(),a()}},[b]),n.useEffect(()=>{const s=()=>{$(B.getUnreadCount()),I(C.getUnreadCount())};s();const a=db.subscribe("notifications",s),o=db.subscribe("chats",s);return()=>{a(),o()}},[]);const _=()=>{C.markAllAsRead(),b()},O=s=>{p?v(a=>a.includes(s.id)?a.filter(o=>o!==s.id):[...a,s.id]):t(`/chat/${s.id}`)},R=(s,a)=>{s.stopPropagation(),a&&t(`/user/${a.replace("@","")}`)};return e.jsxs("div",{className:"h-[100dvh] bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-hidden",children:[e.jsx(D,{leftContent:p?e.jsx("button",{onClick:()=>{w(!1),v([])},className:"text-[#00c2ff] text-lg",children:e.jsx("i",{className:"fa-solid fa-xmark"})}):e.jsx("button",{onClick:()=>g(!0),className:"text-[#00c2ff] text-lg",children:e.jsx("i",{className:"fa-solid fa-sliders"})}),rightContent:p?e.jsx("button",{onClick:()=>{window.confirm("Apagar?")&&(w(!1),v([]))},disabled:N.length===0,className:"text-[#ff4d4d] text-lg disabled:opacity-30",children:e.jsx("i",{className:"fa-solid fa-trash"})}):e.jsx("button",{onClick:()=>t("/groups"),className:"text-[#00c2ff] text-lg",children:e.jsx("i",{className:"fa-solid fa-users"})})}),e.jsxs("main",{ref:r,className:"flex-grow pt-[80px] pb-[100px] overflow-y-auto no-scrollbar",children:[p&&e.jsxs("div",{className:"w-full text-center py-2 bg-[#0f2b38] font-bold text-xs sticky top-0 z-10",children:[N.length," selecionada(s)"]}),e.jsx("div",{className:"w-full",children:m.length>0?m.map(s=>e.jsx(F,{contact:s,isSelected:N.includes(s.id),isSelectionMode:p,onClick:()=>O(s),onAvatarClick:a=>R(a,s.handle)},s.id)):e.jsx(G,{})})]}),e.jsx(J,{uiVisible:i,unreadMsgs:A,unreadNotifs:L}),e.jsx(q,{isOpen:c,onClose:()=>g(!1),onSelectMode:()=>w(!0),onMarkAllRead:_,onViewBlocked:()=>t("/blocked-users")})]})};export{se as Messages};

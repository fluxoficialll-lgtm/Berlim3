import{j as e,c as s,A as a,e as t,r,u as l,f as i}from"./index-CipjSFYz.js";import{u as n}from"./useGroupSettings-CtoaHUac.js";const o=({value:s,onChange:a})=>e.jsxs("div",{className:"relative mb-4",children:[e.jsx("i",{className:"fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-white/20 text-xs"}),e.jsx("input",{type:"text",className:"input-field pl-10 border-white/5",placeholder:"Pesquisar @membro...",value:s,onChange:e=>a(e.target.value)})]}),c=({children:s})=>e.jsx("div",{className:"space-y-1 max-h-[350px] overflow-y-auto no-scrollbar pr-1",children:s}),d=({member:s,isAdmin:a,onAction:t,onRoleClick:r})=>{if(!s||!s.id)return null;const l="Dono"===s.role;return s.role,e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/[0.02] border border-white/5 rounded-xl transition-all hover:bg-white/[0.04]",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[s.avatar?e.jsx("img",{src:s.avatar,className:"w-10 h-10 rounded-full object-cover border border-white/10",alt:"Av"}):e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-white/5 text-white/40 border border-white/5",children:e.jsx("i",{className:"fa-solid fa-user text-xs"})}),l&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 rounded-full flex items-center justify-center border-2 border-[#1a1e26] bg-[#FFD700]",children:e.jsx("i",{className:"fa-solid fa-crown text-[6px] text-black"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm font-bold text-white/90 truncate flex items-center gap-1.5",children:[s.name,s.isMe&&e.jsx("span",{className:"text-[8px] bg-[#00c2ff]/20 text-[#00c2ff] px-1.5 py-0.5 rounded uppercase font-black",children:"Você"})]}),e.jsxs("div",{onClick:()=>!l&&a&&(null==r?void 0:r(s.id,s.name,s.roleId)),className:"text-[9px] font-black uppercase tracking-widest flex items-center gap-1 "+(!l&&a?"text-[#00c2ff] cursor-pointer hover:underline":"text-white/20"),children:[s.role,!l&&a&&e.jsx("i",{className:"fa-solid fa-pen-to-square text-[7px]"})]})]}),a&&!s.isMe&&!l&&e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:()=>t(s.id,"kick"),className:"w-8 h-8 rounded-lg flex items-center justify-center text-white/30 hover:text-red-500 transition-all active:scale-90",title:"Expulsar",children:e.jsx("i",{className:"fa-solid fa-user-xmark text-xs"})})})]})},x=({isOpen:s,onClose:a,roles:t,currentRoleId:r,onAssign:l,memberName:i})=>s?e.jsx("div",{className:"fixed inset-0 z-[110] bg-black/90 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in",onClick:a,children:e.jsxs("div",{className:"bg-[#1a1e26] border border-white/10 rounded-[40px] w-full max-w-sm overflow-hidden shadow-2xl animate-pop-in",onClick:e=>e.stopPropagation(),children:[e.jsxs("header",{className:"p-8 pb-4 text-center border-b border-white/5",children:[e.jsx("div",{className:"w-16 h-16 bg-[#00c2ff1a] rounded-2xl flex items-center justify-center mx-auto mb-4 border border-[#00c2ff33] text-[#00c2ff] text-2xl",children:e.jsx("i",{className:"fa-solid fa-user-gear"})}),e.jsx("h3",{className:"text-lg font-black text-white uppercase tracking-widest mb-1",children:"Atribuir Cargo"}),e.jsxs("p",{className:"text-xs text-gray-500 italic",children:["Definindo permissões para ",e.jsx("strong",{children:i})]})]}),e.jsx("div",{className:"p-6 space-y-2 max-h-[350px] overflow-y-auto no-scrollbar",children:(t||[]).length>0?t.map(s=>{const t=r===s.id;return e.jsxs("button",{onClick:()=>{l(s.id),a()},className:"w-full flex items-center justify-between p-4 rounded-2xl border transition-all active:scale-[0.98] "+(t?"bg-[#00c2ff1a] border-[#00c2ff] shadow-[0_0_15px_rgba(0,194,255,0.1)]":"bg-white/5 border-white/5 hover:border-white/10"),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-3 h-3 rounded-full shrink-0 shadow-sm",style:{backgroundColor:s.color,boxShadow:`0 0 8px ${s.color}66`}}),e.jsxs("div",{className:"flex flex-col text-left truncate",children:[e.jsx("span",{className:"text-sm font-bold truncate "+(t?"text-[#00c2ff]":"text-white"),children:s.name}),t&&e.jsx("span",{className:"text-[8px] font-black text-[#00c2ff] uppercase tracking-widest mt-0.5",children:"Cargo Atual"})]})]}),t?e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#00c2ff] flex items-center justify-center text-black text-[10px]",children:e.jsx("i",{className:"fa-solid fa-check"})}):e.jsx("i",{className:"fa-solid fa-chevron-right text-gray-700 text-[10px]"})]},s.id)}):e.jsxs("div",{className:"py-12 text-center opacity-30",children:[e.jsx("i",{className:"fa-solid fa-id-card-clip text-4xl mb-4"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest px-10",children:"Nenhum cargo disponível."})]})}),e.jsx("footer",{className:"p-4 bg-[#0c0f14] border-t border-white/5",children:e.jsx("button",{onClick:a,className:"w-full py-4 text-gray-500 font-black uppercase text-[10px] tracking-[3px] hover:text-white transition-colors",children:"Cancelar"})})]})}):null,m={async logAction(e,t,r){var l,i;const n=s.getCurrentUser();if(n)try{await fetch(`${a}/api/audit/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:e,adminId:n.id,adminName:(null==(l=n.profile)?void 0:l.nickname)||(null==(i=n.profile)?void 0:i.name)||"Admin",action:t,targetInfo:r})})}catch(o){}}},f=({groupId:s,isAdmin:a,members:l,onAction:i,searchQuery:n,onSearchChange:f,availableRoles:h})=>{const{isModalOpen:p,setIsModalOpen:u,selectedMember:b,openAssignment:g,handleAssignRole:j}=(e=>{const{showAlert:s}=t(),[a,l]=r.useState(!1),[i,n]=r.useState(null);return{isModalOpen:a,setIsModalOpen:l,selectedMember:i,openAssignment:(e,s,a)=>{n({id:e,name:s,currentRole:a}),l(!0)},handleAssignRole:async a=>{if(i)try{await m.logAction(e,"ALTERACAO_CARGO",`Cargo de ${i.name} alterado para ID: ${a}`),await s("Sucesso",`O cargo de ${i.name} foi atualizado.`),l(!1)}catch(t){await s("Erro","Falha ao atualizar cargo.")}}}})(s);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx(o,{value:n,onChange:f}),e.jsx(c,{children:l.length>0?l.map(s=>e.jsx(d,{member:s,isAdmin:a,onAction:i,onRoleClick:g},s.id)):e.jsxs("div",{className:"text-center py-20 opacity-30 flex flex-col items-center gap-3",children:[e.jsx("i",{className:"fa-solid fa-user-slash text-3xl"}),e.jsx("p",{className:"italic text-xs uppercase font-black tracking-widest",children:"Nenhum membro encontrado"})]})}),e.jsx(x,{isOpen:p,onClose:()=>u(!1),roles:h,currentRoleId:null==b?void 0:b.currentRole,memberName:(null==b?void 0:b.name)||"",onAssign:j})]})},h=()=>{const s=l(),{id:a}=i(),{group:t,loading:r,isAdmin:o,handleMemberAction:c,form:d}=n();return r||!t?e.jsx("div",{className:"min-h-screen bg-[#0c0f14] flex items-center justify-center text-white",children:e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-2xl text-[#00c2ff]"})}):e.jsxs("div",{className:"min-h-screen bg-[#0a0c10] text-white font-['Inter'] flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center p-4 bg-[#0c0f14] border-b border-white/10 h-[65px] sticky top-0 z-50",children:[e.jsx("button",{onClick:()=>s(`/group-settings/${a}`),className:"mr-4 text-white text-xl p-2 hover:bg-white/5 rounded-full transition-all",children:e.jsx("i",{className:"fa-solid fa-arrow-left"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"font-bold text-sm",children:"Gerenciar Membros"}),e.jsxs("span",{className:"text-[10px] text-[#00c2ff] font-black uppercase tracking-widest",children:[d.members.length," participantes"]})]})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-5 max-w-[600px] mx-auto w-full pb-10 no-scrollbar",children:[e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-6",children:e.jsx(f,{groupId:a||"",isAdmin:o,members:d.members||[],onAction:c,searchQuery:d.searchQuery,onSearchChange:d.setSearchQuery,availableRoles:d.roles||[]})}),e.jsx("div",{className:"mt-8 bg-blue-500/5 border border-blue-500/10 p-5 rounded-2xl",children:e.jsx("p",{className:"text-[10px] text-gray-500 leading-relaxed text-center italic",children:'"Como administrador, você pode promover membros a moderadores ou removê-los da comunidade em tempo real."'})})]})]})};export{h as GroupMembersPage};

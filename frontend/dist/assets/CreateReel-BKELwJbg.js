import{u as ie,a as se,r as a,c as P,g as ne,j as e,h as le}from"./index-BC19Iu_T.js";import{r as E}from"./reelsService-v3uh_RdW.js";import{c as re}from"./contentSafetyService-BoymUvRp.js";import"./postService-XFLx8Vj8.js";const C={Brasil:{Ceará:["Fortaleza","Eusébio","Aquiraz","Sobral"],"São Paulo":["São Paulo","Campinas","Santos","Guarulhos"],"Rio de Janeiro":["Rio de Janeiro","Niterói","Cabo Frio"],"Minas Gerais":["Belo Horizonte","Uberlândia","Ouro Preto"]},"Estados Unidos":{California:["Los Angeles","San Francisco","San Diego"],"New York":["New York City","Buffalo"],Florida:["Miami","Orlando"]}},me=()=>{const h=ie(),d=se().state?.isAd||!1,[u,L]=a.useState(null),[w,O]=a.useState(null),[l,T]=a.useState(""),[x,B]=a.useState(""),[S,F]=a.useState(!0),[b,N]=a.useState(!1),[f,R]=a.useState(""),[D,U]=a.useState(""),[V,g]=a.useState(!1),[s,M]=a.useState(""),[n,k]=a.useState(""),[v,j]=a.useState(""),[y,G]=a.useState("Global"),[$,m]=a.useState(!1),[I,J]=a.useState([]),[o,A]=a.useState(null),[Y,pe]=a.useState(!0),r=P.getCurrentUser();a.useEffect(()=>{const t=!!u,i=l.trim().length>0,p=d?f&&parseFloat(f)>=10:!0;let c=!0;o&&o.status==="inactive"&&(c=!1),F(!(t&&(i||o&&c))||!p||b)},[u,l,b,f,d,o]),a.useEffect(()=>{const t=P.getCurrentUserEmail();if(t){const p=ne.getGroupsSync().filter(c=>c.creatorEmail===t);J(p)}},[]);const _=t=>{const i=t.target.files?.[0];i&&(L(i),O(URL.createObjectURL(i)))},q=()=>{window.history.state&&window.history.state.idx>0?h(-1):h("/reels")},H=t=>{t.preventDefault(),!(S||!u)&&(N(!0),setTimeout(async()=>{try{const i=await E.uploadVideo(u),p=`${x} ${l}`,c=await re.analyzeContent(p,[{url:i,type:"video"}]);let z=!1;c.isAdult&&(z=!0);const te=r?.profile?.name?`@${r.profile.name}`:"@usuario",ae=r?.profile?.photoUrl,oe={id:Date.now().toString(),type:"video",authorId:r?.id||"",username:te,avatar:ae,title:x,text:l,video:i,time:"Agora",timestamp:Date.now(),isPublic:!0,isAdultContent:z,views:0,likes:0,comments:0,liked:!1,location:y==="Global"?void 0:y,relatedGroupId:o?.id};await E.addReel(oe),o?.isVip&&Y&&!d&&await le.createCampaign({id:Date.now().toString(),ownerId:r?.id||"",name:`Auto-Boost (Reel): ${o.name}`,ownerEmail:r?.email||"",scheduleType:"continuous",budget:0,pricingModel:"commission",trafficObjective:"conversions",creative:{text:l||x,mediaUrl:i,mediaType:"video"},campaignObjective:"group_joins",destinationType:"group",targetGroupId:o.id,optimizationGoal:"group_joins",placements:["feed","reels","marketplace"],ctaButton:"Entrar",status:"active",timestamp:Date.now()}),h("/reels")}catch(i){console.error("Erro ao publicar:",i),alert("Erro ao publicar.")}finally{N(!1)}},50))},W=t=>{M(t.target.value),k(""),j("")},K=t=>{k(t.target.value),j("")},Q=()=>{let t="Global";v?t=`${v}, ${n}`:n?t=`${n}, Brasil`:s&&(t=s==="Brasil"?"Global":s),G(t),g(!1)},X=Object.keys(C),Z=s?Object.keys(C[s]||{}):[],ee=s&&n?C[s][n]||[]:[];return e.jsxs("div",{className:"h-screen flex flex-col bg-[#0c0f14] text-white font-['Inter'] overflow-hidden",children:[e.jsx("style",{children:`
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); height: 60px; z-index: 50; background: #0c0f14; }
        header button { background: none; border: none; font-size: 16px; color: #fff; cursor: pointer; }
        header .publish-btn { background: #00c2ff; color: #000; padding: 6px 16px; border-radius: 20px; font-weight: 700; font-size: 14px; opacity: 1; transition: opacity 0.3s; }
        header .publish-btn:disabled { opacity: 0.5; cursor: not-allowed; background: #333; color: #777; }

        main { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; align-items: center; }

        .video-upload-area {
            width: 180px; aspect-ratio: 9/16; background: #1a1e26; border-radius: 12px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 2px dashed rgba(255,255,255,0.1); cursor: pointer; position: relative; overflow: hidden;
            transition: border-color 0.3s; margin-top: 10px;
        }
        .video-upload-area:hover { border-color: #00c2ff; }
        .video-upload-area video { width: 100%; height: 100%; object-fit: cover; }
        .placeholder { display: flex; flex-direction: column; align-items: center; gap: 10px; color: #555; }
        .placeholder i { font-size: 30px; color: #00c2ff; }
        .placeholder span { font-size: 12px; font-weight: 600; }

        .input-group { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 10px; }
        .input-field {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px; padding: 12px 15px; color: #fff; font-size: 14px; outline: none;
            width: 100%; transition: 0.3s;
        }
        .input-field:focus { border-color: #00c2ff; background: rgba(255,255,255,0.08); }
        textarea.input-field { resize: vertical; min-height: 80px; }

        .settings-list { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 2px; }
        .setting-item { display: flex; align-items: center; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .setting-left { display: flex; align-items: center; gap: 10px; color: #fff; font-size: 15px; font-weight: 500; }
        .setting-icon { color: #888; width: 20px; text-align: center; }
        .setting-value { color: #00c2ff; font-size: 14px; margin-right: 10px; font-weight: 600; }
        .chevron { color: #555; font-size: 12px; }

        .ad-box { width: 100%; max-width: 400px; background: rgba(255,215,0,0.05); border: 1px solid rgba(255,215,0,0.2); border-radius: 10px; padding: 15px; }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; display: flex; align-items: center; justify-content: center; }
        .modal { background: #1a1e26; width: 90%; max-width: 350px; border-radius: 16px; padding: 20px; border: 1px solid #333; }
        .modal select { width: 100%; background: #0c0f14; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 8px; margin-bottom: 10px; outline: none; }
        .modal-actions { display: flex; gap: 10px; margin-top: 15px; }
        .modal-btn { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; }
        .save-btn { background: #00c2ff; color: #000; }
        .cancel-btn { background: transparent; border: 1px solid #555; color: #aaa; }
        
        .group-list { max-height: 200px; overflow-y: auto; }
        .group-item { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; display: flex; align-items: center; gap: 10px; }
      `}),e.jsxs("header",{children:[e.jsx("button",{onClick:q,children:"Cancelar"}),e.jsx("span",{style:{fontWeight:700,fontSize:"16px"},children:"Novo Reel"}),e.jsx("button",{className:"publish-btn",disabled:S,onClick:H,children:b?"...":d?"Confirmar":"Publicar"})]}),e.jsxs("main",{children:[d&&e.jsxs("div",{className:"ad-box",children:[e.jsx("div",{style:{color:"#FFD700",fontSize:"12px",fontBlack:"900",marginBottom:"5px"},children:"IMPULSIONAMENTO PUBLICITÁRIO"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Investimento (Min R$ 10,00)",value:f,onChange:t=>R(t.target.value),style:{borderColor:"#FFD700"}}),e.jsx("input",{type:"text",className:"input-field",placeholder:"Link de Ação",value:D,onChange:t=>U(t.target.value),style:{marginTop:"10px",borderColor:"#FFD700"}})]}),e.jsxs("div",{className:"video-upload-area",onClick:()=>document.getElementById("videoInput")?.click(),children:[w?e.jsx("video",{src:w,controls:!1,autoPlay:!0,muted:!0,loop:!0}):e.jsxs("div",{className:"placeholder",children:[e.jsx("i",{className:"fa-solid fa-plus"}),e.jsx("span",{children:"Selecionar Vídeo"})]}),e.jsx("input",{type:"file",id:"videoInput",hidden:!0,accept:"video/*",onChange:_})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",className:"input-field",placeholder:"Título (Opcional)",value:x,onChange:t=>B(t.target.value),maxLength:50}),e.jsx("textarea",{className:"input-field",placeholder:"Escreva uma legenda...",value:l,onChange:t=>T(t.target.value),maxLength:2200})]}),e.jsxs("div",{className:"settings-list",children:[e.jsxs("div",{className:"setting-item",onClick:()=>g(!0),children:[e.jsxs("div",{className:"setting-left",children:[e.jsx("i",{className:"fa-solid fa-location-dot setting-icon"}),e.jsx("span",{children:"Direcionamento Regional"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{className:"setting-value",children:y}),e.jsx("i",{className:"fa-solid fa-chevron-right chevron"})]})]}),e.jsxs("div",{className:"setting-item",onClick:()=>m(!0),children:[e.jsxs("div",{className:"setting-left",children:[e.jsx("i",{className:"fa-solid fa-users setting-icon"}),e.jsx("span",{children:"Vincular Comunidade"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{className:"setting-value",style:{color:o?"#00ff82":"#555"},children:o?o.name.substring(0,15)+"...":"Nenhum"}),o&&e.jsx("i",{className:"fa-solid fa-xmark",style:{marginLeft:"5px",color:"#ff4d4d"},onClick:t=>{t.stopPropagation(),A(null)}}),!o&&e.jsx("i",{className:"fa-solid fa-chevron-right chevron"})]})]})]})]}),V&&e.jsx("div",{className:"modal-overlay",onClick:()=>g(!1),children:e.jsxs("div",{className:"modal",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{style:{color:"#fff",marginBottom:"15px",textAlign:"center"},children:"Alcance do Reel"}),e.jsxs("select",{value:s,onChange:W,children:[e.jsx("option",{value:"",children:"Global (Todos)"}),X.map(t=>e.jsx("option",{value:t,children:t},t))]}),s&&e.jsxs("select",{value:n,onChange:K,children:[e.jsx("option",{value:"",children:"Todo o País"}),Z.map(t=>e.jsx("option",{value:t,children:t},t))]}),n&&e.jsxs("select",{value:v,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"",children:"Todo o Estado"}),ee.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"modal-btn cancel-btn",onClick:()=>{G("Global"),g(!1)},children:"Resetar"}),e.jsx("button",{className:"modal-btn save-btn",onClick:Q,children:"Aplicar"})]})]})}),$&&e.jsx("div",{className:"modal-overlay",onClick:()=>m(!1),children:e.jsxs("div",{className:"modal",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{style:{color:"#fff",marginBottom:"15px",textAlign:"center"},children:"Selecionar Grupo"}),e.jsx("div",{className:"group-list",children:I.length>0?I.map(t=>e.jsxs("div",{className:"group-item",onClick:()=>{A(t),m(!1)},children:[e.jsx("i",{className:`fa-solid ${t.isVip?"fa-crown text-[#FFD700]":"fa-users text-[#ccc]"}`}),e.jsx("span",{style:{color:"#fff",fontSize:"14px"},children:t.name})]},t.id)):e.jsx("div",{style:{textAlign:"center",color:"#555"},children:"Nenhum grupo encontrado."})}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{className:"modal-btn cancel-btn",onClick:()=>m(!1),children:"Fechar"})})]})})]})};export{me as CreateReel};

import{u as L,r as a,c as f,j as e,d as S}from"./index-BC19Iu_T.js";import{p as M}from"./postService-XFLx8Vj8.js";import{I as q}from"./ImageCropModal-DKSoCquK.js";const W=()=>{const i=L(),[s,p]=a.useState(""),[b,m]=a.useState(""),[h,I]=a.useState(""),[x,g]=a.useState("public"),[u,v]=a.useState(null),[w,P]=a.useState(null),[j,N]=a.useState(!1),[_,n]=a.useState(""),[o,c]=a.useState(""),[E,y]=a.useState(!1),[F,U]=a.useState(""),k=a.useRef(null),d=f.getCurrentUserEmail();a.useEffect(()=>{if(!d){i("/");return}const t=f.getCurrentUser();t&&t.profile&&(t.profile.name&&!t.profile.name.startsWith("google_user_")?p(t.profile.name):p(""),t.profile.nickname&&t.profile.nickname!=="Google User"?m(t.profile.nickname):m(""),t.profile.photoUrl&&v(t.profile.photoUrl))},[d,i]);const A=t=>{const r=t.target.files?.[0];if(r){const l=new FileReader;l.onload=B=>{U(B.target?.result),y(!0)},l.readAsDataURL(r)}},R=t=>{v(t),fetch(t).then(r=>r.blob()).then(r=>{const l=new File([r],"avatar.jpg",{type:"image/jpeg"});P(l)})},C=()=>{k.current?.click()},T=t=>{const r=t.target.value.toLowerCase().replace(/[^a-z0-9_.]/g,"");p(r),o&&c("")},O=async()=>{if(!(!s||s.length<3))try{const t=await f.checkUsernameAvailability(s);c(t?"":"Nome indisponível")}catch(t){console.error(t)}},z=async t=>{if(t.preventDefault(),n(""),!s){n("O nome de usuário (@) é obrigatório.");return}if(s.length<3){n("O nome de usuário deve ter no mínimo 3 caracteres.");return}if(!o){N(!0);try{if(d){let r=u||void 0;w&&(r=await M.uploadMedia(w,"avatars")),await f.completeProfile(d,{name:s.trim(),nickname:b.trim()||s,bio:h.trim(),isPrivate:x==="private",photoUrl:r}),setTimeout(()=>{const l=sessionStorage.getItem("redirect_after_login");l?(sessionStorage.removeItem("redirect_after_login"),i(l)):i("/feed")},1e3)}}catch(r){console.error("Submit Error:",r),r.message===S.NAME_TAKEN||r.message.includes("indisponível")?c(S.NAME_TAKEN):n(r.message),N(!1)}}};return e.jsxs("div",{className:"h-screen w-full overflow-y-auto bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter']",children:[e.jsx("div",{className:"min-h-full flex flex-col items-center justify-center p-[30px_20px] overflow-x-hidden",children:e.jsxs("div",{className:"w-full max-w-[400px] bg-white/5 backdrop-blur-md rounded-[20px] p-[30px_25px] shadow-[0_10px_30px_rgba(0,0,0,0.5)] border border-white/10 text-center my-auto",children:[e.jsxs("div",{className:"w-[60px] h-[60px] bg-white/5 rounded-2xl flex items-center justify-center mb-5 transition-transform duration-500 cursor-default shadow-[0_0_20px_rgba(0,194,255,0.3),inset_0_0_20px_rgba(0,194,255,0.08)] mx-auto relative",children:[e.jsx("div",{className:"absolute w-[40px] h-[22px] rounded-[50%] border-[3px] border-[#00c2ff] rotate-[25deg]"}),e.jsx("div",{className:"absolute w-[40px] h-[22px] rounded-[50%] border-[3px] border-[#00c2ff] -rotate-[25deg]"})]}),e.jsx("h1",{className:"text-2xl font-extrabold mb-[5px] text-white drop-shadow-[0_0_5px_rgba(0,194,255,0.5)]",children:"Crie sua Identidade"}),e.jsx("p",{className:"text-[15px] text-white/70 mb-[25px]",children:"Personalize seu acesso ao Flux."}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"flex flex-col items-center mb-[30px]",children:[e.jsx("div",{onClick:C,className:"w-[100px] h-[100px] rounded-full bg-white/10 border-[3px] border-[#00c2ff] mb-[10px] flex items-center justify-center text-4xl text-[#00c2ff] cursor-pointer transition-all hover:shadow-[0_0_15px_rgba(0,194,255,0.5)] overflow-hidden relative",children:u?e.jsx("img",{src:u,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx("i",{className:"fa-solid fa-user"})}),e.jsx("input",{type:"file",id:"profile-pic-input",ref:k,accept:"image/*",onChange:A,className:"hidden"}),e.jsx("span",{onClick:C,className:"text-sm text-[#00c2ff] cursor-pointer",children:"Adicionar Foto"})]}),e.jsxs("div",{className:"relative mb-5 text-left w-full",children:[e.jsx("label",{htmlFor:"usernameInput",className:"block mb-[5px] text-sm font-semibold text-[#00c2ff]",children:"* @Seu_Arroba (Obrigatório)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:"@"}),e.jsx("input",{type:"text",id:"usernameInput",placeholder:"exemplo.flux",required:!0,value:s,onChange:T,onBlur:O,className:`w-full p-3 pl-8 bg-white/10 border rounded-[10px] text-white text-base outline-none transition-all focus:bg-[rgba(0,194,255,0.1)] focus:shadow-[0_0_8px_rgba(0,194,255,0.8)] placeholder-gray-400 ${o?"border-red-500":"border-[#00c2ff]"}`})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"Apenas minúsculas, números, ponto e underline."}),o&&e.jsx("span",{className:"text-xs text-red-400 mt-1 block font-bold",children:o})]}),e.jsxs("div",{className:"relative mb-5 text-left w-full",children:[e.jsx("label",{htmlFor:"nicknameInput",className:"block mb-[5px] text-sm font-semibold text-[#00c2ff]",children:"Nome de Exibição (Como você quer ser chamado)"}),e.jsx("input",{type:"text",id:"nicknameInput",placeholder:"Seu Nome Real ou Fantasia",value:b,onChange:t=>m(t.target.value),className:"w-full p-3 bg-white/10 border border-[#00c2ff] rounded-[10px] text-white text-base outline-none transition-all focus:bg-[rgba(0,194,255,0.1)] focus:shadow-[0_0_8px_rgba(0,194,255,0.8)] placeholder-gray-400"})]}),e.jsxs("div",{className:"relative mb-5 text-left w-full",children:[e.jsx("label",{htmlFor:"bioInput",className:"block mb-[5px] text-sm font-semibold text-[#00c2ff]",children:"Biografia"}),e.jsx("textarea",{id:"bioInput",placeholder:"Conte um pouco sobre você...",rows:2,maxLength:150,value:h,onChange:t=>I(t.target.value),className:"w-full p-3 bg-white/10 border border-[#00c2ff] rounded-[10px] text-white text-base outline-none transition-all focus:bg-[rgba(0,194,255,0.1)] focus:shadow-[0_0_8px_rgba(0,194,255,0.8)] resize-none placeholder-gray-400"})]}),e.jsxs("div",{className:"mb-[25px] text-left",children:[e.jsx("label",{className:"block mb-[5px] text-sm font-semibold text-[#00c2ff]",children:"* Privacidade do Perfil"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"inline-flex items-center cursor-pointer group",children:[e.jsx("input",{type:"radio",id:"publicProfile",name:"profileType",value:"public",checked:x==="public",onChange:()=>g("public"),className:"appearance-none w-[18px] h-[18px] rounded-full border-2 border-[#00c2ff] mr-2 outline-none transition-all relative cursor-pointer checked:bg-[#0c0f14] checked:border-[#00c2ff] after:content-[''] after:hidden checked:after:block after:absolute after:top-1/2 after:left-1/2 after:-translate-x-1/2 after:-translate-y-1/2 after:w-2 after:h-2 after:rounded-full after:bg-[#00c2ff]"}),e.jsxs("label",{htmlFor:"publicProfile",className:"cursor-pointer flex items-center gap-1 text-sm",children:[e.jsx("i",{className:"fa-solid fa-globe"})," Público"]})]}),e.jsxs("div",{className:"inline-flex items-center cursor-pointer group",children:[e.jsx("input",{type:"radio",id:"privateProfile",name:"profileType",value:"private",checked:x==="private",onChange:()=>g("private"),className:"appearance-none w-[18px] h-[18px] rounded-full border-2 border-[#00c2ff] mr-2 outline-none transition-all relative cursor-pointer checked:bg-[#0c0f14] checked:border-[#00c2ff] after:content-[''] after:hidden checked:after:block after:absolute after:top-1/2 after:left-1/2 after:-translate-x-1/2 after:-translate-y-1/2 after:w-2 after:h-2 after:rounded-full after:bg-[#00c2ff]"}),e.jsxs("label",{htmlFor:"privateProfile",className:"cursor-pointer flex items-center gap-1 text-sm",children:[e.jsx("i",{className:"fa-solid fa-lock"})," Privado"]})]})]})]}),_&&e.jsxs("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-xl text-red-200 text-sm font-medium animate-pulse",children:[e.jsx("i",{className:"fa-solid fa-circle-exclamation mr-2"})," ",_]}),e.jsx("button",{type:"submit",id:"completeBtn",disabled:!s||j||!!o,className:"w-full p-[14px] bg-[#00c2ff] border-none rounded-[10px] text-black text-lg font-bold cursor-pointer transition-all shadow-[0_4px_10px_rgba(0,194,255,0.4)] hover:bg-[#0099cc] hover:-translate-y-px hover:shadow-[0_6px_15px_rgba(0,194,255,0.6)] disabled:bg-[rgba(0,194,255,0.4)] disabled:cursor-not-allowed disabled:opacity-60 disabled:shadow-none",children:j?e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin mr-2"}):"Finalizar Cadastro"})]})]})}),e.jsx(q,{isOpen:E,imageSrc:F,onClose:()=>y(!1),onSave:R})]})};export{W as CompleteProfile};

import{A as c,i as n,U as l}from"./index-BC19Iu_T.js";const i=`${c}/api/marketplace`,p={getItems:async()=>{try{const e=await fetch(i);return e.ok?((await e.json()).data||[]).sort((t,m)=>(Number(m.timestamp)||0)-(Number(t.timestamp)||0)):(console.error("Failed to fetch marketplace items with status: ",e.status),[])}catch(e){return console.warn("Marketplace offline mode or fetch error:",e),[]}},getItemById:async e=>{try{const r=await fetch(`${i}/${e}`);return r.ok?(await r.json()).data:void 0}catch(r){console.error(`Error fetching item ${e}:`,r);return}},createItem:async e=>{try{await fetch(`${i}/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(r){console.error("Failed to create marketplace item:",r)}},deleteItem:async e=>{try{await fetch(`${i}/${e}`,{method:"DELETE"})}catch(r){console.error("Failed to delete marketplace item:",r)}}},d={getRecommendedItems:()=>n.marketplace.getAll().sort((e,r)=>r.timestamp-e.timestamp),fetchItems:async()=>{},getItems:()=>n.marketplace.getAll(),getItemById:e=>n.marketplace.findById(e),createItem:async e=>{n.marketplace.add({...e,timestamp:e.timestamp||Date.now()})},deleteItem:async e=>n.marketplace.delete(e),trackView:()=>{},addComment:(e,r,t)=>{const m=n.marketplace.findById(e);if(m){const o={id:"mq-"+Date.now(),userId:t.id,username:t.profile?.name?t.profile.name:"user",avatar:t.profile?.photoUrl,text:r,timestamp:Date.now(),replies:[],likes:0,likedByMe:!1};return m.comments=[o,...m.comments||[]],n.marketplace.update(m),o}},addReply:(e,r,t,m)=>{const o=n.marketplace.findById(e);if(o&&o.comments){const a=o.comments.find(s=>s.id===r);if(a){const s={id:"mqr-"+Date.now(),userId:m.id,username:m.profile?.name?m.profile.name:"user",avatar:m.profile?.photoUrl,text:t,timestamp:Date.now(),replies:[],likes:0,likedByMe:!1,replyToUsername:a.username};return a.replies=[...a.replies||[],s],n.marketplace.update(o),s}}},toggleCommentLike:(e,r)=>{const t=n.marketplace.findById(e);if(t&&t.comments){const m=o=>{for(const a of o){if(a.id===r)return a.likedByMe=!a.likedByMe,a.likes=(a.likes||0)+(a.likedByMe?1:-1),!0;if(a.replies&&m(a.replies))return!0}return!1};if(m(t.comments))return n.marketplace.update(t),!0}return!1},deleteComment:async(e,r)=>{const t=n.marketplace.findById(e);if(t&&t.comments){const m=o=>o.filter(a=>a.id===r?!1:(a.replies&&(a.replies=m(a.replies)),!0));return t.comments=m(t.comments),n.marketplace.update(t),!0}return!1}},u=l?d:p;export{u as m};

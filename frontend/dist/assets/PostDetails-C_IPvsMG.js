import{u as e,e as t,r as s,c as a,j as r,f as l}from"./index-CipjSFYz.js";import{p as i}from"./postService-0_arHZ6V.js";import{F as n}from"./FeedItem-uWP6OEIi.js";import{a as o}from"./apiClient-CNoApq48.js";import{C as c}from"./CommentItem-Bz_LK0Ce.js";import"./UserBadge-DbbG-9AU.js";import"./UserAvatar-BSqXD0cQ.js";const d={async getComments(e){try{return(await o.get(`/posts/${e}/comments`)).data}catch(t){throw t}},async addComment(e,t){try{return(await o.post(`/posts/${e}/comments`,{content:t})).data}catch(s){throw s}},async deleteComment(e){try{await o.delete(`/comments/${e}`)}catch(t){throw t}}},m=({postId:l})=>{const i=e(),{showConfirm:n}=t(),o=s.useRef(null),[m,x]=s.useState([]),[f,p]=s.useState(!0),[u,h]=s.useState(""),[w,g]=s.useState(null),j=a.getCurrentUser(),b=null==j?void 0:j.id,y=s.useCallback(async()=>{p(!0);try{const e=await d.getComments(l);x(e)}catch(e){}finally{p(!1)}},[l]);s.useEffect(()=>{y()},[y]);const v=async()=>{if(u.trim())try{w?(await d.addReply(l,w.id,u.trim()),g(null)):await d.addComment(l,u.trim()),h(""),await y()}catch(e){}},k=async e=>{if(await n("Delete Comment","Are you sure you want to delete this comment?","Delete","Cancel"))try{await d.deleteComment(e),await y()}catch(t){}},C=(e,t)=>{g({id:e,username:t}),setTimeout(()=>{var e;return null==(e=o.current)?void 0:e.focus()},100)},N=async e=>{await d.toggleCommentLike(e),x(m.map(t=>t.id===e?{...t,isLiked:!t.isLiked,likes:t.isLiked?t.likes-1:t.likes+1}:t))};return r.jsxs("div",{className:"w-full flex-grow flex flex-col",children:[r.jsxs("div",{className:"p-4 flex-grow",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-8 px-2",children:[r.jsx("div",{className:"h-4 w-1 bg-[#00c2ff] rounded-full shadow-[0_0_10px_#00c2ff]"}),r.jsxs("h3",{className:"text-sm font-black text-white uppercase tracking-[3px]",children:["Comentários (",m.length,")"]})]}),r.jsx("div",{className:"space-y-1",children:f?r.jsx("div",{className:"text-center py-20 opacity-50",children:r.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-3xl"})}):m.length>0?m.map(e=>r.jsx(c,{comment:e,onReplyClick:C,onLike:N,onDelete:k,onUserClick:e=>i(`/user/${e.replace("@","")}`),currentUserId:b},e.id)):r.jsxs("div",{className:"text-center py-20 opacity-20 border-2 border-dashed border-white/5 rounded-[32px]",children:[r.jsx("i",{className:"fa-regular fa-comment-dots text-5xl mb-4"}),r.jsx("p",{className:"font-bold uppercase tracking-widest text-xs",children:"Seja o primeiro a comentar"})]})})]}),r.jsxs("div",{className:"sticky bottom-0 w-full z-40 bg-[#1a1e26] border-t border-white/10 p-4 px-6 shadow-[0_-5px_20px_rgba(0,0,0,0.5)]",children:[w&&r.jsxs("div",{className:"flex items-center justify-between py-2 mb-3 bg-[#00c2ff11] px-4 rounded-xl text-xs text-gray-300 border-l-2 border-[#00c2ff] animate-slide-up",children:[r.jsxs("span",{children:["Respondendo a ",r.jsxs("strong",{className:"text-[#00c2ff]",children:["@",w.username.replace(/^@/,"")]})]}),r.jsx("button",{onClick:()=>g(null),className:"text-gray-500 hover:text-white",children:r.jsx("i",{className:"fa-solid fa-xmark"})})]}),r.jsxs("div",{className:"flex gap-3 items-center max-w-[500px] mx-auto",children:[r.jsx("input",{ref:o,type:"text",placeholder:w?`Responda @${w.username.replace(/^@/,"")}...`:"Escreva um comentário...",value:u,onChange:e=>h(e.target.value),onKeyDown:e=>"Enter"===e.key&&v(),className:"flex-grow bg-[#0c0f14] border border-white/10 rounded-2xl px-5 py-3.5 text-white outline-none text-sm focus:border-[#00c2ff] transition-all placeholder-gray-700"}),r.jsx("button",{onClick:v,disabled:!u.trim(),className:"bg-[#00c2ff] w-12 h-12 rounded-2xl flex items-center justify-center text-black disabled:opacity-30 disabled:grayscale transition-all active:scale-90 shadow-lg shadow-[#00c2ff1a]",children:r.jsx("i",{className:"fa-solid fa-paper-plane text-sm"})})]})]})]})},x=()=>{const t=e(),{id:o}=l(),[c,d]=s.useState(null),x=a.getCurrentUserId();s.useEffect(()=>{if(o){const e=i.getPostById(o);e?d(e):t("/feed")}},[o,t]);return c?r.jsxs("div",{className:"min-h-[100dvh] flex flex-col font-['Inter'] overflow-hidden bg-[#0c0f14] text-white",children:[r.jsxs("header",{className:"flex items-center justify-between p-4 bg-[#0c0f14] fixed w-full top-0 z-50 border-b border-white/10 h-[65px]",children:[r.jsx("button",{onClick:()=>t(-1),className:"text-[#00c2ff] text-xl p-2 hover:bg-white/5 rounded-full transition-all",children:r.jsx("i",{className:"fa-solid fa-arrow-left"})}),r.jsx("span",{className:"text-xs font-black uppercase tracking-[2px]",children:"Publicação"}),r.jsx("div",{className:"w-10"})]}),r.jsxs("main",{className:"pt-[75px] pb-[130px] w-full max-w-[500px] mx-auto flex-grow overflow-y-auto no-scrollbar px-3",children:[r.jsx(n,{post:c,currentUserId:x,onLike:e=>{i.toggleLike(e).then(e=>{e&&d(e)})},onDelete:()=>{},onUserClick:e=>t(`/user/${e.replace("@","")}`),onCommentClick:()=>{},onShare:async e=>{const t=`${window.location.origin}/#/post/${e.id}`;navigator.share?await navigator.share({url:t}):(navigator.clipboard.writeText(t),alert("Link copiado!"))},onVote:(e,t)=>{if(c&&c.id===e&&null===c.votedOptionIndex){const s=i.voteOnPoll(e,t);d(s)}},onCtaClick:e=>{(null==e?void 0:e.startsWith("http"))?window.open(e,"_blank"):e&&t(e)}}),o&&r.jsx(m,{postId:o})]})]}):r.jsx("div",{className:"min-h-screen bg-[#0c0f14] flex items-center justify-center text-white",children:"Carregando..."})};export{x as PostDetails};

import{j as e,u as $,f as z,r as i,c as O,g as A,w as _}from"./index-BC19Iu_T.js";import{c as D}from"./currencyService-BC2Bcej_.js";const H=({onBack:l,groupName:t})=>e.jsxs("header",{className:"flex items-center justify-between p-4 bg-[#0c0f14] sticky top-0 z-50 border-b border-white/10 h-[65px]",children:[e.jsx("button",{onClick:l,className:"text-[#00c2ff] text-xl p-2 hover:bg-white/5 rounded-full transition-all",children:e.jsx("i",{className:"fa-solid fa-arrow-left"})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[9px] font-black text-gray-500 uppercase tracking-[2px]",children:"Receita Detalhada"}),e.jsx("h1",{className:"text-sm font-bold text-white truncate max-w-[180px]",children:t})]}),e.jsx("div",{className:"w-10"})]}),V=({totalAmount:l,totalSales:t,avgTicket:f,color:g})=>e.jsxs("div",{className:"bg-gradient-to-br from-[#1e2531] to-[#0c0f14] border border-white/10 rounded-[32px] p-8 mb-8 shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#00c2ff] to-transparent opacity-30"}),e.jsx("span",{className:"text-[10px] font-black text-[#00c2ff] uppercase tracking-[3px] block mb-2 text-center opacity-70",children:"Faturamento Bruto"}),e.jsx("div",{className:"text-5xl font-black text-white text-center drop-shadow-2xl",style:{color:g},children:l}),e.jsxs("div",{className:"flex justify-center gap-10 mt-8 pt-6 border-t border-white/5",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-[9px] font-bold text-gray-500 uppercase block mb-1 tracking-widest",children:"Vendas"}),e.jsx("span",{className:"text-xl font-black text-white",children:t})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-[9px] font-bold text-gray-500 uppercase block mb-1 tracking-widest",children:"Ticket MÃ©dio"}),e.jsx("span",{className:"text-xl font-black text-[#00ff82]",children:f})]})]})]}),Y=({metrics:l})=>e.jsx("div",{className:"grid grid-cols-3 gap-3 mb-10",children:l.map((t,f)=>e.jsxs("div",{className:"bg-white/[0.03] border border-white/5 rounded-2xl p-4 flex flex-col items-center gap-1 transition-all hover:bg-white/[0.05]",children:[e.jsx("span",{className:"text-[9px] font-black text-gray-500 uppercase tracking-widest",children:t.label}),e.jsx("span",{className:"text-[12px] font-bold text-white/90",children:t.value})]},f))}),J={syncpay:"fa-bolt",stripe:"fa-brands fa-stripe",paypal:"fa-brands fa-paypal"},q={BR:"ðŸ‡§ðŸ‡·",US:"ðŸ‡ºðŸ‡¸",DE:"ðŸ‡©ðŸ‡ª",FR:"ðŸ‡«ðŸ‡·",IT:"ðŸ‡®ðŸ‡¹",GB:"ðŸ‡¬ðŸ‡§",ES:"ðŸ‡ªðŸ‡¸",JP:"ðŸ‡¯ðŸ‡µ"},K=({metrics:l})=>e.jsxs("section",{className:"mb-10 animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5 px-2",children:[e.jsxs("h2",{className:"text-[11px] font-black text-[#00c2ff] uppercase tracking-[3px] flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-chart-pie"})," Mix de Pagamentos"]}),e.jsx("span",{className:"text-[9px] font-bold text-gray-600 uppercase tracking-widest",children:"Desempenho por Canal"})]}),e.jsx("div",{className:"space-y-2",children:l.length>0?l.map((t,f)=>e.jsxs("div",{className:"relative group overflow-hidden bg-white/[0.02] border border-white/5 rounded-2xl transition-all hover:border-[#00c2ff33] hover:bg-white/[0.04]",children:[e.jsx("div",{className:"absolute bottom-0 left-0 h-[2px] bg-[#00c2ff]/30 transition-all duration-1000",style:{width:`${t.percentage}%`}}),e.jsxs("div",{className:"flex items-center justify-between p-4 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-black/40 flex items-center justify-center text-[#00c2ff] border border-white/5",children:e.jsx("i",{className:`fa-solid ${J[t.provider]||"fa-credit-card"}`})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-[13px] font-bold text-white capitalize leading-tight",children:[t.method," ",e.jsx("span",{className:"text-[10px] text-gray-600 lowercase font-medium mx-1",children:"via"})," ",t.provider]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx("span",{className:"text-[14px]",children:q[t.country]||"ðŸŒ"}),e.jsx("span",{className:"text-[9px] font-black text-gray-500 uppercase tracking-tighter",children:t.country})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-black text-white",children:[t.count," ",e.jsx("span",{className:"text-[10px] text-gray-600 font-normal",children:"vendas"})]}),e.jsxs("div",{className:"text-[11px] font-black text-[#00ff82]",children:[t.percentage.toFixed(1),"%"]})]})]})]},f)):e.jsxs("div",{className:"text-center py-16 opacity-30 border-2 border-dashed border-white/5 rounded-[32px]",children:[e.jsx("i",{className:"fa-solid fa-money-bill-transfer text-4xl mb-4 text-gray-600"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[2px]",children:"Aguardando dados de mercado..."})]})})]}),E={BRL:{symbol:"R$",color:"#00ff82",flag:"ðŸ‡§ðŸ‡·"},USD:{symbol:"$",color:"#00c2ff",flag:"ðŸ‡ºðŸ‡¸"},EUR:{symbol:"â‚¬",color:"#ffd700",flag:"ðŸ‡ªðŸ‡º"}},X=()=>{const l=$(),{id:t}=z(),[f,g]=i.useState(null),[L,w]=i.useState(!0),[I,k]=i.useState(!1),[n,M]=i.useState(null),[p,P]=i.useState("BRL"),[j,R]=i.useState(1),U=async()=>{const a=O.getCurrentUser();if(!a||!t){w(!1);return}const m=A.getGroupById(t);m&&g(m);try{const C=(await _.getTransactions(a.email)).filter(s=>["paid","completed","approved","settled"].includes((s.status||"").toLowerCase())&&s.groupId===t),h=Date.now(),u=1440*60*1e3,v=new Date(new Date().setHours(0,0,0,0)).getTime(),G=v-u,y={},o={hoje:0,ontem:0,d30:0,d60:0,d90:0,d180:0,total:0,unifiedMetrics:[],totalSales:C.length};C.forEach(s=>{const c=parseFloat(s.amount||0),x=new Date(s.created_at||s.createdAt||s.date_created||0).getTime();o.total+=c,x>=v?o.hoje+=c:x>=G&&x<v&&(o.ontem+=c),x>=h-30*u&&(o.d30+=c),x>=h-60*u&&(o.d60+=c),x>=h-90*u&&(o.d90+=c),x>=h-180*u&&(o.d180+=c);const b=(s.provider||s.data?.providerId||"syncpay").toLowerCase(),N=(s.method||s.data?.method||(b==="syncpay"?"Pix":"Card")).split(" ")[0],T=(s.country||s.data?.country||"BR").toUpperCase(),B=`${b}|${N}|${T}`;y[B]=(y[B]||0)+1}),o.unifiedMetrics=Object.entries(y).map(([s,c])=>{const[x,b,N]=s.split("|");return{provider:x,method:b,country:N,count:c,percentage:c/o.totalSales*100}}).sort((s,c)=>c.count-s.count),M(o)}catch(S){console.error("Erro ao carregar faturamento:",S)}finally{w(!1)}};i.useEffect(()=>{U()},[t]),i.useEffect(()=>{(async()=>{if(p==="BRL"){R(1);return}k(!0);try{const m=await D.getRate("BRL",p);R(m)}catch(m){console.error("Erro na conversÃ£o",m)}finally{k(!1)}})()},[p]);const r=i.useMemo(()=>{if(!n)return null;if(j===1)return n;const a=j;return{...n,hoje:n.hoje*a,ontem:n.ontem*a,d30:n.d30*a,d60:n.d60*a,d90:n.d90*a,d180:n.d180*a,total:n.total*a}},[n,j]),d=a=>a.toLocaleString(D.getLocale(p),{style:"currency",currency:p}),F=i.useMemo(()=>r?[{label:"Hoje",value:d(r.hoje)},{label:"Ontem",value:d(r.ontem)},{label:"30d",value:d(r.d30)},{label:"60d",value:d(r.d60)},{label:"90d",value:d(r.d90)},{label:"180d",value:d(r.d180)}]:[],[r,p]);return e.jsxs("div",{className:"min-h-screen bg-[#0a0c10] text-white font-['Inter'] flex flex-col pb-10 overflow-x-hidden",children:[e.jsx("style",{children:`
                .currency-pill {
                    padding: 8px 16px; border-radius: 12px; font-size: 11px; font-weight: 800; cursor: pointer; transition: 0.2s;
                    border: 1px solid rgba(255,255,255,0.05); background: rgba(255,255,255,0.02); color: #555; text-transform: uppercase;
                }
                .currency-pill.active { color: #fff; background: rgba(255,255,255,0.05); border-color: #00c2ff; }
            `}),e.jsx(H,{onBack:()=>l(-1),groupName:f?.name||"Carregando..."}),e.jsxs("main",{className:"p-5 max-w-[600px] mx-auto w-full no-scrollbar",children:[e.jsx("div",{className:"flex justify-center gap-3 mb-8 p-1.5 bg-black/40 rounded-2xl border border-white/5 w-fit mx-auto",children:["BRL","USD","EUR"].map(a=>e.jsxs("button",{className:`currency-pill ${p===a?"active":""}`,onClick:()=>P(a),children:[E[a].flag," ",a]},a))}),L||!r?e.jsxs("div",{className:"flex flex-col items-center justify-center py-24 opacity-30",children:[e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-2xl text-[#00c2ff] mb-4"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[3px]",children:"Auditoria Financeira..."})]}):e.jsxs("div",{className:"animate-fade-in relative",children:[I&&e.jsx("div",{className:"absolute inset-0 bg-[#0a0c10]/60 backdrop-blur-sm z-20 flex items-center justify-center rounded-3xl",children:e.jsx("i",{className:"fa-solid fa-rotate fa-spin text-[#00c2ff] text-2xl"})}),e.jsx(V,{totalAmount:d(r.total),totalSales:r.totalSales,avgTicket:r.totalSales>0?d(r.total/r.totalSales):d(0),color:E[p].color}),e.jsx(Y,{metrics:F}),e.jsx(K,{metrics:r.unifiedMetrics}),e.jsx("div",{className:"bg-white/5 p-5 rounded-2xl border border-dashed border-white/10 text-center opacity-40",children:e.jsxs("p",{className:"text-[9px] text-gray-500 uppercase font-black tracking-[2px] leading-relaxed",children:[e.jsx("i",{className:"fa-solid fa-shield-halved mr-1"})," InteligÃªncia Flux: Dados sincronizados em tempo real."]})})]})]})]})};export{X as GroupRevenue};

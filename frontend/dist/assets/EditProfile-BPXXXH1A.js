import{u as R,r as i,c as m,j as e,d as D}from"./index-BC19Iu_T.js";import{p as L}from"./postService-XFLx8Vj8.js";import{I as M}from"./ImageCropModal-DKSoCquK.js";const V=()=>{const l=R(),h=i.useRef(null),[o,d]=i.useState({name:"",nickname:"",bio:"",website:"",isPrivate:!1,photoUrl:void 0,cpf:"",phone:""}),[x,g]=i.useState(null),[b,S]=i.useState(null),[v,j]=i.useState(!1),[k,E]=i.useState(!0),[O,w]=i.useState(""),[y,c]=i.useState(""),[U,N]=i.useState(!1),[P,I]=i.useState("");i.useEffect(()=>{const t=m.getCurrentUser();if(!t){l("/");return}t.profile&&(d({name:t.profile.name||"",nickname:t.profile.nickname||"",bio:t.profile.bio||"",website:t.profile.website||"",isPrivate:t.profile.isPrivate||!1,photoUrl:t.profile.photoUrl,cpf:t.profile.cpf||"",phone:t.profile.phone||""}),t.profile.photoUrl&&g(t.profile.photoUrl)),E(!1)},[l]);const p=t=>{const{name:a,value:s}=t.target;if(a==="name"){const r=s.toLowerCase().replace(/[^a-z0-9_.]/g,"");d(f=>({...f,[a]:r})),c("")}else d(r=>({...r,[a]:s}))},z=t=>{const a=t.target.files?.[0];if(a){const s=new FileReader;s.onload=r=>{I(r.target?.result),N(!0)},s.readAsDataURL(a)}},A=t=>{g(t),fetch(t).then(a=>a.blob()).then(a=>{const s=new File([a],"avatar.jpg",{type:"image/jpeg"});S(s)})},_=async t=>{if(t.preventDefault(),w(""),c(""),!o.name.trim()){c("Nome de usuário é obrigatório");return}j(!0);const a=m.getCurrentUser(),s=a?.email;try{if(s&&a){let r=o.photoUrl;b&&(r=await L.uploadMedia(b,"avatars"));const f={...o,photoUrl:r};await m.completeProfile(s,f);const C=`@${o.name}`;db.posts.getAll().forEach(n=>{let u=!1;n.authorId===a.id&&(n.username!==C&&(n.username=C,u=!0),r&&n.avatar!==r&&(n.avatar=r,u=!0)),u&&db.posts.update(n)}),alert("Perfil atualizado com sucesso!"),l("/profile",{replace:!0})}}catch(r){r.message===D.NAME_TAKEN?c("Este nome de usuário já está em uso."):w(r.message||"Erro ao atualizar perfil.")}finally{j(!1)}},F=()=>{window.history.state&&window.history.state.idx>0?l(-1):l("/profile")};return k?e.jsx("div",{className:"min-h-screen bg-[#0c0f14] flex items-center justify-center text-white",children:"Carregando..."}):e.jsxs("div",{className:"min-h-screen bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-x-hidden",children:[e.jsx("style",{children:`
        header { display:flex; align-items:center; justify-content:space-between; padding:16px; background: #0c0f14; position:fixed; width:100%; top:0; z-index:10; border-bottom:1px solid rgba(255,255,255,0.1); height: 65px; }
        header .back-btn { background:none; border:none; color:#fff; font-size:24px; cursor:pointer; padding-right: 15px; }
        main { padding-top: 85px; padding-bottom: 40px; width: 100%; max-width: 600px; margin: 0 auto; padding-left: 20px; padding-right: 20px; }
        .avatar-section { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; }
        .avatar-wrapper { position: relative; width: 100px; height: 100px; border-radius: 50%; cursor: pointer; }
        .avatar-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid #00c2ff; }
        .edit-icon { position: absolute; bottom: 0; right: 0; background: #00c2ff; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #0c0f14; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 13px; color: #aaa; margin-bottom: 8px; }
        .input-group input, .input-group textarea { width: 100%; padding: 14px 15px; background: #1a1e26; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: #fff; font-size: 16px; outline: none; }
        .save-btn { width: 100%; padding: 16px; background: #00c2ff; color: #000; border: none; border-radius: 12px; font-weight: 800; cursor: pointer; }
      `}),e.jsxs("header",{children:[e.jsx("button",{onClick:F,className:"back-btn",children:e.jsx("i",{className:"fa-solid fa-arrow-left"})}),e.jsx("h1",{children:"Editar Perfil"}),e.jsx("div",{style:{width:"24px"}})]}),e.jsxs("main",{children:[e.jsxs("div",{className:"avatar-section",children:[e.jsxs("div",{className:"avatar-wrapper",onClick:()=>h.current?.click(),children:[x?e.jsx("img",{src:x,className:"avatar-img"}):e.jsx("div",{className:"avatar-img bg-gray-700 flex items-center justify-center",children:e.jsx("i",{className:"fa-solid fa-user text-4xl"})}),e.jsx("div",{className:"edit-icon",children:e.jsx("i",{className:"fa-solid fa-camera"})})]}),e.jsx("input",{type:"file",ref:h,onChange:z,accept:"image/*",hidden:!0})]}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Apelido"}),e.jsx("input",{type:"text",name:"nickname",value:o.nickname,onChange:p})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Nome de Usuário (@)"}),e.jsx("input",{type:"text",name:"name",value:o.name,onChange:p}),y&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:y})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Biografia"}),e.jsx("textarea",{name:"bio",value:o.bio,onChange:p})]}),e.jsx("button",{type:"submit",className:"save-btn",disabled:v,children:v?"Salvando...":"Salvar Alterações"})]})]}),e.jsx(M,{isOpen:U,imageSrc:P,onClose:()=>N(!1),onSave:A})]})};export{V as EditProfile};

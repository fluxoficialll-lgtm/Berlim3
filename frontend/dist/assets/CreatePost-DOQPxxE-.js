import{u as ne,a as le,r as o,c as E,g as re,j as e,h as de}from"./index-BC19Iu_T.js";import{p as M}from"./postService-XFLx8Vj8.js";import{c as ce}from"./contentSafetyService-BoymUvRp.js";import{g as O}from"./idGenerator-C8OoQYlS.js";const C={Brasil:{Ceará:["Fortaleza","Eusébio","Aquiraz","Sobral"],"São Paulo":["São Paulo","Campinas","Santos","Guarulhos"],"Rio de Janeiro":["Rio de Janeiro","Niterói","Cabo Frio"],"Minas Gerais":["Belo Horizonte","Uberlândia","Ouro Preto"]},"Estados Unidos":{California:["Los Angeles","San Francisco","San Diego"],"New York":["New York City","Buffalo"],Florida:["Miami","Orlando"]},Portugal:{Lisboa:["Lisboa","Sintra","Cascais"],Porto:["Porto","Vila Nova de Gaia"]}},ve=()=>{const u=ne(),x=le().state?.isAd||!1,[d,B]=o.useState(""),[c,k]=o.useState([]),[w,T]=o.useState(!0),[b,S]=o.useState(!1),[m,U]=o.useState(""),[F,R]=o.useState(""),[D,xe]=o.useState(!1),[$,f]=o.useState(!1),[n,V]=o.useState(""),[l,P]=o.useState(""),[v,j]=o.useState(""),[y,A]=o.useState("Global"),[q,h]=o.useState(!1),[I,_]=o.useState([]),[s,G]=o.useState(null),[J,ge]=o.useState(!0),p=E.getCurrentUser(),W=p?.profile?.name?`@${p.profile.name}`:"@usuario",N=p?.profile?.photoUrl;o.useEffect(()=>{const t=d.trim().length,i=c.length>0,r=x?m&&parseFloat(m)>=10:!0;let a=!0;s&&s.status==="inactive"&&(a=!1),T(!(t>0||i||s&&a)||!r||b)},[d,c,b,m,x,s]),o.useEffect(()=>{const t=E.getCurrentUserEmail();if(t){const r=re.getGroupsSync().filter(a=>a.creatorEmail===t);_(r)}},[]);const Y=t=>{const i=t.target.files?Array.from(t.target.files):[];if(i.length>0){if(i.length+c.length>5){alert("Limite de 5 arquivos.");return}const r=i.map(a=>({file:a,url:URL.createObjectURL(a),type:"image"}));k(a=>[...a,...r])}},H=t=>{k(i=>i.filter((r,a)=>a!==t))},K=()=>{window.history.state&&window.history.state.idx>0?u(-1):u("/feed")},Q=t=>{t.preventDefault(),!w&&(S(!0),setTimeout(async()=>{try{const i=c.map(g=>M.uploadMedia(g.file)),a=(await Promise.all(i)).filter(g=>g!==""),se=await ce.analyzeContent(d,a.map(g=>({url:g})));let z=D;se.isAdult&&(z=!0);const L=a.length>0?a[0]:void 0,ie={id:O(),type:a.length>0?"photo":"text",authorId:p?.id||"",username:W,avatar:N,text:d,image:L,images:a.length>0?a:void 0,video:void 0,time:"Agora",timestamp:Date.now(),isPublic:!0,isAdultContent:z,isAd:x,views:0,likes:0,comments:0,liked:!1,location:y==="Global"?void 0:y,relatedGroupId:s?.id};await M.addPost(ie),s?.isVip&&J&&await de.createCampaign({id:O(),ownerId:p?.id||"",name:`Auto-Boost: ${s.name}`,ownerEmail:p?.email||"",scheduleType:"continuous",budget:0,pricingModel:"commission",trafficObjective:"conversions",creative:{text:d,mediaUrl:L,mediaType:"image"},campaignObjective:"group_joins",destinationType:"group",targetGroupId:s.id,optimizationGoal:"group_joins",placements:["feed","reels","marketplace"],ctaButton:"Entrar",status:"active",timestamp:Date.now()}),u(s?`/group-chat/${s.id}`:"/feed")}catch(i){console.error("Erro ao publicar:",i),alert("Erro ao publicar.")}finally{S(!1)}},50))},X=t=>{V(t.target.value),P(""),j("")},Z=t=>{P(t.target.value),j("")},ee=()=>{let t="Global";v?t=`${v}, ${l}`:l?t=`${l}, Brasil`:n&&(t=n==="Brasil"?"Global":n),A(t),f(!1)},te=Object.keys(C),ae=n?Object.keys(C[n]||{}):[],oe=n&&l?C[n][l]||[]:[];return e.jsxs("div",{className:"h-screen flex flex-col bg-[#0c0f14] text-white font-['Inter'] overflow-hidden",children:[e.jsx("style",{children:`
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); height: 60px; z-index: 50; background: #0c0f14; }
        header button { background: none; border: none; font-size: 16px; color: #fff; cursor: pointer; }
        header .publish-btn { background: #00c2ff; color: #000; padding: 6px 16px; border-radius: 20px; font-weight: 700; font-size: 14px; opacity: 1; transition: opacity 0.3s; }
        header .publish-btn:disabled { opacity: 0.5; cursor: not-allowed; background: #333; color: #777; }
        
        main { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        
        .input-area { display: flex; gap: 12px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 1px solid #333; flex-shrink: 0; }
        .text-field { flex: 1; background: transparent; border: none; color: #fff; font-size: 16px; resize: none; min-height: 100px; outline: none; padding-top: 8px; }
        .text-field::placeholder { color: #555; }

        .media-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .media-item { width: 100px; height: 120px; border-radius: 8px; position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); flex-shrink: 0; }
        .media-item img { width: 100%; height: 100%; object-fit: cover; }
        .remove-btn { position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.6); color: #fff; border: none; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; cursor: pointer; }

        .toolbar { display: flex; gap: 15px; border-top: 1px solid rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.05); padding: 15px 0; align-items: center; }
        .tool-btn { background: none; border: none; color: #00c2ff; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; transition: background 0.2s; }
        .tool-btn:hover { background: rgba(0,194,255,0.1); }

        .settings-list { display: flex; flex-direction: column; gap: 2px; }
        .setting-item { display: flex; align-items: center; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .setting-left { display: flex; align-items: center; gap: 10px; color: #fff; font-size: 15px; font-weight: 500; }
        .setting-icon { color: #888; width: 20px; text-align: center; }
        .setting-value { color: #00c2ff; font-size: 14px; margin-right: 10px; font-weight: 600; }
        .chevron { color: #555; font-size: 12px; }

        .ad-box { background: rgba(255,215,0,0.05); border: 1px solid rgba(255,215,0,0.2); border-radius: 10px; padding: 15px; margin-bottom: 10px; }
        .ad-input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 6px; margin-top: 5px; outline: none; }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; display: flex; align-items: center; justify-content: center; }
        .modal { background: #1a1e26; width: 90%; max-width: 350px; border-radius: 16px; padding: 20px; border: 1px solid #333; }
        .modal select { width: 100%; background: #0c0f14; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 8px; margin-bottom: 10px; outline: none; }
        .modal-actions { display: flex; gap: 10px; margin-top: 15px; }
        .modal-btn { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; }
        .save-btn { background: #00c2ff; color: #000; }
        .cancel-btn { background: transparent; border: 1px solid #555; color: #aaa; }
        
        .group-list { max-height: 200px; overflow-y: auto; }
        .group-item { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .group-item:hover { background: rgba(255,255,255,0.05); }
      `}),e.jsxs("header",{children:[e.jsx("button",{onClick:K,children:"Cancelar"}),e.jsx("span",{style:{fontWeight:700,fontSize:"16px"},children:"Novo Post"}),e.jsx("button",{id:"publishbtn",className:"publish-btn",disabled:w,onClick:Q,children:b?"...":x?"Confirmar":"Publicar"})]}),e.jsxs("main",{children:[x&&e.jsxs("div",{className:"ad-box",children:[e.jsx("div",{style:{color:"#FFD700",fontSize:"12px",fontWeight:"900",marginBottom:"5px"},children:"IMPULSIONAMENTO PUBLICITÁRIO"}),e.jsx("input",{type:"number",className:"ad-input",placeholder:"Investimento (Min R$ 10,00)",value:m,onChange:t=>U(t.target.value)}),e.jsx("input",{type:"text",className:"ad-input",placeholder:"Link de Ação (https://...)",value:F,onChange:t=>R(t.target.value)})]}),e.jsxs("div",{className:"input-area",children:[N?e.jsx("img",{src:N,className:"user-avatar",alt:"Avatar"}):e.jsx("div",{className:"user-avatar",style:{background:"#333",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("i",{className:"fa-solid fa-user text-gray-500"})}),e.jsx("textarea",{className:"text-field",placeholder:"No que você está pensando?",value:d,onChange:t=>B(t.target.value)})]}),c.length>0&&e.jsx("div",{className:"media-scroll",children:c.map((t,i)=>e.jsxs("div",{className:"media-item",children:[e.jsx("img",{src:t.url,alt:"Preview"}),e.jsx("button",{className:"remove-btn",onClick:()=>H(i),children:e.jsx("i",{className:"fa-solid fa-xmark"})})]},i))}),e.jsxs("div",{className:"toolbar",children:[e.jsx("button",{className:"tool-btn",onClick:()=>document.getElementById("mediaInput")?.click(),children:e.jsx("i",{className:"fa-regular fa-image"})}),e.jsx("button",{className:"tool-btn",onClick:()=>u("/create-poll"),children:e.jsx("i",{className:"fa-solid fa-square-poll-horizontal"})}),e.jsx("input",{type:"file",id:"mediaInput",hidden:!0,multiple:!0,accept:"image/*",onChange:Y})]}),e.jsxs("div",{className:"settings-list",children:[e.jsxs("div",{className:"setting-item",onClick:()=>f(!0),children:[e.jsxs("div",{className:"setting-left",children:[e.jsx("i",{className:"fa-solid fa-location-dot setting-icon"}),e.jsx("span",{children:"Direcionamento Regional"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{className:"setting-value",children:y}),e.jsx("i",{className:"fa-solid fa-chevron-right chevron"})]})]}),e.jsxs("div",{className:"setting-item",onClick:()=>h(!0),children:[e.jsxs("div",{className:"setting-left",children:[e.jsx("i",{className:"fa-solid fa-users setting-icon"}),e.jsx("span",{children:"Vincular Comunidade"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{className:"setting-value",style:{color:s?"#00ff82":"#555"},children:s?s.name.substring(0,15)+"...":"Nenhum"}),s&&e.jsx("i",{className:"fa-solid fa-xmark",style:{marginLeft:"5px",color:"#ff4d4d"},onClick:t=>{t.stopPropagation(),G(null)}}),!s&&e.jsx("i",{className:"fa-solid fa-chevron-right chevron"})]})]})]})]}),$&&e.jsx("div",{className:"modal-overlay",onClick:()=>f(!1),children:e.jsxs("div",{className:"modal",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{style:{color:"#fff",marginBottom:"15px",textAlign:"center"},children:"Alcance do Post"}),e.jsxs("select",{value:n,onChange:X,children:[e.jsx("option",{value:"",children:"Global (Todos)"}),te.map(t=>e.jsx("option",{value:t,children:t},t))]}),n&&e.jsxs("select",{value:l,onChange:Z,children:[e.jsx("option",{value:"",children:"Todo o País"}),ae.map(t=>e.jsx("option",{value:t,children:t},t))]}),l&&e.jsxs("select",{value:v,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"",children:"Todo o Estado"}),oe.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"modal-btn cancel-btn",onClick:()=>{A("Global"),f(!1)},children:"Resetar"}),e.jsx("button",{className:"modal-btn save-btn",onClick:ee,children:"Aplicar"})]})]})}),q&&e.jsx("div",{className:"modal-overlay",onClick:()=>h(!1),children:e.jsxs("div",{className:"modal",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{style:{color:"#fff",marginBottom:"15px",textAlign:"center"},children:"Selecionar Grupo"}),e.jsx("div",{className:"group-list",children:I.length>0?I.map(t=>e.jsxs("div",{className:"group-item",onClick:()=>{G(t),h(!1)},children:[e.jsx("i",{className:`fa-solid ${t.isVip?"fa-crown text-[#FFD700]":"fa-users text-[#ccc]"}`}),e.jsx("span",{style:{color:"#fff",fontSize:"14px"},children:t.name})]},t.id)):e.jsx("div",{style:{textAlign:"center",color:"#555"},children:"Nenhum grupo encontrado."})}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{className:"modal-btn cancel-btn",onClick:()=>h(!1),children:"Fechar"})})]})})]})};export{ve as CreatePost};

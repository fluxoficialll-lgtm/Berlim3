import{j as e,c as p,A as u,e as b,r as m,u as g,f as j}from"./index-BC19Iu_T.js";import{u as w}from"./useGroupSettings-CvPAF9AB.js";const N=({value:s,onChange:t})=>e.jsxs("div",{className:"relative mb-4",children:[e.jsx("i",{className:"fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-white/20 text-xs"}),e.jsx("input",{type:"text",className:"input-field pl-10 border-white/5",placeholder:"Pesquisar @membro...",value:s,onChange:i=>t(i.target.value)})]}),v=({children:s})=>e.jsx("div",{className:"space-y-1 max-h-[350px] overflow-y-auto no-scrollbar pr-1",children:s}),y=({member:s,isAdmin:t,onAction:i,onRoleClick:l})=>{if(!s||!s.id)return null;const a=s.role==="Dono";return s.role,e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/[0.02] border border-white/5 rounded-xl transition-all hover:bg-white/[0.04]",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[s.avatar?e.jsx("img",{src:s.avatar,className:"w-10 h-10 rounded-full object-cover border border-white/10",alt:"Av"}):e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-white/5 text-white/40 border border-white/5",children:e.jsx("i",{className:"fa-solid fa-user text-xs"})}),a&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 rounded-full flex items-center justify-center border-2 border-[#1a1e26] bg-[#FFD700]",children:e.jsx("i",{className:"fa-solid fa-crown text-[6px] text-black"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm font-bold text-white/90 truncate flex items-center gap-1.5",children:[s.name,s.isMe&&e.jsx("span",{className:"text-[8px] bg-[#00c2ff]/20 text-[#00c2ff] px-1.5 py-0.5 rounded uppercase font-black",children:"Você"})]}),e.jsxs("div",{onClick:()=>!a&&t&&l?.(s.id,s.name,s.roleId),className:`text-[9px] font-black uppercase tracking-widest flex items-center gap-1 ${!a&&t?"text-[#00c2ff] cursor-pointer hover:underline":"text-white/20"}`,children:[s.role,!a&&t&&e.jsx("i",{className:"fa-solid fa-pen-to-square text-[7px]"})]})]}),t&&!s.isMe&&!a&&e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:()=>i(s.id,"kick"),className:"w-8 h-8 rounded-lg flex items-center justify-center text-white/30 hover:text-red-500 transition-all active:scale-90",title:"Expulsar",children:e.jsx("i",{className:"fa-solid fa-user-xmark text-xs"})})})]})},k=({isOpen:s,onClose:t,roles:i,currentRoleId:l,onAssign:a,memberName:n})=>s?e.jsx("div",{className:"fixed inset-0 z-[110] bg-black/90 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-[#1a1e26] border border-white/10 rounded-[40px] w-full max-w-sm overflow-hidden shadow-2xl animate-pop-in",onClick:r=>r.stopPropagation(),children:[e.jsxs("header",{className:"p-8 pb-4 text-center border-b border-white/5",children:[e.jsx("div",{className:"w-16 h-16 bg-[#00c2ff1a] rounded-2xl flex items-center justify-center mx-auto mb-4 border border-[#00c2ff33] text-[#00c2ff] text-2xl",children:e.jsx("i",{className:"fa-solid fa-user-gear"})}),e.jsx("h3",{className:"text-lg font-black text-white uppercase tracking-widest mb-1",children:"Atribuir Cargo"}),e.jsxs("p",{className:"text-xs text-gray-500 italic",children:["Definindo permissões para ",e.jsx("strong",{children:n})]})]}),e.jsx("div",{className:"p-6 space-y-2 max-h-[350px] overflow-y-auto no-scrollbar",children:(i||[]).length>0?i.map(r=>{const c=l===r.id;return e.jsxs("button",{onClick:()=>{a(r.id),t()},className:`w-full flex items-center justify-between p-4 rounded-2xl border transition-all active:scale-[0.98] ${c?"bg-[#00c2ff1a] border-[#00c2ff] shadow-[0_0_15px_rgba(0,194,255,0.1)]":"bg-white/5 border-white/5 hover:border-white/10"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-3 h-3 rounded-full shrink-0 shadow-sm",style:{backgroundColor:r.color,boxShadow:`0 0 8px ${r.color}66`}}),e.jsxs("div",{className:"flex flex-col text-left truncate",children:[e.jsx("span",{className:`text-sm font-bold truncate ${c?"text-[#00c2ff]":"text-white"}`,children:r.name}),c&&e.jsx("span",{className:"text-[8px] font-black text-[#00c2ff] uppercase tracking-widest mt-0.5",children:"Cargo Atual"})]})]}),c?e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#00c2ff] flex items-center justify-center text-black text-[10px]",children:e.jsx("i",{className:"fa-solid fa-check"})}):e.jsx("i",{className:"fa-solid fa-chevron-right text-gray-700 text-[10px]"})]},r.id)}):e.jsxs("div",{className:"py-12 text-center opacity-30",children:[e.jsx("i",{className:"fa-solid fa-id-card-clip text-4xl mb-4"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest px-10",children:"Nenhum cargo disponível."})]})}),e.jsx("footer",{className:"p-4 bg-[#0c0f14] border-t border-white/5",children:e.jsx("button",{onClick:t,className:"w-full py-4 text-gray-500 font-black uppercase text-[10px] tracking-[3px] hover:text-white transition-colors",children:"Cancelar"})})]})}):null,A={async logAction(s,t,i){const l=p.getCurrentUser();if(l)try{await fetch(`${u}/api/audit/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groupId:s,adminId:l.id,adminName:l.profile?.nickname||l.profile?.name||"Admin",action:t,targetInfo:i})})}catch(a){console.warn("[Audit] Failed to send remote log",a)}}},C=s=>{const{showAlert:t}=b(),[i,l]=m.useState(!1),[a,n]=m.useState(null);return{isModalOpen:i,setIsModalOpen:l,selectedMember:a,openAssignment:(o,d,x)=>{n({id:o,name:d,currentRole:x}),l(!0)},handleAssignRole:async o=>{if(a)try{await A.logAction(s,"ALTERACAO_CARGO",`Cargo de ${a.name} alterado para ID: ${o}`),await t("Sucesso",`O cargo de ${a.name} foi atualizado.`),l(!1)}catch{await t("Erro","Falha ao atualizar cargo.")}}}},M=({groupId:s,isAdmin:t,members:i,onAction:l,searchQuery:a,onSearchChange:n,availableRoles:r})=>{const{isModalOpen:c,setIsModalOpen:o,selectedMember:d,openAssignment:x,handleAssignRole:h}=C(s);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx(N,{value:a,onChange:n}),e.jsx(v,{children:i.length>0?i.map(f=>e.jsx(y,{member:f,isAdmin:t,onAction:l,onRoleClick:x},f.id)):e.jsxs("div",{className:"text-center py-20 opacity-30 flex flex-col items-center gap-3",children:[e.jsx("i",{className:"fa-solid fa-user-slash text-3xl"}),e.jsx("p",{className:"italic text-xs uppercase font-black tracking-widest",children:"Nenhum membro encontrado"})]})}),e.jsx(k,{isOpen:c,onClose:()=>o(!1),roles:r,currentRoleId:d?.currentRole,memberName:d?.name||"",onAssign:h})]})},I=()=>{const s=g(),{id:t}=j(),{group:i,loading:l,isAdmin:a,handleMemberAction:n,form:r}=w();return l||!i?e.jsx("div",{className:"min-h-screen bg-[#0c0f14] flex items-center justify-center text-white",children:e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-2xl text-[#00c2ff]"})}):e.jsxs("div",{className:"min-h-screen bg-[#0a0c10] text-white font-['Inter'] flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"flex items-center p-4 bg-[#0c0f14] border-b border-white/10 h-[65px] sticky top-0 z-50",children:[e.jsx("button",{onClick:()=>s(`/group-settings/${t}`),className:"mr-4 text-white text-xl p-2 hover:bg-white/5 rounded-full transition-all",children:e.jsx("i",{className:"fa-solid fa-arrow-left"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"font-bold text-sm",children:"Gerenciar Membros"}),e.jsxs("span",{className:"text-[10px] text-[#00c2ff] font-black uppercase tracking-widest",children:[r.members.length," participantes"]})]})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-5 max-w-[600px] mx-auto w-full pb-10 no-scrollbar",children:[e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-6",children:e.jsx(M,{groupId:t||"",isAdmin:a,members:r.members||[],onAction:n,searchQuery:r.searchQuery,onSearchChange:r.setSearchQuery,availableRoles:r.roles||[]})}),e.jsx("div",{className:"mt-8 bg-blue-500/5 border border-blue-500/10 p-5 rounded-2xl",children:e.jsx("p",{className:"text-[10px] text-gray-500 leading-relaxed text-center italic",children:'"Como administrador, você pode promover membros a moderadores ou removê-los da comunidade em tempo real."'})})]})]})};export{I as GroupMembersPage};

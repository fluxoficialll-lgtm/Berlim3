const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TrackingModal-CXjLQngT.js","assets/index-CipjSFYz.js","assets/index-DBFgheNr.css"])))=>i.map(i=>d[i]);
import{j as e,u as n,i as s,a as t,e as r,r as o,g as a,c as i,k as l,_ as c}from"./index-CipjSFYz.js";import{F as d}from"./Footer-CKHcXoCt.js";import{M as p}from"./MainHeader-DNJS5o1U.js";const u=({onClick:n})=>e.jsxs("button",{className:"join-via-link-btn w-full padding-4 mb-5 bg-[#00c2ff0d] border border-dashed border-[#00c2ff] rounded-[12px] text-[#00c2ff] font-semibold cursor-pointer flex items-center justify-center gap-2.5 transition-all h-[54px]",onClick:n,children:[e.jsx("i",{className:"fa-solid fa-link"})," Entrar no Grupo via Link"]}),x=({group:s,isActive:t,onTracking:r,onDelete:o})=>{const a=n();return t?e.jsxs("div",{className:"group-dropdown-container absolute right-2 top-10 z-[100] animate-pop-in",children:[e.jsx("style",{children:"\n                .group-dropdown-card {\n                    min-width: 200px;\n                    background: rgba(26, 30, 38, 0.95);\n                    backdrop-filter: blur(20px);\n                    -webkit-backdrop-filter: blur(20px);\n                    border: 1px solid rgba(255, 255, 255, 0.1);\n                    border-radius: 18px;\n                    padding: 6px;\n                    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);\n                }\n                \n                .dropdown-btn {\n                    width: 100%;\n                    display: flex;\n                    align-items: center;\n                    gap: 12px;\n                    padding: 12px 14px;\n                    background: transparent;\n                    border: none;\n                    border-radius: 12px;\n                    color: #efefef;\n                    font-size: 13px;\n                    font-weight: 700;\n                    cursor: pointer;\n                    transition: all 0.2s ease;\n                    text-align: left;\n                }\n\n                .dropdown-btn:hover {\n                    background: rgba(255, 255, 255, 0.05);\n                    transform: translateX(2px);\n                }\n\n                .dropdown-btn:active {\n                    transform: scale(0.98);\n                }\n\n                .dropdown-btn i {\n                    width: 30px;\n                    height: 30px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    border-radius: 8px;\n                    font-size: 14px;\n                    transition: 0.2s;\n                }\n\n                .icon-settings { background: rgba(0, 194, 255, 0.1); color: #00c2ff; }\n                .icon-preview { background: rgba(255, 215, 0, 0.1); color: #FFD700; }\n                .icon-tracking { background: rgba(0, 255, 130, 0.1); color: #00ff82; }\n                .icon-delete { background: rgba(255, 77, 77, 0.1); color: #ff4d4d; }\n\n                .dropdown-btn.danger:hover {\n                    background: rgba(255, 77, 77, 0.1);\n                    color: #ff4d4d;\n                }\n\n                .btn-label {\n                    flex: 1;\n                }\n\n                .shortcut-hint {\n                    font-size: 10px;\n                    color: rgba(255, 255, 255, 0.2);\n                    font-weight: 800;\n                }\n            "}),e.jsxs("div",{className:"group-dropdown-card",onClick:e=>e.stopPropagation(),children:[e.jsxs("button",{className:"dropdown-btn",onClick:e=>{e.stopPropagation(),a(`/group-settings/${s.id}`)},children:[e.jsx("i",{className:"fa-solid fa-gear icon-settings"}),e.jsx("span",{className:"btn-label",children:"ConfiguraÃ§Ãµes"})]}),s.isVip&&e.jsxs("button",{className:"dropdown-btn",onClick:e=>{e.stopPropagation(),a(`/vip-group-sales/${s.id}`)},children:[e.jsx("i",{className:"fa-solid fa-eye icon-preview"}),e.jsx("span",{className:"btn-label",children:"Preview de Venda"})]}),e.jsxs("button",{className:"dropdown-btn",onClick:r,children:[e.jsx("i",{className:"fa-solid fa-link icon-tracking"}),e.jsx("span",{className:"btn-label",children:"Rastreamento"})]}),e.jsx("div",{className:"h-px bg-white/5 my-1 mx-2"}),e.jsxs("button",{className:"dropdown-btn danger",onClick:o,children:[e.jsx("i",{className:"fa-solid fa-trash icon-delete"}),e.jsx("span",{className:"btn-label",children:"Excluir Grupo"}),e.jsx("span",{className:"shortcut-hint",children:"PERMANENTE"})]})]})]}):null},g=({group:n,currentUserEmail:t,unreadCount:r,isMenuActive:o,onToggleMenu:a,onItemClick:i,onTracking:l,onDelete:c})=>{const d=n.creatorEmail===t,p=s.chats.getAll(),u=Object.values(p).filter(e=>{const s=e.id.toString();return s===n.id||s.startsWith(`${n.id}_`)});let g=null;u.forEach(e=>{if(e.messages&&e.messages.length>0){const n=e.messages[e.messages.length-1];(!g||n.id>g.id)&&(g=n)}});let f="",m="";if(g){f=((g.senderEmail||g.senderId||"").toLowerCase()===(null==t?void 0:t.toLowerCase())?"VocÃª: ":g.senderName?`${g.senderName}: `:"")+("text"===g.contentType?g.text:"image"===g.contentType?"ðŸ“· Foto":"video"===g.contentType?"ðŸŽ¥ VÃ­deo":"audio"===g.contentType?"ðŸŽ¤ Ãudio":"ðŸ“Ž Arquivo"),m=g.timestamp}else f=n.isSalesPlatformEnabled?"Acesse o catÃ¡logo do grupo":n.description||"Toque para abrir a comunidade",m="Novo";return e.jsxs("div",{className:"group-preview flex items-center p-3 border-b border-white/5 cursor-pointer transition-all relative",onClick:i,children:[e.jsx("div",{className:"group-avatar w-[50px] h-[50px] rounded-full mr-4 border-2 border-[#00c2ff] bg-[#00c2ff33] flex items-center justify-center text-2xl flex-shrink-0 overflow-hidden",children:n.coverImage?e.jsx("img",{src:n.coverImage,alt:n.name,className:"w-full h-full object-cover"}):e.jsx("i",{className:"fa-solid "+(n.isVip?"fa-crown":"fa-users")})}),e.jsxs("div",{className:"group-info flex flex-col flex-grow min-w-0 mr-2.5",children:[e.jsx("div",{className:"groupname font-bold text-base mb-0.5 whitespace-nowrap overflow-hidden text-ellipsis text-white",children:n.name}),e.jsx("div",{className:"last-message text-sm whitespace-nowrap overflow-hidden text-ellipsis "+(r>0?"text-white font-semibold":"text-gray-400"),children:f})]}),e.jsxs("div",{className:"flex flex-col items-end flex-shrink-0",children:[e.jsx("div",{className:"text-[10px] uppercase font-bold "+(r>0?"text-[#00c2ff]":"text-gray-500"),children:m}),r>0&&e.jsx("div",{className:"group-unread-badge bg-[#ff4d4d] text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[20px] text-center mt-1",children:r})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"group-menu-btn absolute right-1 top-1 text-gray-500 p-2 cursor-pointer z-[5]",onClick:a,children:e.jsx("i",{className:"fa-solid fa-ellipsis-vertical"})}),e.jsx(x,{group:n,isActive:o,onTracking:l,onDelete:c})]})]})},f=({visible:n,onClick:s})=>e.jsx("button",{onClick:s,className:"fixed bottom-[105px] right-[20px] w-[60px] h-[60px] bg-[#00c2ff] border-none rounded-full text-white cursor-pointer shadow-[0_4px_12px_rgba(0,194,255,0.3)] z-20 flex items-center justify-center transition-transform duration-300 "+(n?"scale-100":"scale-0"),children:e.jsx("i",{className:"fa-solid fa-plus text-2xl"})}),m=o.lazy(()=>c(()=>import("./TrackingModal-CXjLQngT.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.TrackingModal}))),b=()=>{const c=n(),x=t(),{showAlert:b,showConfirm:h,showPrompt:j}=r(),[w,v]=o.useState(!0),[k,N]=o.useState([]),[C,E]=o.useState(null),[y,S]=o.useState(null),[T,I]=o.useState(null),[_,P]=o.useState(!1),[A,L]=o.useState(null),[$,M]=o.useState(!0),[G,V]=o.useState(!0),[z,F]=o.useState(0),D=o.useRef(0),R=o.useRef(null),U=o.useCallback((e,n=!1)=>{const{groups:s,hasMore:t}=a.getGroupsPaginated(e,10);n?(N(s),F(10)):(N(e=>{const n=new Set(e.map(e=>e.id)),t=s.filter(e=>!n.has(e.id));return[...e,...t]}),F(e=>e+10)),V(t),M(!1)},[]);o.useEffect(()=>{const e=i.getCurrentUserEmail(),n=i.getCurrentUserId();if(!e)return void c("/");E(e),S(n),U(0,!0),a.fetchGroups();const t=new URLSearchParams(x.search).get("join");t&&(O(t),c("/groups",{replace:!0}));const r=s.subscribe("groups",()=>{U(0,!0)}),o=s.subscribe("chats",()=>{U(0,!0)}),l=()=>{const e=window.scrollY;v(e<=D.current||e<=80),D.current=e},d=()=>I(null);return window.addEventListener("scroll",l),document.addEventListener("click",d),()=>{r(),o(),window.removeEventListener("scroll",l),document.removeEventListener("click",d)}},[c,x.search,U]),o.useEffect(()=>{const e=new IntersectionObserver(e=>{e[0].isIntersecting&&G&&!$&&U(z)},{threshold:.5});return R.current&&e.observe(R.current),()=>e.disconnect()},[G,$,z,U]);const O=e=>{if(!e.trim())return;let n=e;n.includes("?join=")&&(n=n.split("?join=")[1]);const s=a.joinGroupByLinkCode(n);if(s.success)if(b("Sucesso!",s.message),s.groupId){const e=a.getGroupById(s.groupId);e&&e.channels&&e.channels.length>0?c(`/group/${s.groupId}/channels`):c(`/group-chat/${s.groupId}`)}else U(0,!0);else b("Ops!",s.message)};return e.jsxs("div",{className:"min-h-screen bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-x-hidden",children:[e.jsx(p,{leftContent:e.jsx("button",{onClick:()=>c("/top-groups"),className:"bg-none border-none text-[#00c2ff] text-lg cursor-pointer",children:e.jsx("i",{className:"fa-solid fa-ranking-star"})}),rightContent:e.jsx("button",{onClick:()=>c("/messages"),className:"bg-none border-none text-[#00c2ff] text-lg cursor-pointer",children:e.jsx("i",{className:"fa-solid fa-message"})}),onLogoClick:()=>window.scrollTo({top:0,behavior:"smooth"})}),e.jsxs("main",{className:"flex-grow pt-[100px] pb-[100px] px-4",children:[e.jsx(u,{onClick:async()=>{const e=await j("Entrar via Link","Cole o cÃ³digo do grupo:","Ex: AF72B");e&&O(e)}}),e.jsxs("div",{className:"w-full",children:[k.length>0?k.map(n=>e.jsx(g,{group:n,currentUserEmail:C,unreadCount:l.getGroupUnreadCount(n.id),isMenuActive:T===n.id,onToggleMenu:e=>{e.stopPropagation(),I(T===n.id?null:n.id)},onItemClick:()=>(e=>{var n;const t=e.creatorEmail===C,r=null==(n=e.memberIds)?void 0:n.includes(y||"");if(e.isSalesPlatformEnabled&&(t||r))c(`/group-platform/${e.id}`);else if(t||r){if(e.isVip&&!t&&y&&!s.vipAccess.check(y,e.id))return void c(`/vip-group-sales/${e.id}`);const n=e.channels&&e.channels.length>0;c(n?`/group/${e.id}/channels`:`/group-chat/${e.id}`)}else e.isVip?c(`/vip-group-sales/${e.id}`):c(`/group-landing/${e.id}`)})(n),onTracking:e=>((e,n)=>{n.stopPropagation(),I(null),L(e),P(!0)})(n,e),onDelete:e=>(async(e,n)=>{n.stopPropagation(),I(null),await h("Excluir Grupo?","Tem certeza que deseja excluir este grupo permanentemente?","Excluir","Cancelar")&&(a.deleteGroup(e),N(n=>n.filter(n=>n.id!==e)))})(n.id,e)},n.id)):$?e.jsx("div",{className:"text-center mt-10",children:e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-2xl text-[#00c2ff]"})}):e.jsx("div",{className:"text-center text-gray-500 mt-10",children:"VocÃª nÃ£o participa de nenhum grupo."}),e.jsx("div",{ref:R,className:"h-10"})]})]}),e.jsx(f,{visible:w,onClick:()=>c("/create-group")}),e.jsx(d,{visible:w}),_&&A&&e.jsx(o.Suspense,{fallback:null,children:e.jsx(m,{isOpen:_,onClose:()=>P(!1),group:A})})]})};export{b as Groups};

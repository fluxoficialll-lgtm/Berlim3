import{r as a,j as e,u as oe,a as ae,f as ie,e as re,c as B,k as y,y as k}from"./index-BC19Iu_T.js";import{p as $}from"./postService-XFLx8Vj8.js";import{m as ne}from"./marketplaceService-ov_b-P0x.js";import{F as q}from"./FeedItem-DGLoJJDB.js";import{A as le}from"./UserBadge-CHMRiDZl.js";import{F as ce}from"./Footer-CqKWM_In.js";import{M as de}from"./MainHeader-C_NQXNMS.js";import{P as fe,a as pe,b as me}from"./ProfileProductsGrid-BcnAIYzq.js";import"./UserAvatar-BWaKHm2D.js";import"./ProductCard-CO49MvpN.js";const xe=({onBack:n,onLogoClick:d,isMe:p,isBlocked:j,onToggleBlock:x,onReport:m,username:w})=>{const[o,f]=a.useState(!1),c=a.useRef(null);return a.useEffect(()=>{const u=b=>{c.current&&!c.current.contains(b.target)&&f(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
                .profile-dropdown { 
                    position: absolute; 
                    top: 40px; 
                    right: 0; 
                    background: #1a1e26; 
                    border: 1px solid rgba(255,255,255,0.1); 
                    border-radius: 12px; 
                    width: 160px; 
                    display: flex; 
                    flex-direction: column; 
                    overflow: hidden; 
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6); 
                    z-index: 60; 
                    animation: popIn 0.2s ease-out;
                }
                .profile-dropdown button { 
                    padding: 12px 16px; 
                    text-align: left; 
                    font-size: 13px; 
                    color: #fff; 
                    background: none;
                    border: none;
                    border-bottom: 1px solid rgba(255,255,255,0.05); 
                    display: flex; 
                    align-items: center; 
                    gap: 10px; 
                    cursor: pointer;
                    transition: 0.2s;
                }
                .profile-dropdown button:hover { background: rgba(255,255,255,0.05); }
                .profile-dropdown button.danger { color: #ff4d4d; }
                
                @keyframes popIn {
                    from { transform: scale(0.9) translateY(-10px); opacity: 0; }
                    to { transform: scale(1) translateY(0); opacity: 1; }
                }
            `}),e.jsx(de,{leftContent:e.jsx("button",{onClick:n,className:"text-[#00c2ff] text-xl",children:e.jsx("i",{className:"fa-solid fa-arrow-left"})}),onLogoClick:d,rightContent:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>f(!o),className:"text-[#00c2ff] text-xl p-2",children:e.jsx("i",{className:"fa-solid fa-ellipsis-vertical"})}),o&&e.jsxs("div",{ref:c,className:"profile-dropdown",children:[e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(window.location.href),f(!1),alert("Link copiado!")},children:[e.jsx("i",{className:"fa-solid fa-link text-[#00c2ff]"})," Copiar Link"]}),!p&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{m(),f(!1)},children:[e.jsx("i",{className:"fa-solid fa-flag text-gray-400"})," Denunciar"]}),e.jsxs("button",{className:"danger",onClick:()=>{x(),f(!1)},children:[e.jsx("i",{className:"fa-solid fa-ban"})," ",j?"Desbloquear":"Bloquear"]})]})]})]})})]})},ue=({avatar:n,nickname:d,username:p,bio:j,stats:x,isMe:m,isBlocked:w,relationStatus:o,isFollowLoading:f,canMessage:c,onFollowClick:u,onMessageClick:b,onAvatarClick:C})=>w?null:e.jsxs("div",{className:"profile-card-box",children:[n?e.jsx("img",{src:n,className:"profile-avatar",onClick:C,alt:d}):e.jsx("div",{className:"profile-placeholder",children:e.jsx("i",{className:"fa-solid fa-user"})}),e.jsx("span",{className:"profile-nickname",children:d}),e.jsx("span",{className:"profile-handle",children:p}),e.jsxs("div",{className:"profile-stats-container",children:[e.jsxs("div",{className:"stat-box",children:[e.jsx("span",{className:"stat-value",children:x.posts}),e.jsx("span",{className:"stat-label",children:"Posts"})]}),e.jsxs("div",{className:"stat-box",children:[e.jsx("span",{className:"stat-value",children:x.followers}),e.jsx("span",{className:"stat-label",children:"Seguidores"})]}),e.jsxs("div",{className:"stat-box",children:[e.jsx("span",{className:"stat-value",children:x.following}),e.jsx("span",{className:"stat-label",children:"Seguindo"})]})]}),e.jsx("p",{className:"profile-bio",children:j}),!m&&e.jsxs("div",{className:"profile-actions",children:[e.jsx("button",{id:"followButton",className:o==="following"?"is-following":o==="requested"?"request-sent":"",onClick:u,disabled:f,children:f?e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin"}):o==="following"?"Seguindo":o==="requested"?"Solicitado":"Seguir"}),c&&e.jsxs("button",{id:"messageButton",onClick:b,children:[e.jsx("i",{className:"fa-solid fa-comment-dots mr-2"})," Mensagem"]})]})]}),he=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center p-10 text-center text-gray-500 animate-fade-in mt-10",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-6",children:e.jsx("i",{className:"fa-solid fa-user-slash text-4xl opacity-30"})}),e.jsx("h2",{className:"text-white text-lg font-bold mb-2",children:"Perfil Indisponível"}),e.jsx("p",{className:"text-sm max-w-[250px] leading-relaxed",children:"Você não pode visualizar as informações deste usuário no momento."})]}),ge=()=>e.jsxs("div",{className:"flex flex-col items-center p-20 text-gray-500 animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-6 border border-white/10",children:e.jsx("i",{className:"fa-solid fa-lock text-2xl opacity-40"})}),e.jsx("h2",{className:"text-white font-bold text-lg mb-1",children:"Esta conta é privada"}),e.jsx("p",{className:"text-sm text-center",children:"Siga para ver as publicações e fotos."})]}),Ie=()=>{const n=oe(),d=ae(),{username:p}=ie(),{showAlert:j}=re(),x=a.useRef(null),[m,w]=a.useState("posts"),[o,f]=a.useState(null),[c,u]=a.useState([]),[b,C]=a.useState([]),[E,_]=a.useState(!1),[N,A]=a.useState(!1),[S,H]=a.useState(""),[W,G]=a.useState(!0),[F,L]=a.useState(!1),[v,P]=a.useState("none"),[I,M]=a.useState(!1),[Y,O]=a.useState(!1);a.useEffect(()=>{d.state&&d.state.activeTab&&w(d.state.activeTab)},[d.state]);const g=async()=>{const t=(p?p.startsWith("@")?p:`@${p}`:"@usuario").replace("@","").toLowerCase().trim(),l=d.state?.emailFallback,r=B.getCurrentUser(),i=await B.fetchUserByHandle(t,l);let D=!1;if(r&&r.profile?.name===t&&(D=!0),i){if(H(i.email),r?.email){const h=y.hasBlockingRelationship(r.email,i.email)||y.hasBlockingRelationship(r.email,t);M(h)}const ee=k.getFollowers(i.profile?.name||""),se=k.getFollowing(i.id),T=$.getUserPosts(i.id);u(T.sort((h,U)=>U.timestamp-h.timestamp));const te=ne.getItems().filter(h=>h.sellerId===i.email||h.sellerId===i.id);C(te.sort((h,U)=>U.timestamp-h.timestamp));const V={username:`@${i.profile?.name}`,nickname:i.profile?.nickname||i.profile?.name,avatar:i.profile?.photoUrl,bio:i.profile?.bio||"Sem biografia.",stats:{posts:T.length,followers:ee.length,following:se.length}};f(V),_(i.profile?.isPrivate||!1),A(D),P(k.isFollowing(V.username))}G(!1)};a.useEffect(()=>{g();const s=db.subscribe("users",g),t=db.subscribe("relationships",g),l=db.subscribe("posts",g),r=db.subscribe("chats",g);return()=>{s(),t(),l(),r()}},[p]);const R=s=>{u(t=>t.map(l=>l.id===s?{...l,liked:!l.liked,likes:l.likes+(l.liked?-1:1)}:l)),$.toggleLike(s)},z=(s,t)=>{u(l=>l.map(r=>{if(r.id===s&&r.pollOptions&&r.votedOptionIndex==null){const i=[...r.pollOptions];return i[t].votes+=1,{...r,pollOptions:i,votedOptionIndex:t}}return r}))},J=async()=>{if(!F){L(!0);try{if(v==="following"||v==="requested")window.confirm(`Deixar de seguir ${o.username}?`)&&(await k.unfollowUser(o.username),P("none"));else{const s=await k.followUser(o.username);P(s)}}catch(s){j("Erro",s.message||"Erro de conexão.")}finally{L(!1)}}},K=()=>{const s=B.getCurrentUserEmail();if(s&&S){const t=y.getPrivateChatId(s,S);n(`/chat/${t}`)}},Q=()=>{const s=y.toggleBlockByContactName(o.username);M(s)},X=N||!E||v==="following",Z=!N&&(!E||v==="following");return W||!o?e.jsx("div",{className:"min-h-screen bg-[#0c0f14] flex items-center justify-center text-white",children:e.jsx("i",{className:"fa-solid fa-circle-notch fa-spin text-2xl text-[#00c2ff]"})}):e.jsxs("div",{className:"h-screen bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter'] flex flex-col overflow-hidden",children:[e.jsx("style",{children:`
            main { flex-grow: 1; overflow-y: auto; padding-top: 80px; padding-bottom: 100px; scroll-behavior: smooth; }
            .profile-card-box { background: rgba(30, 35, 45, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px; padding: 30px 20px; width: 90%; max-width: 400px; display: flex; flex-direction: column; align-items: center; margin: 0 auto 20px auto; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); }
            .profile-avatar { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 4px solid #00c2ff; margin-bottom: 15px; background: #1e2531; cursor: pointer; }
            .profile-placeholder { width: 100px; height: 100px; border-radius: 50%; background: #1e2531; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #00c2ff; border: 4px solid #00c2ff; margin-bottom: 15px; }
            .profile-nickname { font-size: 24px; font-weight: 800; color: #fff; margin-bottom: 2px; }
            .profile-handle { font-size: 14px; color: #00c2ff; margin-bottom: 15px; }
            .profile-stats-container { display: flex; justify-content: space-around; width: 100%; margin: 20px 0; border-top: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(255,255,255,0.1); padding: 15px 0; }
            .stat-box { display: flex; flex-direction: column; align-items: center; cursor: pointer; flex: 1; }
            .stat-value { font-size: 18px; font-weight: 800; color: #fff; }
            .stat-label { font-size: 11px; color: #aaa; text-transform: uppercase; margin-top: 4px; }
            .profile-bio { font-size: 14px; color: #e0e0e0; text-align: center; line-height: 1.5; margin-bottom: 15px; max-width: 90%; }
            .profile-actions { display: flex; gap: 10px; width: 100%; justify-content: center; margin-top: 10px; }
            .profile-actions button { flex: 1; max-width: 140px; padding: 12px; border-radius: 12px; font-weight: 700; font-size: 14px; border: none; cursor: pointer; }
            #followButton { background: #00c2ff; color: #0c0f14; }
            #followButton.is-following { background: transparent; border: 1px solid #aaa; color: #fff; }
            #followButton.request-sent { background: transparent; border: 1px dashed #aaa; color: #aaa; }
            #messageButton { background: rgba(255,255,255,0.05); color: #fff; border: 1px solid rgba(255,255,255,0.1); }
            .post-list { padding: 0 10px; display: flex; flex-direction: column; }
            .no-content { text-align: center; color: #666; padding: 40px 0; font-size: 14px; width: 100%; }
        `}),e.jsx(xe,{onBack:()=>n(-1),onLogoClick:()=>x.current?.scrollTo({top:0,behavior:"smooth"}),isMe:N,isBlocked:I,onToggleBlock:Q,onReport:()=>alert("Denunciar usuário"),username:o.username}),e.jsx("main",{ref:x,className:"no-scrollbar",children:e.jsx("div",{style:{width:"100%",maxWidth:"500px",margin:"0 auto"},children:I?e.jsx(he,{}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{avatar:o.avatar,nickname:o.nickname,username:o.username,bio:o.bio,stats:o.stats,isMe:N,isBlocked:I,relationStatus:v,isFollowLoading:F,canMessage:Z,onFollowClick:J,onMessageClick:K,onAvatarClick:()=>O(!0)}),X?e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(fe,{activeTab:m,setActiveTab:w,hasProducts:b.length>0}),e.jsxs("div",{className:"tab-content px-2 pb-10",children:[m==="posts"&&e.jsx("div",{className:"post-list px-3",children:c.filter(s=>s.type!=="video"&&s.type!=="photo").length>0?c.filter(s=>s.type!=="video"&&s.type!=="photo").map(s=>e.jsx(q,{post:s,onLike:R,onDelete:()=>{},onUserClick:g,onCommentClick:t=>n(`/post/${t}`),onShare:()=>{},onVote:z,onCtaClick:t=>t?.startsWith("http")?window.open(t,"_blank"):n(t||"")},s.id)):e.jsx("div",{className:"no-content",children:"Nenhum post."})}),m==="products"&&e.jsx(pe,{products:b,onProductClick:s=>n(`/marketplace/product/${s}`)}),m==="fotos"&&e.jsx("div",{className:"post-list px-3",children:c.filter(s=>s.type==="photo").length>0?c.filter(s=>s.type==="photo").map(s=>e.jsx(q,{post:s,onLike:R,onDelete:()=>{},onUserClick:g,onCommentClick:t=>n(`/post/${t}`),onShare:()=>{},onVote:z,onCtaClick:t=>t?.startsWith("http")?window.open(t,"_blank"):n(t||"")},s.id)):e.jsx("div",{className:"no-content",children:"Nenhuma foto."})}),m==="reels"&&e.jsx(me,{reels:c.filter(s=>s.type==="video"),onReelClick:s=>n(`/reels/${s.id}`,{state:{authorId:S}}),onDelete:()=>{}})]})]}):e.jsx(ge,{})]})})}),e.jsx(ce,{}),e.jsx(le,{isOpen:Y,onClose:()=>O(!1),imageSrc:o?.avatar||"",username:o?.nickname||""})]})};export{Ie as UserProfile};

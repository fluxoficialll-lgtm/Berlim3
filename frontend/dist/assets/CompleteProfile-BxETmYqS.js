import{u as e,r as t,c as a,j as r,d as l}from"./index-CipjSFYz.js";import{p as s}from"./postService-0_arHZ6V.js";import{I as o}from"./ImageCropModal-DAIxvQRf.js";const i=()=>{const i=e(),[n,c]=t.useState(""),[d,f]=t.useState(""),[p,x]=t.useState(""),[m,u]=t.useState("public"),[b,h]=t.useState(null),[g,v]=t.useState(null),[w,j]=t.useState(!1),[N,_]=t.useState(""),[y,k]=t.useState(""),[S,C]=t.useState(!1),[I,P]=t.useState(""),F=t.useRef(null),A=a.getCurrentUserEmail();t.useEffect(()=>{if(!A)return void i("/");const e=a.getCurrentUser();e&&e.profile&&(e.profile.name&&!e.profile.name.startsWith("google_user_")?c(e.profile.name):c(""),e.profile.nickname&&"Google User"!==e.profile.nickname?f(e.profile.nickname):f(""),e.profile.photoUrl&&h(e.profile.photoUrl))},[A,i]);const U=()=>{var e;null==(e=F.current)||e.click()};return r.jsxs("div",{className:"h-screen w-full overflow-y-auto bg-[radial-gradient(circle_at_top_left,_#0c0f14,_#0a0c10)] text-white font-['Inter']",children:[r.jsx("div",{className:"min-h-full flex flex-col items-center justify-center p-[30px_20px] overflow-x-hidden",children:r.jsxs("div",{className:"w-full max-w-[400px] bg-white/5 backdrop-blur-md rounded-[20px] p-[30px_25px] shadow-[0_10px_30px_rgba(0,0,0,0.5)] border border-white/10 text-center my-auto",children:[r.jsxs("div",{className:"w-[60px] h-[60px] bg-white/5 rounded-2xl flex items-center justify-center mb-5 transition-transform duration-500 cursor-default shadow-[0_0_20px_rgba(0,194,255,0.3),inset_0_0_20px_rgba(0,194,255,0.08)] mx-auto relative",children:[r.jsx("div",{className:"absolute w-[40px] h-[22px] rounded-[50%] border-[3px] border-[#00c2ff] rotate-[25deg]"}),r.jsx("div",{className:"absolute w-[40px] h-[22px] rounded-[50%] border-[3px] border-[#00c2ff] -rotate-[25deg]"})]}),r.jsx("h1",{className:"text-2xl font-extrabold mb-[5px] text-white drop-shadow-[0_0_5px_rgba(0,194,255,0.5)]",children:"Crie sua Identidade"}),r.jsx("p",{className:"text-[15px] text-white/70 mb-[25px]",children:"Personalize seu acesso ao Flux."}),r.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),_(""),n){if(n.length<3)_("O nome de usuário deve ter no mínimo 3 caracteres.");else if(!y){j(!0);try{if(A){let e=b||void 0;g&&(e=await s.uploadMedia(g,"avatars")),await a.completeProfile(A,{name:n.trim(),nickname:d.trim()||n,bio:p.trim(),isPrivate:"private"===m,photoUrl:e}),setTimeout(()=>{const e=sessionStorage.getItem("redirect_after_login");e?(sessionStorage.removeItem("redirect_after_login"),i(e)):i("/feed")},1e3)}}catch(t){t.message===l.NAME_TAKEN||t.message.includes("indisponível")?k(l.NAME_TAKEN):_(t.message),j(!1)}}}else _("O nome de usuário (@) é obrigatório.")},children:[r.jsxs("div",{className:"flex flex-col items-center mb-[30px]",children:[r.jsx("div",{onClick:U,className:"w-[100px] h-[100px] rounded-full bg-white/10 border-[3px] border-[#00c2ff] mb-[10px] flex items-center justify-center text-4xl text-[#00c2ff] cursor-pointer transition-all hover:shadow-[0_0_15px_rgba(0,194,255,0.5)] overflow-hidden relative",children:b?r.jsx("img",{src:b,alt:"Preview",className:"w-full h-full object-cover"}):r.jsx("i",{className:"fa-solid fa-user"})}),r.jsx("input",{type:"file",id:"profile-pic-input",ref:F,accept:"image/*",onChange:e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a){const e=new FileReader;e.onload=e=>{var t;P(null==(t=e.target)?void 0:t.result),C(!0)},e.readAsDataURL(a)}},className:"hidden"}),r.jsx("span",{onClick:U,className:"text-sm text-[#00c2ff] cursor-pointer",children:"Adicionar Foto"})]}),r.jsxs("div",{className:"relative mb-5 text-left w-full",children:[r.jsx("label",{htmlFor:"usernameInput",className:"block mb-[5px] text-sm font-semibold text-[#00c2ff]",children:"* @Seu_Arroba (Obrigatório)"}),r.jsxs("div",{className:"relative",children:[r.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:"@"}),r.jsx("input",{type:"text",id:"usernameInput",placeholder:"exemplo.flux",required:!0,value:n,onChange:e=>{const t=e.target.value.toLowerCase().replace(/[^a-z0-9_.]/g,"");c(t),y&&k("")},onBlur:async()=>{if(n&&!(n.length<3))try{const e=await a.checkUsernameAvailability(n);k(e?"":"Nome indisponível")}catch(e){}},className:"w-full p-3 pl-8 bg-white/10 border rounded-[10px] text-white text-base outline-none transition-all focus:bg-[rgba(0,194,255,0.1)] focus:shadow-[0_0_8px_rgba(0,194,255,0.8)] placeholder-gray-400 "+(y?"border-red-500":"border-[#00c2ff]")})]}),r.jsx("p",{className:"text-[10px] text-gray-500 mt-1",children:"Apenas minúsculas, números, ponto e underline."}),y&&r.jsx("span",{className:"text-xs text-red-400 mt-1 block font-bold",children:y})]}),r.jsxs("div",{className:"relative mb-5 text-left w-full",children:[r.jsx("label",{htmlFor:"nicknameInput",className:"block mb-[5px] text-sm font-semibold text-[#00c2ff]",children:"Nome de Exibição (Como você quer ser chamado)"}),r.jsx("input",{type:"text",id:"nicknameInput",placeholder:"Seu Nome Real ou Fantasia",value:d,onChange:e=>f(e.target.value),className:"w-full p-3 bg-white/10 border border-[#00c2ff] rounded-[10px] text-white text-base outline-none transition-all focus:bg-[rgba(0,194,255,0.1)] focus:shadow-[0_0_8px_rgba(0,194,255,0.8)] placeholder-gray-400"})]}),r.jsxs("div",{className:"relative mb-5 text-left w-full",children:[r.jsx("label",{htmlFor:"bioInput",className:"block mb-[5px] text-sm font-semibold text-[#00c2ff]",children:"Biografia"}),r.jsx("textarea",{id:"bioInput",placeholder:"Conte um pouco sobre você...",rows:2,maxLength:150,value:p,onChange:e=>x(e.target.value),className:"w-full p-3 bg-white/10 border border-[#00c2ff] rounded-[10px] text-white text-base outline-none transition-all focus:bg-[rgba(0,194,255,0.1)] focus:shadow-[0_0_8px_rgba(0,194,255,0.8)] resize-none placeholder-gray-400"})]}),r.jsxs("div",{className:"mb-[25px] text-left",children:[r.jsx("label",{className:"block mb-[5px] text-sm font-semibold text-[#00c2ff]",children:"* Privacidade do Perfil"}),r.jsxs("div",{className:"flex gap-4",children:[r.jsxs("div",{className:"inline-flex items-center cursor-pointer group",children:[r.jsx("input",{type:"radio",id:"publicProfile",name:"profileType",value:"public",checked:"public"===m,onChange:()=>u("public"),className:"appearance-none w-[18px] h-[18px] rounded-full border-2 border-[#00c2ff] mr-2 outline-none transition-all relative cursor-pointer checked:bg-[#0c0f14] checked:border-[#00c2ff] after:content-[''] after:hidden checked:after:block after:absolute after:top-1/2 after:left-1/2 after:-translate-x-1/2 after:-translate-y-1/2 after:w-2 after:h-2 after:rounded-full after:bg-[#00c2ff]"}),r.jsxs("label",{htmlFor:"publicProfile",className:"cursor-pointer flex items-center gap-1 text-sm",children:[r.jsx("i",{className:"fa-solid fa-globe"})," Público"]})]}),r.jsxs("div",{className:"inline-flex items-center cursor-pointer group",children:[r.jsx("input",{type:"radio",id:"privateProfile",name:"profileType",value:"private",checked:"private"===m,onChange:()=>u("private"),className:"appearance-none w-[18px] h-[18px] rounded-full border-2 border-[#00c2ff] mr-2 outline-none transition-all relative cursor-pointer checked:bg-[#0c0f14] checked:border-[#00c2ff] after:content-[''] after:hidden checked:after:block after:absolute after:top-1/2 after:left-1/2 after:-translate-x-1/2 after:-translate-y-1/2 after:w-2 after:h-2 after:rounded-full after:bg-[#00c2ff]"}),r.jsxs("label",{htmlFor:"privateProfile",className:"cursor-pointer flex items-center gap-1 text-sm",children:[r.jsx("i",{className:"fa-solid fa-lock"})," Privado"]})]})]})]}),N&&r.jsxs("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-xl text-red-200 text-sm font-medium animate-pulse",children:[r.jsx("i",{className:"fa-solid fa-circle-exclamation mr-2"})," ",N]}),r.jsx("button",{type:"submit",id:"completeBtn",disabled:!n||w||!!y,className:"w-full p-[14px] bg-[#00c2ff] border-none rounded-[10px] text-black text-lg font-bold cursor-pointer transition-all shadow-[0_4px_10px_rgba(0,194,255,0.4)] hover:bg-[#0099cc] hover:-translate-y-px hover:shadow-[0_6px_15px_rgba(0,194,255,0.6)] disabled:bg-[rgba(0,194,255,0.4)] disabled:cursor-not-allowed disabled:opacity-60 disabled:shadow-none",children:w?r.jsx("i",{className:"fa-solid fa-circle-notch fa-spin mr-2"}):"Finalizar Cadastro"})]})]})}),r.jsx(o,{isOpen:S,imageSrc:I,onClose:()=>C(!1),onSave:e=>{h(e),fetch(e).then(e=>e.blob()).then(e=>{const t=new File([e],"avatar.jpg",{type:"image/jpeg"});v(t)})}})]})};export{i as CompleteProfile};

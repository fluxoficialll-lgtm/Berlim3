import{A as e}from"./index-CipjSFYz.js";class t{constructor(){this.defaultRetryConfig={maxRetries:3,initialDelay:1e3,maxDelay:5e3}}async withRetry(e,t=this.defaultRetryConfig){var r,s;let a,n=t.initialDelay;for(let i=0;i<=t.maxRetries;i++)try{return await e()}catch(o){if(a=o,(null==(r=o.message)?void 0:r.includes("API_KEY_INVALID"))||(null==(s=o.message)?void 0:s.includes("Requested entity was not found")))throw o;i<t.maxRetries&&(await new Promise(e=>setTimeout(e,n)),n=Math.min(2*n,t.maxDelay))}throw a}}const r={gateways:new class extends t{async request(e,t,r){return this.withRetry(async()=>{var s,a;try{const n=await fetch(e,{...t,headers:{"Content-Type":"application/json",...t.headers}}),o=await n.json().catch(()=>({}));if(!n.ok){if(null==(a=null==(s=o.error)?void 0:s.message)?void 0:a.includes("Requested entity was not found"))throw new Error(`GATEWAY_AUTH_ERROR: ${r}`);return{success:!1,error:o.error||o.message||`Erro no provedor ${r}`,statusCode:n.status}}return{success:!0,data:o}}catch(n){throw n}})}}},s=`${e}/api/stripe`,a={authenticate:async e=>a.verifyCredentials(e),verifyCredentials:async e=>{const t=await r.gateways.request(`${s}/auth-token`,{method:"POST",body:JSON.stringify({secretKey:e})},"Stripe");if(!t.success)throw new Error(t.error);return t.data},createPaymentIntent:async(e,t,a)=>{var n;const o=await r.gateways.request(`${s}/create-intent`,{method:"POST",body:JSON.stringify({group:e,ownerEmail:t,paymentMethodType:a,currency:(null==(n=e.currency)?void 0:n.toLowerCase())||"brl"})},"Stripe");if(!o.success)throw new Error(o.error);return o.data},createCheckoutSession:async(e,t)=>{const a=`${window.location.origin}/#/vip-group-sales/${e.id}?session_id={CHECKOUT_SESSION_ID}&success=true`,n=`${window.location.origin}/#/vip-group-sales/${e.id}?success=false`,o=await r.gateways.request(`${s}/create-session`,{method:"POST",body:JSON.stringify({group:e,ownerEmail:t,successUrl:a,cancelUrl:n})},"Stripe");if(!o.success)throw new Error(o.error);return o.data},checkSessionStatus:async(e,t)=>{const a=await r.gateways.request(`${s}/check-status`,{method:"POST",body:JSON.stringify({sessionId:e,ownerEmail:t})},"Stripe");if(!a.success)throw new Error(a.error);return a.data}},n=a,o=`${e}/api/paypal`,i=async(e,t={})=>{const r=await fetch(e,t);if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.error||`Request failed: ${r.status}`)}return r.json()},c={authenticate:async(e,t)=>c.verifyCredentials(e,t),verifyCredentials:async(e,t)=>i(`${o}/auth-token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:e,clientSecret:t})}),createOrder:async(e,t)=>i(`${o}/create-order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:parseFloat(e.price||"0"),currency:e.currency||"BRL",description:`Acesso VIP: ${e.name}`,ownerEmail:t})}),checkOrderStatus:async(e,t)=>i(`${o}/check-status`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e,ownerEmail:t})})},u=c;export{u as p,n as s};

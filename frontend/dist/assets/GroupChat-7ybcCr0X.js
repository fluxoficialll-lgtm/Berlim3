import{j as e,u as t,g as n,c as l,f as s,e as a,r as i,k as o,i as r}from"./index-Bkpya5GW.js";import{C as u,Y as c,M as d,a as f}from"./MessageItem-ZwLUYDXp.js";const g=({isOpen:t,onClose:n,onSearch:l,onClear:s,onSettings:a,onDelete:i,onLeave:o,isCreator:r,isAdmin:u=!1})=>{if(!t)return null;const c=r||u,d=[{label:"Pesquisar",icon:"fa-solid fa-magnifying-glass",onClick:l},c?{label:"Limpar Mensagens",icon:"fa-solid fa-broom",onClick:s}:null,c?{label:"Configurações",icon:"fa-solid fa-gear",onClick:a}:null,r?{label:"Excluir Grupo",icon:"fa-solid fa-trash",onClick:i,isDestructive:!0}:null,{label:"Sair do Grupo",icon:"fa-solid fa-right-from-bracket",onClick:o,isDestructive:!0}].filter(Boolean);return e.jsx("div",{className:"fixed inset-0 z-[100] bg-transparent",onClick:n,children:e.jsx("div",{className:"absolute top-[70px] right-4 w-[240px] bg-[#1a1e26] rounded-2xl p-2 shadow-2xl animate-pop-in border border-white/10",onClick:e=>e.stopPropagation(),children:e.jsx("div",{className:"flex flex-col gap-1",children:d.map((t,l)=>e.jsxs("button",{onClick:()=>{null==t||t.onClick(),n()},className:"w-full flex items-center gap-3 p-3 rounded-xl transition-all active:scale-[0.98] "+((null==t?void 0:t.isDestructive)?"hover:bg-red-500/10 text-red-400":"hover:bg-white/5 text-white"),children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 "+((null==t?void 0:t.isDestructive)?"bg-red-500/20":"bg-[#00c2ff1a]"),children:e.jsx("i",{className:`${null==t?void 0:t.icon} ${(null==t?void 0:t.isDestructive)?"text-red-400":"text-[#00c2ff]"} text-xs`})}),e.jsx("span",{className:"font-bold text-xs",children:null==t?void 0:t.label})]},l))})})})},p=()=>{var p;const v=t(),{id:m,channelId:x}=s(),{showConfirm:h,showOptions:S}=a(),{validateGroupAccess:C}=(()=>{const e=t();return{validateGroupAccess:t=>{var s;const a=l.getCurrentUserId(),i=n.getGroupById(t);if(!i||!a)return e("/groups"),!1;const o=i.creatorId===a,r=null==(s=i.adminIds)?void 0:s.includes(a);if(i.isVip&&!o&&!r){const l=n.checkVipStatus(t,a);if("none"===l||"expired"===l)return e(`/vip-group-sales/${t}`),!1}return!0},navigateToGroupEntry:t=>{const l=n.getGroupById(t);if(!l)return;const s=l.channels&&l.channels.length>0;l.isSalesPlatformEnabled?e(`/group-platform/${t}`):e(s?`/group/${t}/channels`:`/group-chat/${t}`)}}})(),[b,k]=i.useState(null),[w,y]=i.useState(x||"general"),[j,M]=i.useState(!1),[I,D]=i.useState(!1),[E,$]=i.useState([]),[A,G]=i.useState(!1),N=i.useRef(null),[B,L]=i.useState(!1),[T,P]=i.useState(""),[U,O]=i.useState(!1),[V,R]=i.useState([]),[q,z]=i.useState(null);i.useRef(null);const[F,Y]=i.useState(null),[_,H]=i.useState(null),[J,K]=i.useState(""),[Q,W]=i.useState(!1),[X,Z]=i.useState(!1),ee=null==(p=l.getCurrentUserEmail())?void 0:p.toLowerCase(),te=l.getCurrentUserId(),ne=i.useMemo(()=>`${m}_${w}`,[m,w]),le=i.useCallback(()=>{if(ne){const e=o.getChat(ne).messages||[],t=new Map;e.forEach(e=>{(e.deletedBy||[]).includes(ee||"")||t.set(e.id,e)});const n=Array.from(t.values()).sort((e,t)=>e.id-t.id);$(n)}},[ne,ee]);i.useEffect(()=>{var e;if(m){if(!C(m))return;const t=n.getGroupById(m);if(t){k(t);const n=t.creatorId===te,l=n||te&&(null==(e=t.adminIds)?void 0:e.includes(te));M(n),D(!!l),le(),o.markChatAsRead(ne)}}},[m,w,ne,le]),i.useEffect(()=>{const e=r.subscribe("chats",le);return()=>e()},[le]);const se=e=>{R(t=>{const n=t.includes(e)?t.filter(t=>t!==e):[...t,e];return 0===n.length&&O(!1),n})},ae=e=>{O(!0),R([e]),navigator.vibrate&&navigator.vibrate(10)},ie=i.useMemo(()=>{var e,t;return"general"===w?"Geral":(null==(t=null==(e=null==b?void 0:b.channels)?void 0:e.find(e=>e.id===w))?void 0:t.name)||"Tópico"},[b,w]);return e.jsxs("div",{className:"h-[100dvh] flex flex-col overflow-hidden "+((null==b?void 0:b.isVip)?"secure-content":""),style:{background:"radial-gradient(circle at top left, #0c0f14, #0a0c10)",color:"#fff"},children:[e.jsx(u,{title:(null==b?void 0:b.name)||"Carregando...",subtitle:`#${ie}`,avatar:null==b?void 0:b.coverImage,onBack:()=>v("/groups"),isSelectionMode:U,selectedCount:V.length,onCancelSelection:()=>{O(!1),R([])},onDeleteSelection:async()=>{if(0===V.length)return;const e=await S("Excluir Mensagem",[{label:"Excluir para mim",value:"me",icon:"fa-solid fa-user"},{label:"Excluir para todos",value:"all",icon:"fa-solid fa-users",isDestructive:!0}]);e&&(await o.deleteMessages(ne,V,e),O(!1),R([]),le())},onMenuClick:()=>Z(!0)}),e.jsx("main",{style:{flexGrow:1,width:"100%",display:"flex",flexDirection:"column",paddingTop:"60px"},children:e.jsx(c,{ref:N,style:{height:"100%",paddingBottom:"80px"},data:E,initialTopMostItemIndex:E.length-1,followOutput:"smooth",itemContent:(t,n)=>{var l;return e.jsx(d,{msg:n,isMe:(null==(l=n.senderEmail)?void 0:l.toLowerCase())===ee,isSelectionMode:U,isSelected:V.includes(n.id),onSelect:se,onStartSelection:ae,onMediaClick:(e,t)=>Y({url:e,type:t}),playingAudioId:q,onPlayAudio:()=>{}},n.id)}})}),!U&&e.jsx(f,{onSendMessage:e=>{var t,n,s;const a=l.getCurrentUser(),i={id:Date.now(),senderName:(null==(t=null==a?void 0:a.profile)?void 0:t.nickname)||(null==(n=null==a?void 0:a.profile)?void 0:n.name)||"Você",senderAvatar:null==(s=null==a?void 0:a.profile)?void 0:s.photoUrl,senderEmail:null==a?void 0:a.email,text:e,type:"sent",contentType:"text",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:"sent",deletedBy:[]};o.sendMessage(ne,i)},onSendAudio:()=>{},onFileSelect:()=>{},canPost:!0,placeholder:`Conversar em #${ie}...`}),e.jsx(g,{isOpen:X,onClose:()=>Z(!1),isCreator:j,isAdmin:I,onSearch:()=>{},onClear:()=>O(!0),onSettings:()=>v(`/group-settings/${m}`),onDelete:()=>{},onLeave:()=>{}})]})};export{p as GroupChat};
